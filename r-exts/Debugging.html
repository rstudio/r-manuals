<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R Manuals :: Writing R Extensions - 4&nbsp; Debugging</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./System-and-foreign-language-interfaces.html" rel="next">
<link href="./Tidying-and-profiling-R-code.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R Manuals :: Writing R Extensions</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./../index.html">Home</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-manuals" role="button" data-bs-toggle="dropdown" aria-expanded="false">Manuals</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-manuals">    
        <li>
    <a class="dropdown-item" href="./../r-intro/index.html">
 <span class="dropdown-text">An Introduction to R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-data/index.html">
 <span class="dropdown-text">R Data Import/Export</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-admin/index.html">
 <span class="dropdown-text">R Installation and Administration</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./index.html">
 <span class="dropdown-text">Writing R Extensions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-lang/index.html">
 <span class="dropdown-text">R Language Definition</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-ints/index.html">
 <span class="dropdown-text">R Internals</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./../about.html">About</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Debugging</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Writing R Extensions</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Acknowledgements.html" class="sidebar-item-text sidebar-link">Acknowledgements</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Creating-R-packages.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Creating R packages</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Writing-R-documentation-files.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Writing R documentation files</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tidying-and-profiling-R-code.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tidying and profiling R code</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Debugging.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Debugging</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./System-and-foreign-language-interfaces.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">System and foreign language interfaces</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./The-R-API.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The R API: entry points for C code</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Generic-functions-and-methods.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Generic functions and methods</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Linking-GUIs-and-other-front-ends-to-R.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Linking GUIs and other front-ends to R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Function-and-variable-index.html" class="sidebar-item-text sidebar-link">Function and variable index</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Concept-index.html" class="sidebar-item-text sidebar-link">Concept index</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#browsing" id="toc-browsing" class="nav-link active" data-scroll-target="#browsing"><span class="toc-section-number">4.1</span>  Browsing</a></li>
  <li><a href="#debugging-r-code" id="toc-debugging-r-code" class="nav-link" data-scroll-target="#debugging-r-code"><span class="toc-section-number">4.2</span>  Debugging R code</a></li>
  <li><a href="#checking-memory-access" id="toc-checking-memory-access" class="nav-link" data-scroll-target="#checking-memory-access"><span class="toc-section-number">4.3</span>  Checking memory access</a>
  <ul class="collapse">
  <li><a href="#using-gctorture" id="toc-using-gctorture" class="nav-link" data-scroll-target="#using-gctorture"><span class="toc-section-number">4.3.1</span>  Using gctorture</a></li>
  <li><a href="#using-valgrind" id="toc-using-valgrind" class="nav-link" data-scroll-target="#using-valgrind"><span class="toc-section-number">4.3.2</span>  Using valgrind</a></li>
  <li><a href="#using-the-address-sanitizer" id="toc-using-the-address-sanitizer" class="nav-link" data-scroll-target="#using-the-address-sanitizer"><span class="toc-section-number">4.3.3</span>  Using the Address Sanitizer</a></li>
  <li><a href="#using-the-leak-sanitizer" id="toc-using-the-leak-sanitizer" class="nav-link" data-scroll-target="#using-the-leak-sanitizer"><span class="toc-section-number">4.3.4</span>  Using the Leak Sanitizer</a></li>
  <li><a href="#using-the-undefined-behaviour-sanitizer" id="toc-using-the-undefined-behaviour-sanitizer" class="nav-link" data-scroll-target="#using-the-undefined-behaviour-sanitizer"><span class="toc-section-number">4.3.5</span>  Using the Undefined Behaviour Sanitizer</a></li>
  <li><a href="#other-analyses-with-clang" id="toc-other-analyses-with-clang" class="nav-link" data-scroll-target="#other-analyses-with-clang"><span class="toc-section-number">4.3.6</span>  Other analyses with ‘clang’</a></li>
  <li><a href="#other-analyses-with-gcc" id="toc-other-analyses-with-gcc" class="nav-link" data-scroll-target="#other-analyses-with-gcc"><span class="toc-section-number">4.3.7</span>  Other analyses with ‘gcc’</a></li>
  <li><a href="#using-dr.-memory" id="toc-using-dr.-memory" class="nav-link" data-scroll-target="#using-dr.-memory"><span class="toc-section-number">4.3.8</span>  Using ‘Dr.&nbsp;Memory’</a></li>
  <li><a href="#fortran-array-bounds-checking" id="toc-fortran-array-bounds-checking" class="nav-link" data-scroll-target="#fortran-array-bounds-checking"><span class="toc-section-number">4.3.9</span>  Fortran array bounds checking</a></li>
  </ul></li>
  <li><a href="#debugging-compiled-code" id="toc-debugging-compiled-code" class="nav-link" data-scroll-target="#debugging-compiled-code"><span class="toc-section-number">4.4</span>  Debugging compiled code</a>
  <ul class="collapse">
  <li><a href="#finding-entry-points-in-dynamically-loaded-code" id="toc-finding-entry-points-in-dynamically-loaded-code" class="nav-link" data-scroll-target="#finding-entry-points-in-dynamically-loaded-code"><span class="toc-section-number">4.4.1</span>  Finding entry points in dynamically loaded code</a></li>
  <li><a href="#inspecting-r-objects-when-debugging" id="toc-inspecting-r-objects-when-debugging" class="nav-link" data-scroll-target="#inspecting-r-objects-when-debugging"><span class="toc-section-number">4.4.2</span>  Inspecting R objects when debugging</a></li>
  <li><a href="#debugging-on-macos" id="toc-debugging-on-macos" class="nav-link" data-scroll-target="#debugging-on-macos"><span class="toc-section-number">4.4.3</span>  Debugging on macOS</a></li>
  </ul></li>
  <li><a href="#using-link-time-optimization" id="toc-using-link-time-optimization" class="nav-link" data-scroll-target="#using-link-time-optimization"><span class="toc-section-number">4.5</span>  Using Link-time Optimization</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="debugging" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Debugging</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>This chapter covers the debugging of R extensions, starting with the ways to get useful error information and moving on to how to deal with errors that crash R.</p>
<section id="browsing" class="level2 section page-columns page-full" data-number="4.1">
<h2 class="section anchored" data-number="4.1" data-anchor-id="browsing"><span class="header-section-number">4.1</span> Browsing</h2>
<p>Most of the R-level debugging facilities are based around the built-in browser. This can be used directly by inserting a call to <code>browser()</code> into the code of a function (for example, using <code>fix(my_function)</code> ). When code execution reaches that point in the function, control returns to the R console with a special prompt. For example</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">fix</span>(summary.data.frame) <span class="do">## insert browser() call after for() loop</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(women)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>Called from<span class="sc">:</span> <span class="fu">summary.data.frame</span>(women)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="fu">ls</span>()</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">"digits"</span> <span class="st">"i"</span>      <span class="st">"lbs"</span>    <span class="st">"lw"</span>     <span class="st">"maxsum"</span> <span class="st">"nm"</span>     <span class="st">"nr"</span>     <span class="st">"nv"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">"object"</span> <span class="st">"sms"</span>    <span class="st">"z"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> maxsum</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">7</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>     height         weight</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="fl">58.0</span>   Min.   <span class="sc">:</span><span class="fl">115.0</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="fl">61.5</span>   1st Qu.<span class="sc">:</span><span class="fl">124.5</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="fl">65.0</span>   Median <span class="sc">:</span><span class="fl">135.0</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span><span class="fl">65.0</span>   Mean   <span class="sc">:</span><span class="fl">136.7</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span><span class="fl">68.5</span>   3rd Qu.<span class="sc">:</span><span class="fl">148.0</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="fl">72.0</span>   Max.   <span class="sc">:</span><span class="fl">164.0</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">rm</span>(summary.data.frame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="page-columns page-full"><p>At the browser prompt one can enter any R expression, so for example <code>ls()</code> lists the objects in the current frame, and entering the name of an object will<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> print it. The following commands are also accepted</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;With the exceptions of the commands listed below: an object of such a name can be printed <em>via</em> an explicit call to <code>print</code>.</p></li></div></div>
<ul>
<li><p><code>n</code></p>
<p>Enter ‘step-through’ mode. In this mode, hitting return executes the next line of code (more precisely one line and any continuation lines). Typing <code>c</code> will continue to the end of the current context, e.g.&nbsp;to the end of the current loop or function.</p></li>
<li><p><code>c</code></p>
<p>In normal mode, this quits the browser and continues execution, and just return works in the same way. <code>cont</code> is a synonym.</p></li>
<li><p><code>where</code></p>
<p>This prints the call stack. For example</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(women)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Called from<span class="sc">:</span> <span class="fu">summary.data.frame</span>(women)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> where</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>where <span class="dv">1</span><span class="sc">:</span> <span class="fu">summary.data.frame</span>(women)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>where <span class="dv">2</span><span class="sc">:</span> <span class="fu">summary</span>(women)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><code>Q</code></p>
<p>Quit both the browser and the current expression, and return to the top-level prompt.</p></li>
</ul>
<p>Errors in code executed at the browser prompt will normally return control to the browser prompt. Objects can be altered by assignment, and will keep their changed values when the browser is exited. If really necessary, objects can be assigned to the workspace from the browser prompt (by using <code>&lt;&lt;-</code> if the name is not already in scope).</p>
</section>
<section id="debugging-r-code" class="level2 section" data-number="4.2">
<h2 class="section anchored" data-number="4.2" data-anchor-id="debugging-r-code"><span class="header-section-number">4.2</span> Debugging R code</h2>
<p>Suppose your R program gives an error message. The first thing to find out is what R was doing at the time of the error, and the most useful tool is <code>traceback()</code>. We suggest that this is run whenever the cause of the error is not immediately obvious. Errors are often reported to the R mailing lists as being in some package when <code>traceback()</code> would show that the error was being reported by some other package or base R. Here is an example from the regression suite.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> success <span class="op">&lt;-</span> c<span class="op">(</span><span class="dv">13</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="dv">11</span><span class="op">,</span><span class="dv">14</span><span class="op">,</span><span class="dv">14</span><span class="op">,</span><span class="dv">11</span><span class="op">,</span><span class="dv">13</span><span class="op">,</span><span class="dv">11</span><span class="op">,</span><span class="dv">12</span><span class="op">)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> failure <span class="op">&lt;-</span> c<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">2</span><span class="op">)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> resp <span class="op">&lt;-</span> cbind<span class="op">(</span>success<span class="op">,</span> failure<span class="op">)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> predictor <span class="op">&lt;-</span> c<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">5</span><span class="op">^(</span><span class="dv">0</span><span class="op">:</span><span class="dv">7</span><span class="op">))</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> glm<span class="op">(</span>resp <span class="op">~</span> <span class="dv">0</span><span class="op">+</span>predictor<span class="op">,</span> family <span class="op">=</span> binomial<span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">))</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>Error<span class="op">:</span> no valid set of coefficients has been found<span class="op">:</span> please supply starting values</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> traceback<span class="op">()</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="op">:</span> stop<span class="op">(</span><span class="st">"no valid set of coefficients has been found: please supply</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>         starting values<span class="st">", call. = FALSE)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="op">:</span> glm<span class="op">.</span>fit<span class="op">(</span>x <span class="op">=</span> X<span class="op">,</span> y <span class="op">=</span> Y<span class="op">,</span> weights <span class="op">=</span> weights<span class="op">,</span> start <span class="op">=</span> start<span class="op">,</span> etastart <span class="op">=</span> etastart<span class="op">,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>       mustart <span class="op">=</span> mustart<span class="op">,</span> offset <span class="op">=</span> offset<span class="op">,</span> family <span class="op">=</span> family<span class="op">,</span> control <span class="op">=</span> control<span class="op">,</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>       intercept <span class="op">=</span> attr<span class="op">(</span>mt<span class="op">,</span> <span class="st">"intercept"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">:</span> glm<span class="op">(</span>resp <span class="op">~</span> <span class="dv">0</span> <span class="op">+</span> predictor<span class="op">,</span> family <span class="op">=</span> binomial<span class="op">(</span>link <span class="op">=</span><span class="st">"log"</span><span class="op">))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The calls to the active frames are given in reverse order (starting with the innermost). So we see the error message comes from an explicit check in <code>glm.fit</code>. (<code>traceback()</code> shows you all the lines of the function calls, which can be limited by setting <code>option</code> <code>"deparse.max.lines"</code>.)</p>
<p>Sometimes the traceback will indicate that the error was detected inside compiled code, for example (from <code>?nls</code>)</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">nls</span>(y <span class="sc">~</span> a <span class="sc">+</span> b <span class="sc">*</span> x, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="fl">0.12345</span>, <span class="at">b =</span> <span class="fl">0.54321</span>), <span class="at">trace =</span> <span class="cn">TRUE</span>) <span class="sc">:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        step factor <span class="fl">0.000488281</span> reduced below <span class="st">'minFactor'</span> of <span class="fl">0.000976563</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>  <span class="fu">traceback</span>()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="fu">.Call</span>(R_nls_iter, m, ctrl, trace)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="fu">nls</span>(y <span class="sc">~</span> a <span class="sc">+</span> b <span class="sc">*</span> x, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="fl">0.12345</span>, <span class="at">b =</span> <span class="fl">0.54321</span>), <span class="at">trace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will be the case if the innermost call is to <code>.C</code>, <code>.Fortran</code>, <code>.Call</code>, <code>.External</code> or <code>.Internal</code>, but as it is also possible for such code to evaluate R expressions, this need not be the innermost call, as in</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">traceback</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span><span class="sc">:</span> <span class="fu">gm</span>(a, b, x)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span><span class="sc">:</span> <span class="fu">.Call</span>(R_numeric_deriv, expr, theta, rho, dir)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span><span class="sc">:</span> <span class="fu">numericDeriv</span>(form[[<span class="dv">3</span>]], <span class="fu">names</span>(ind), env)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="fu">getRHS</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> <span class="fu">assign</span>(<span class="st">"rhs"</span>, <span class="fu">getRHS</span>(), <span class="at">envir =</span> thisEnv)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="fu">assign</span>(<span class="st">"resid"</span>, .swts <span class="sc">*</span> (lhs <span class="sc">-</span> <span class="fu">assign</span>(<span class="st">"rhs"</span>, <span class="fu">getRHS</span>(), <span class="at">envir =</span> thisEnv)),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">envir =</span> thisEnv)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="cf">function</span> (newPars)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>   {</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">setPars</span>(newPars)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(<span class="st">"resid"</span>, .swts <span class="sc">*</span> (lhs <span class="sc">-</span> <span class="fu">assign</span>(<span class="st">"rhs"</span>, <span class="fu">getRHS</span>(), <span class="at">envir =</span> thisEnv)),</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">envir =</span> thisEnv)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(<span class="st">"dev"</span>, <span class="fu">sum</span>(resid<span class="sc">^</span><span class="dv">2</span>), <span class="at">envir =</span> thisEnv)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(<span class="st">"QR"</span>, <span class="fu">qr</span>(.swts <span class="sc">*</span> <span class="fu">attr</span>(rhs, <span class="st">"gradient"</span>)), <span class="at">envir =</span> thisEnv)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">return</span>(QR<span class="sc">$</span>rank <span class="sc">&lt;</span> <span class="fu">min</span>(<span class="fu">dim</span>(QR<span class="sc">$</span>qr)))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>   }(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.00760232418963883</span>, <span class="fl">1.00119632515036</span>))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="fu">.Call</span>(R_nls_iter, m, ctrl, trace)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="fu">nls</span>(yeps <span class="sc">~</span> <span class="fu">gm</span>(a, b, x), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="fl">0.12345</span>, <span class="at">b =</span> <span class="fl">0.54321</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Occasionally <code>traceback()</code> does not help, and this can be the case if S4 method dispatch is involved. Consider the following example</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> xyd <span class="op">&lt;-</span> new<span class="op">(</span><span class="st">"xyloc"</span><span class="op">,</span> x<span class="op">=</span>runif<span class="op">(</span><span class="dv">20</span><span class="op">),</span> y<span class="op">=</span>runif<span class="op">(</span><span class="dv">20</span><span class="op">))</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Error in as<span class="op">.</span>environment<span class="op">(</span>pkg<span class="op">)</span> <span class="op">:</span> no item called <span class="st">"package:S4nswv"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>on the search list</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>Error in initialize<span class="op">(</span>value<span class="op">,</span> <span class="op">...)</span> <span class="op">:</span> S language method selection got</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>an error when called from internal dispatch <span class="cf">for</span> function 'initialize'</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> traceback<span class="op">()</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="op">:</span> initialize<span class="op">(</span>value<span class="op">,</span> <span class="op">...)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">:</span> new<span class="op">(</span><span class="st">"xyloc"</span><span class="op">,</span> x <span class="op">=</span> runif<span class="op">(</span><span class="dv">20</span><span class="op">),</span> y <span class="op">=</span> runif<span class="op">(</span><span class="dv">20</span><span class="op">))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which does not help much, as there is no call to <code>as.environment</code> in <code>initialize</code> (and the note “called from internal dispatch” tells us so). In this case we searched the R sources for the quoted call, which occurred in only one place, <code>methods:::.asEnvironmentPackage</code>. So now we knew where the error was occurring. (This was an unusually opaque example.)</p>
<p>The error message</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>evaluation nested too deeply<span class="sc">:</span> infinite recursion <span class="sc">/</span> <span class="fu">options</span>(<span class="at">expressions=</span>)?</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>can be hard to handle with the default value (5000). Unless you know that there actually is deep recursion going on, it can help to set something like</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">expressions=</span><span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and re-run the example showing the error.</p>
<p>Sometimes there is warning that clearly is the precursor to some later error, but it is not obvious where it is coming from. Setting <code>options(warn = 2)</code> (which turns warnings into errors) can help here.</p>
<p>Once we have located the error, we have some choices. One way to proceed is to find out more about what was happening at the time of the crash by looking a <em>post-mortem</em> dump. To do so, set <code>options(error=dump.frames)</code> and run the code again. Then invoke <code>debugger()</code> and explore the dump. Continuing our example:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">options</span>(<span class="at">error =</span> dump.frames)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">glm</span>(resp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> predictor, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span><span class="st">"log"</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>Error<span class="sc">:</span> no valid set of coefficients has been found<span class="sc">:</span> please supply starting values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which is the same as before, but an object called <code>last.dump</code> has appeared in the workspace. (Such objects can be large, so remove it when it is no longer needed.) We can examine this at a later time by calling the function <code>debugger</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">debugger</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Message<span class="sc">:</span>  Error<span class="sc">:</span> no valid set of coefficients has been found<span class="sc">:</span> please supply starting values</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>Available environments had calls<span class="sc">:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="fu">glm</span>(resp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> predictor, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="fu">glm.fit</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">weights =</span> weights, <span class="at">start =</span> start, <span class="at">etastart =</span> etastart, mus</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="fu">stop</span>(<span class="st">"no valid set of coefficients has been found: please supply starting values</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="st">Enter an environment number, or 0 to exit  Selection:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which gives the same sequence of calls as <code>traceback</code>, but in outer-first order and with only the first line of the call, truncated to the current width. However, we can now examine in more detail what was happening at the time of the error. Selecting an environment opens the browser in that frame. So we select the function call which spawned the error message, and explore some of the variables (and execute two function calls).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Enter an environment number<span class="op">,</span> or <span class="dv">0</span> to exit  Selection<span class="op">:</span> <span class="dv">2</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Browsing in the environment with call<span class="op">:</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>   glm<span class="op">.</span>fit<span class="op">(</span>x <span class="op">=</span> X<span class="op">,</span> y <span class="op">=</span> Y<span class="op">,</span> weights <span class="op">=</span> weights<span class="op">,</span> start <span class="op">=</span> start<span class="op">,</span> etas</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>Called from<span class="op">:</span> debugger<span class="op">.</span>look<span class="op">(</span>ind<span class="op">)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span> ls<span class="op">()</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a> <span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="st">"aic"</span>        <span class="st">"boundary"</span>   <span class="st">"coefold"</span>    <span class="st">"control"</span>    <span class="st">"conv"</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a> <span class="op">[</span><span class="dv">6</span><span class="op">]</span> <span class="st">"dev"</span>        <span class="st">"dev.resids"</span> <span class="st">"devold"</span>     <span class="st">"EMPTY"</span>      <span class="st">"eta"</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="dv">11</span><span class="op">]</span> <span class="st">"etastart"</span>   <span class="st">"family"</span>     <span class="st">"fit"</span>        <span class="st">"good"</span>       <span class="st">"intercept"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="dv">16</span><span class="op">]</span> <span class="st">"iter"</span>       <span class="st">"linkinv"</span>    <span class="st">"mu"</span>         <span class="st">"mu.eta"</span>     <span class="st">"mu.eta.val"</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="dv">21</span><span class="op">]</span> <span class="st">"mustart"</span>    <span class="st">"n"</span>          <span class="st">"ngoodobs"</span>   <span class="st">"nobs"</span>       <span class="st">"nvars"</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="dv">26</span><span class="op">]</span> <span class="st">"offset"</span>     <span class="st">"start"</span>      <span class="st">"valideta"</span>   <span class="st">"validmu"</span>    <span class="st">"variance"</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="dv">31</span><span class="op">]</span> <span class="st">"varmu"</span>      <span class="st">"w"</span>          <span class="st">"weights"</span>    <span class="st">"x"</span>          <span class="st">"xnames"</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="dv">36</span><span class="op">]</span> <span class="st">"y"</span>          <span class="st">"ynames"</span>     <span class="st">"z"</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span> eta</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>             <span class="dv">2</span>             <span class="dv">3</span>             <span class="dv">4</span>             <span class="dv">5</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a> <span class="fl">0.000000e+00</span> <span class="op">-</span><span class="fl">2.235357e-06</span> <span class="op">-</span><span class="fl">1.117679e-05</span> <span class="op">-</span><span class="fl">5.588393e-05</span> <span class="op">-</span><span class="fl">2.794197e-04</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="dv">6</span>             <span class="dv">7</span>             <span class="dv">8</span>             <span class="dv">9</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="fl">1.397098e-03</span> <span class="op">-</span><span class="fl">6.985492e-03</span> <span class="op">-</span><span class="fl">3.492746e-02</span> <span class="op">-</span><span class="fl">1.746373e-01</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span> valideta<span class="op">(</span>eta<span class="op">)</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="dv">1</span><span class="op">]</span> TRUE</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span> mu</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>         <span class="dv">2</span>         <span class="dv">3</span>         <span class="dv">4</span>         <span class="dv">5</span>         <span class="dv">6</span>         <span class="dv">7</span>         <span class="dv">8</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="fl">1.0000000</span> <span class="fl">0.9999978</span> <span class="fl">0.9999888</span> <span class="fl">0.9999441</span> <span class="fl">0.9997206</span> <span class="fl">0.9986039</span> <span class="fl">0.9930389</span> <span class="fl">0.9656755</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        <span class="dv">9</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="fl">0.8397616</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span> validmu<span class="op">(</span>mu<span class="op">)</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="dv">1</span><span class="op">]</span> FALSE</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span> c</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>Available environments had calls<span class="op">:</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">:</span> glm<span class="op">(</span>resp <span class="op">~</span> <span class="dv">0</span> <span class="op">+</span> predictor<span class="op">,</span> family <span class="op">=</span> binomial<span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">))</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="op">:</span> glm<span class="op">.</span>fit<span class="op">(</span>x <span class="op">=</span> X<span class="op">,</span> y <span class="op">=</span> Y<span class="op">,</span> weights <span class="op">=</span> weights<span class="op">,</span> start <span class="op">=</span> start<span class="op">,</span> etastart <span class="op">=</span> etastart</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="op">:</span> stop<span class="op">(</span><span class="st">"no valid set of coefficients has been found: please supply starting v</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>Enter an environment number<span class="op">,</span> or <span class="dv">0</span> to exit  Selection<span class="op">:</span> <span class="dv">0</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> rm<span class="op">(</span>last<span class="op">.</span>dump<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Because <code>last.dump</code> can be looked at later or even in another R session, post-mortem debugging is possible even for batch usage of R. We do need to arrange for the dump to be saved: this can be done either using the command-line flag <code>--save</code> to save the workspace at the end of the run, or <em>via</em> a setting such as</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">options</span>(<span class="at">error =</span> <span class="fu">quote</span>({<span class="fu">dump.frames</span>(<span class="at">to.file=</span><span class="cn">TRUE</span>); <span class="fu">q</span>()}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See the help on <code>dump.frames</code> for further options and a worked example.</p>
<p>An alternative error action is to use the function <code>recover()</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">options</span>(<span class="at">error =</span> recover)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">glm</span>(resp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> predictor, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>Error<span class="sc">:</span> no valid set of coefficients has been found<span class="sc">:</span> please supply starting values</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>Enter a frame number, or <span class="dv">0</span> to exit</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="fu">glm</span>(resp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> predictor, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="fu">glm.fit</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">weights =</span> weights, <span class="at">start =</span> start, <span class="at">etastart =</span> etastart</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>Selection<span class="sc">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which is very similar to <code>dump.frames</code>. However, we can examine the state of the program directly, without dumping and re-loading the dump. As its help page says, <code>recover</code> can be routinely used as the error action in place of <code>dump.calls</code> and <code>dump.frames</code>, since it behaves like <code>dump.frames</code> in non-interactive use.</p>
<p>Post-mortem debugging is good for finding out exactly what went wrong, but not necessarily why. An alternative approach is to take a closer look at what was happening just before the error, and a good way to do that is to use <code>debug</code>. This inserts a call to the browser at the beginning of the function, starting in step-through mode. So in our example we could use</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> debug<span class="op">(</span>glm<span class="op">.</span>fit<span class="op">)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> glm<span class="op">(</span>resp <span class="op">~</span> <span class="dv">0</span> <span class="op">+</span> predictor<span class="op">,</span> family <span class="op">=</span> binomial<span class="op">(</span>link <span class="op">=</span><span class="st">"log"</span><span class="op">))</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>debugging in<span class="op">:</span> glm<span class="op">.</span>fit<span class="op">(</span>x <span class="op">=</span> X<span class="op">,</span> y <span class="op">=</span> Y<span class="op">,</span> weights <span class="op">=</span> weights<span class="op">,</span> start <span class="op">=</span> start<span class="op">,</span> etastart <span class="op">=</span> etastart<span class="op">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    mustart <span class="op">=</span> mustart<span class="op">,</span> offset <span class="op">=</span> offset<span class="op">,</span> family <span class="op">=</span> family<span class="op">,</span> control <span class="op">=</span> control<span class="op">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    intercept <span class="op">=</span> attr<span class="op">(</span>mt<span class="op">,</span> <span class="st">"intercept"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>debug<span class="op">:</span> <span class="op">{</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="er">## lists the whole function</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>debug<span class="op">:</span> x <span class="op">&lt;-</span> as<span class="op">.</span>matrix<span class="op">(</span>x<span class="op">)</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span> start</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">-</span><span class="fl">2.235357e-06</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>debug<span class="op">:</span> eta <span class="op">&lt;-</span> drop<span class="op">(</span>x <span class="op">%*%</span> start<span class="op">)</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span> eta</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span>             <span class="dv">2</span>             <span class="dv">3</span>             <span class="dv">4</span>             <span class="dv">5</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a> <span class="fl">0.000000e+00</span> <span class="op">-</span><span class="fl">2.235357e-06</span> <span class="op">-</span><span class="fl">1.117679e-05</span> <span class="op">-</span><span class="fl">5.588393e-05</span> <span class="op">-</span><span class="fl">2.794197e-04</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>            <span class="dv">6</span>             <span class="dv">7</span>             <span class="dv">8</span>             <span class="dv">9</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="op">-</span><span class="fl">1.397098e-03</span> <span class="op">-</span><span class="fl">6.985492e-03</span> <span class="op">-</span><span class="fl">3.492746e-02</span> <span class="op">-</span><span class="fl">1.746373e-01</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>debug<span class="op">:</span> mu <span class="op">&lt;-</span> linkinv<span class="op">(</span>eta <span class="op">&lt;-</span> eta <span class="op">+</span> offset<span class="op">)</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span> mu</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>         <span class="dv">2</span>         <span class="dv">3</span>         <span class="dv">4</span>         <span class="dv">5</span>         <span class="dv">6</span>         <span class="dv">7</span>         <span class="dv">8</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="fl">1.0000000</span> <span class="fl">0.9999978</span> <span class="fl">0.9999888</span> <span class="fl">0.9999441</span> <span class="fl">0.9997206</span> <span class="fl">0.9986039</span> <span class="fl">0.9930389</span> <span class="fl">0.9656755</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        <span class="dv">9</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="fl">0.8397616</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(The prompt <code>Browse[1]&gt;</code> indicates that this is the first level of browsing: it is possible to step into another function that is itself being debugged or contains a call to <code>browser()</code>.)</p>
<p><code>debug</code> can be used for hidden functions and S3 methods by e.g. <code>debug(stats:::predict.Arima)</code>. (It cannot be used for S4 methods, but an alternative is given on the help page for <code>debug</code>.) Sometimes you want to debug a function defined inside another function, e.g.&nbsp;the function <code>arimafn</code> defined inside <code>arima</code>. To do so, set <code>debug</code> on the outer function (here <code>arima</code>) and step through it until the inner function has been defined. Then call <code>debug</code> on the inner function (and use <code>c</code> to get out of step-through mode in the outer function).</p>
<p>To remove debugging of a function, call <code>undebug</code> with the argument previously given to <code>debug</code>; debugging otherwise lasts for the rest of the R session (or until the function is edited or otherwise replaced).</p>
<p><code>trace</code> can be used to temporarily insert debugging code into a function, for example to insert a call to <code>browser()</code> just before the point of the error. To return to our running example</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="er">## first get a numbered listing of the expressions of the function</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> page<span class="op">(</span>as<span class="op">.</span>list<span class="op">(</span>body<span class="op">(</span>glm<span class="op">.</span>fit<span class="op">)),</span> method<span class="op">=</span><span class="st">"print"</span><span class="op">)</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> trace<span class="op">(</span>glm<span class="op">.</span>fit<span class="op">,</span> browser<span class="op">,</span> at<span class="op">=</span><span class="dv">22</span><span class="op">)</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>Tracing function <span class="st">"glm.fit"</span> in package <span class="st">"stats"</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="st">"glm.fit"</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> glm<span class="op">(</span>resp <span class="op">~</span> <span class="dv">0</span> <span class="op">+</span> predictor<span class="op">,</span> family <span class="op">=</span> binomial<span class="op">(</span>link <span class="op">=</span><span class="st">"log"</span><span class="op">))</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>Tracing glm<span class="op">.</span>fit<span class="op">(</span>x <span class="op">=</span> X<span class="op">,</span> y <span class="op">=</span> Y<span class="op">,</span> weights <span class="op">=</span> weights<span class="op">,</span> start <span class="op">=</span> start<span class="op">,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>   etastart <span class="op">=</span> etastart<span class="op">,</span>  <span class="op">....</span> step <span class="dv">22</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>Called from<span class="op">:</span> eval<span class="op">(</span>expr<span class="op">,</span> envir<span class="op">,</span> enclos<span class="op">)</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>Browse<span class="op">[</span><span class="dv">1</span><span class="op">]&gt;</span> n</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="er">## and single-step from here.</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> untrace<span class="op">(</span>glm<span class="op">.</span>fit<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For your own functions, it may be as easy to use <code>fix</code> to insert temporary code, but <code>trace</code> can help with functions in a namespace (as can <code>fixInNamespace</code>). Alternatively, use <code>trace(,edit=TRUE)</code> to insert code visually.</p>
</section>
<section id="checking-memory-access" class="level2 section page-columns page-full" data-number="4.3">
<h2 class="section anchored" data-number="4.3" data-anchor-id="checking-memory-access"><span class="header-section-number">4.3</span> Checking memory access</h2>
<p>Errors in memory allocation and reading/writing outside arrays are very common causes of crashes (e.g., segfaults) on some machines. Often the crash appears long after the invalid memory access: in particular damage to the structures which R itself has allocated may only become apparent at the next garbage collection (or even at later garbage collections after objects have been deleted).</p>
<p>Note that memory access errors may be seen with LAPACK, BLAS, OpenMP and Java-using packages: some at least of these seem to be intentional, and some are related to passing characters to Fortran.</p>
<p>Some of these tools can detect mismatched allocation and deallocation. C++ programmers should note that memory allocated by <code>new []</code> must be freed by <code>delete []</code>, other uses of <code>new</code> by <code>delete</code>, and memory allocated by <code>malloc</code>, <code>calloc</code> and <code>realloc</code> by <code>free</code>. Some platforms will tolerate mismatches (perhaps with memory leaks) but others will segfault.</p>
<section id="using-gctorture" class="level3 subsection" data-number="4.3.1">
<h3 class="subsection anchored" data-number="4.3.1" data-anchor-id="using-gctorture"><span class="header-section-number">4.3.1</span> Using gctorture</h3>
<p>We can help to detect memory problems in R objects earlier by running garbage collection as often as possible. This is achieved by <code>gctorture(TRUE)</code>, which as described on its help page</p>
<blockquote class="blockquote">
<p>Provokes garbage collection on (nearly) every memory allocation. Intended to ferret out memory protection bugs. Also makes R run <em>very</em> slowly, unfortunately.</p>
</blockquote>
<p>The reference to ‘memory protection’ is to missing C-level calls to <code>PROTECT</code>/<code>UNPROTECT</code> (see <a href="System-and-foreign-language-interfaces.html#garbage-collection">Garbage Collection</a>) which if missing allow R objects to be garbage-collected when they are still in use. But it can also help with other memory-related errors.</p>
<p>Normally running under <code>gctorture(TRUE)</code> will just produce a crash earlier in the R program, hopefully close to the actual cause. See the next section for how to decipher such crashes.</p>
<p>It is possible to run all the examples, tests and vignettes covered by <code>R CMD check</code> under <code>gctorture(TRUE)</code> by using the option <code>--use-gct</code>.</p>
<p>The function <code>gctorture2</code> provides more refined control over the GC torture process. Its arguments <code>step</code>, <code>wait</code> and <code>inhibit_release</code> are documented on its help page. Environment variables can also be used at the start of the R session to turn on GC torture: <code>R_GCTORTURE</code> corresponds to the <code>step</code> argument to <code>gctorture2</code>, <code>R_GCTORTURE_WAIT</code> to <code>wait</code>, and <code>R_GCTORTURE_INHIBIT_RELEASE</code> to <code>inhibit_release</code>.</p>
<p>If R is configured with <code>--enable-strict-barrier</code> then a variety of tests for the integrity of the write barrier are enabled. In addition tests to help detect protect issues are enabled:</p>
<ul>
<li>All GCs are full GCs.</li>
<li>New nodes in small node pages are marked as <code>NEWSXP</code> on creation.</li>
<li>After a GC all free nodes that are not of type <code>NEWSXP</code> are marked as type <code>FREESXP</code> and their previous type is recorded.</li>
<li>Most calls to accessor functions check their <code>SEXP</code> inputs and <code>SEXP</code> outputs and signal an error if a <code>FREESXP</code> is found. The address of the node and the old type are included in the error message.</li>
</ul>
<p><code>R CMD check --use-gct</code> can be set to use <var>gctorture2(``n</var><code>)</code> rather than <code>gctorture(TRUE)</code> by setting environment variable <code>_R_CHECK_GCT_N_</code> to a positive integer value to be used as <var>n</var>.</p>
<p>Used with a debugger and with <code>gctorture</code> or <code>gctorture2</code> this mechanism can be helpful in isolating memory protect problems.</p>
</section>
<section id="using-valgrind" class="level3 subsection page-columns page-full" data-number="4.3.2">
<h3 class="subsection anchored" data-number="4.3.2" data-anchor-id="using-valgrind"><span class="header-section-number">4.3.2</span> Using valgrind</h3>
<div class="page-columns page-full"><p>If you have access to Linux on a common CPU type or supported versions of FreeBSD or Solaris<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> you can use <code>valgrind</code> (<a href="https://valgrind.org/" class="uri">https://valgrind.org/</a>, pronounced to rhyme with ‘tinned’) to check for possible problems. To run some examples under <code>valgrind</code> use something like</p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;The macOS support is for long-obsolete versions.</p></li></div></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>R <span class="sc">-</span>d valgrind <span class="sc">--</span>vanilla <span class="sc">&lt;</span> mypkg<span class="sc">-</span>Ex.R</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>R <span class="sc">-</span>d <span class="st">"valgrind --tool=memcheck --leak-check=full"</span> <span class="sc">--</span>vanilla <span class="sc">&lt;</span> mypkg<span class="sc">-</span>Ex.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where <code>mypkg-Ex.R</code> is a set of examples, e.g.&nbsp;the file created in <code>mypkg.Rcheck</code> by <code>R CMD check</code>. Occasionally this reports memory reads of ‘uninitialised values’ that are the result of compiler optimization, so can be worth checking under an unoptimized compile: for maximal information use a build with debugging symbols. We know there will be some small memory leaks from <code>readline</code> and R itself — these are memory areas that are in use right up to the end of the R session. Expect this to run around 20x slower than without <code>valgrind</code>, and in some cases much slower than that. Several versions of <code>valgrind</code> were not happy with some optimized BLASes that use CPU-specific instructions so you may need to build a version of R specifically to use with <code>valgrind</code>.</p>
<div class="page-columns page-full"><p>On platforms where <code>valgrind</code> is installed you can build a version of R with extra instrumentation to help <code>valgrind</code> detect errors in the use of memory allocated from the R heap. The <code>configure</code> option is <var>--with-valgrind-instrumentation=``level</var>, where <var>level</var> is 0, 1 or 2. Level 0 is the default and does not add anything. Level 1 will detect some uses<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> of uninitialised memory and has little impact on speed (compared to level 0). Level 2 will detect many other memory-use bugs<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> but make R much slower when running under <code>valgrind</code>. Using this in conjunction with <code>gctorture</code> can be even more effective (and even slower).</p><div class="no-row-height column-margin column-container"><li id="fn3"><p><sup>3</sup>&nbsp;Those in some numeric, logical, integer, raw, complex vectors and in memory allocated by <code>R_alloc</code>.</p></li><li id="fn4"><p><sup>4</sup>&nbsp;including using the data sections of R vectors after they are freed.</p></li></div></div>
<p>An example of <code>valgrind</code> output is</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span> Invalid read of size <span class="dv">4</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    at <span class="dv">0x1CDF6CBE</span><span class="sc">:</span> <span class="fu">csc_compTr</span> (Mutils.c<span class="sc">:</span><span class="dv">273</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x1CE07E1E</span><span class="sc">:</span> <span class="fu">tsc_transpose</span> (dtCMatrix.c<span class="sc">:</span><span class="dv">25</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x80A67A7</span><span class="sc">:</span> <span class="fu">do_dotcall</span> (dotcode.c<span class="sc">:</span><span class="dv">858</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x80CACE2</span><span class="sc">:</span> <span class="fu">Rf_eval</span> (eval.c<span class="sc">:</span><span class="dv">400</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x80CB5AF</span><span class="sc">:</span> <span class="fu">R_execClosure</span> (eval.c<span class="sc">:</span><span class="dv">658</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x80CB98E</span><span class="sc">:</span> <span class="fu">R_execMethod</span> (eval.c<span class="sc">:</span><span class="dv">760</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x1B93DEFA</span><span class="sc">:</span> <span class="fu">R_standardGeneric</span> (methods_list_dispatch.c<span class="sc">:</span><span class="dv">624</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x810262E</span><span class="sc">:</span> <span class="fu">do_standardGeneric</span> (objects.c<span class="sc">:</span><span class="dv">1012</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x80CAD23</span><span class="sc">:</span> <span class="fu">Rf_eval</span> (eval.c<span class="sc">:</span><span class="dv">403</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x80CB2F0</span><span class="sc">:</span> <span class="fu">Rf_applyClosure</span> (eval.c<span class="sc">:</span><span class="dv">573</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x80CADCC</span><span class="sc">:</span> <span class="fu">Rf_eval</span> (eval.c<span class="sc">:</span><span class="dv">414</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>    by <span class="dv">0x80CAA03</span><span class="sc">:</span> <span class="fu">Rf_eval</span> (eval.c<span class="sc">:</span><span class="dv">362</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="dv">12539</span><span class="sc">==</span>  Address <span class="dv">0x1C0D2EA8</span> is <span class="dv">280</span> bytes inside a block of size <span class="dv">1996</span> alloc<span class="st">'d</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="st">==12539==    at 0x1B9008D1: malloc (vg_replace_malloc.c:149)</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="st">==12539==    by 0x80F1B34: GetNewPage (memory.c:610)</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="st">==12539==    by 0x80F7515: Rf_allocVector (memory.c:1915)</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="st">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This example is from an instrumented version of R, while tracking down a bug in the <a href="https://CRAN.R-project.org/package=Matrix"><strong>Matrix</strong></a> package in 2006. The first line indicates that R has tried to read 4 bytes from a memory address that it does not have access to. This is followed by a C stack trace showing where the error occurred. Next is a description of the memory that was accessed. It is inside a block allocated by <code>malloc</code>, called from <code>GetNewPage</code>, that is, in the internal R heap. Since this memory all belongs to R, <code>valgrind</code> would not (and did not) detect the problem in an uninstrumented build of R. In this example the stack trace was enough to isolate and fix the bug, which was in <code>tsc_transpose</code>, and in this example running under <code>gctorture()</code> did not provide any additional information.</p>
<div class="page-columns page-full"><p><code>valgrind</code> is good at spotting the use of uninitialized values: use option <code>--track-origins=yes</code> to show where these originated from. What it cannot detect is the misuse of arrays allocated on the stack: this includes C automatic variables and some<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> Fortran arrays.</p><div class="no-row-height column-margin column-container"><li id="fn5"><p><sup>5</sup>&nbsp;small fixed-size arrays by default in <code>gfortran</code>, for example.</p></li></div></div>
<p>It is possible to run all the examples, tests and vignettes covered by <code>R CMD check</code> under <code>valgrind</code> by using the option <code>--use-valgrind</code>. If you do this you will need to select the <code>valgrind</code> options some other way, for example by having a <code>~/.valgrindrc</code> file containing</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>leak<span class="sc">-</span>check<span class="ot">=</span>full</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>track<span class="sc">-</span>origins<span class="ot">=</span>yes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or setting the environment variable <code>VALGRIND_OPTS</code>. As from R 4.2.0, <code>--use-valgrind</code> also uses <code>valgrind</code> when re-building the vignettes.</p>
<p>On macOS you may need to ensure that debugging symbols are made available (so <code>valgrind</code> reports line numbers in files). This can usually be done with the <code>valgrind</code> option <code>--dsymutil=yes</code> to ask for the symbols to be dumped when the <code>.so</code> file is loaded. This will not work where packages are installed into a system area (such as the <code>R.framework</code>) and can be slow. Installing packages with <code>R CMD INSTALL --dsym</code> installs the dumped symbols. (This can also be done by setting environment variable <code>PKG_MAKE_DSYM</code> to a non-empty value before the <code>INSTALL</code>.)</p>
<p>This section has described the use of <code>memtest</code>, the default (and most useful) of <code>valgrind</code>s tools. There are others described in its documentation: <code>helgrind</code> can be useful for threaded programs.</p>
</section>
<section id="using-the-address-sanitizer" class="level3 subsection page-columns page-full" data-number="4.3.3">
<h3 class="subsection anchored" data-number="4.3.3" data-anchor-id="using-the-address-sanitizer"><span class="header-section-number">4.3.3</span> Using the Address Sanitizer</h3>
<div class="page-columns page-full"><p><code>AddressSanitizer</code> (‘ASan’) is a tool with similar aims to the memory checker in <code>valgrind</code>. It is available with suitable builds<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> of <code>gcc</code> and <code>clang</code> on common Linux and macOS platforms. See <a href="https://clang.llvm.org/docs/UsersManual.html#controlling-code-generation" class="uri">https://clang.llvm.org/docs/UsersManual.html#controlling-code-generation</a>, <a href="https://clang.llvm.org/docs/AddressSanitizer.html" class="uri">https://clang.llvm.org/docs/AddressSanitizer.html</a> and <a href="https://github.com/google/sanitizers" class="uri">https://github.com/google/sanitizers</a>.</p><div class="no-row-height column-margin column-container"><li id="fn6"><p><sup>6</sup>&nbsp;currently on <code>x86_64</code>/<code>ix86</code> Linux and FreeBSD, with some support for Intel macOS but not with the toolchain normally used with R. (There is a faster variant, HWASAN, for <code>aarch64</code> only.) On some platforms the runtime library, <strong>libasan</strong>, needs to be installed separately, and for checking C++ you may also need <strong>libubsan</strong>.</p></li></div></div>
<div class="page-columns page-full"><p>More thorough checks of C++ code are done if the C++ library has been ‘annotated’: at the time of writing this applied to <code>std::vector</code> in <code>libc++</code> for use with <code>clang</code> and gives rise to <code>container-overflow</code><a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> reports.</p><div class="no-row-height column-margin column-container"><li id="fn7"><p><sup>7</sup>&nbsp;see <a href="https://llvm.org/devmtg/2014-04/PDFs/LightningTalks/EuroLLVM%202014%20--%20container%20overflow.pdf" class="uri">https://llvm.org/devmtg/2014-04/PDFs/LightningTalks/EuroLLVM%202014%20--%20container%20overflow.pdf</a>.</p></li></div></div>
<p>It requires code to have been compiled <em>and linked</em> with <code>-fsanitize=address</code> and compiling with <code>-fno-omit-frame-pointer</code> will give more legible reports. It has a runtime penalty of 2–3x, extended compilation times and uses substantially more memory, often 1–2GB, at run time. On 64-bit platforms it reserves (but does not allocate) 16–20TB of virtual memory: restrictive shell settings can cause problems.</p>
<p>By comparison with <code>valgrind</code>, ASan can detect misuse of stack and global variables but not the use of uninitialized memory.</p>
<div class="page-columns page-full"><p>Recent versions return symbolic addresses for the location of the error provided <code>llvm-symbolizer</code><a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> is on the path: if it is available but not on the path or has been renamed<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>, one can use an environment variable, e.g.</p><div class="no-row-height column-margin column-container"><li id="fn8"><p><sup>8</sup>&nbsp;part of the LLVM project and distributed in <code>llvm</code> RPMs and <code>.deb</code>s on Linux. It is not currently shipped by Apple.</p></li><li id="fn9"><p><sup>9</sup>&nbsp;as Ubuntu has been said to do.</p></li></div></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ASAN_SYMBOLIZER_PATH<span class="ot">=</span><span class="er">/</span>path<span class="sc">/</span>to<span class="sc">/</span>llvm<span class="sc">-</span>symbolizer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="page-columns page-full"><p>An alternative is to pipe the output through <code>asan_symbolize.py</code><a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a> and perhaps then (for compiled C++ code) <code>c++filt</code>. (On macOS, you may need to run <code>dsymutil</code> to get line-number reports.)</p><div class="no-row-height column-margin column-container"><li id="fn10"><p><sup>10</sup>&nbsp;installed on some Linux systems as <code>asan_symbolize</code>, and obtainable from <a href="https://github.com/llvm/llvm-project/blob/main/compiler-rt/lib/asan/scripts/asan_symbolize.py" class="uri">https://github.com/llvm/llvm-project/blob/main/compiler-rt/lib/asan/scripts/asan_symbolize.py</a>: it makes use of <code>llvm-symbolizer</code> if available.</p></li></div></div>
<p>The simplest way to make use of this is to build a version of R with something like</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>CC<span class="op">=</span><span class="st">"gcc -std=gnu99 -fsanitize=address"</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>CFLAGS<span class="op">=</span><span class="st">"-fno-omit-frame-pointer -g -O2 -Wall -pedantic -mtune=native"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which will ensure that the <code>libasan</code> run-time library is compiled into the R executable. However this check can be enabled on a per-package basis by using a <code>~/.R/Makevars</code> file like</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>CC <span class="op">=</span> gcc <span class="op">-</span>std<span class="op">=</span>gnu99 <span class="op">-</span>fsanitize<span class="op">=</span>address <span class="op">-</span>fno<span class="op">-</span>omit<span class="op">-</span>frame<span class="op">-</span>pointer</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>CXX <span class="op">=</span> g<span class="op">++</span> <span class="op">-</span>fsanitize<span class="op">=</span>address <span class="op">-</span>fno<span class="op">-</span>omit<span class="op">-</span>frame<span class="op">-</span>pointer</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>FC <span class="op">=</span> gfortran <span class="op">-</span>fsanitize<span class="op">=</span>address</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(Note that <code>-fsanitize=address</code> has to be part of the compiler specification to ensure it is used for linking. These settings will not be honoured by packages which ignore <code>~/.R/Makevars</code>.) It will be necessary to build R with</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>MAIN_LDFLAGS <span class="ot">=</span> <span class="sc">-</span>fsanitize<span class="ot">=</span>address</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>to link the runtime libraries into the R executable if it was not specified as part of <code>CC</code> when R was built. (For some builds without OpenMP, <code>-pthread</code> is also required.)</p>
<p>For options available <em>via</em> the environment variable <code>ASAN_OPTIONS</code> see <a href="https://github.com/google/sanitizers/wiki/AddressSanitizerFlags" class="uri">https://github.com/google/sanitizers/wiki/AddressSanitizerFlags</a>. With <code>gcc</code> additional control is available <em>via</em> the <code>--param</code> flag: see its <code>man</code> page.</p>
<p>For more detailed information on an error, R can be run under a debugger with a breakpoint set before the address sanitizer report is produced: for <code>gdb</code> or <code>lldb</code> you could use</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span> __asan_report_error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(See <a href="https://github.com/google/sanitizers/wiki/AddressSanitizerAndDebugger" class="uri">https://github.com/google/sanitizers/wiki/AddressSanitizerAndDebugger</a>.)</p>
<div class="page-columns page-full"><p>More recent versions<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a> added the flag <code>-fsanitize-address-use-after-scope</code>: see <a href="https://github.com/google/sanitizers/wiki/AddressSanitizerUseAfterScope" class="uri">https://github.com/google/sanitizers/wiki/AddressSanitizerUseAfterScope</a>.</p><div class="no-row-height column-margin column-container"><li id="fn11"><p><sup>11</sup>&nbsp;including <code>gcc</code> 7.1 and <code>clang</code> 4.0.0: for <code>gcc</code> it is implied by <code>-fsanitize=address</code>.</p></li></div></div>
<div class="page-columns page-full"><p>One of the checks done by ASan is that <code>malloc/free</code> and in C++ <code>new/delete</code> and <code>new[]/delete[]</code> are used consistently (rather than say <code>free</code> being used to dealloc memory allocated by <code>new[]</code>). This matters on some systems but not all: unfortunately on some of those where it does not matter, system libraries<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a> are not consistent. The check can be suppressed by including <code>alloc_dealloc_mismatch=0</code> in <code>ASAN_OPTIONS</code>.</p><div class="no-row-height column-margin column-container"><li id="fn12"><p><sup>12</sup>&nbsp;for example, X11/GL libraries on Linux, seen when checking package <a href="https://CRAN.R-project.org/package=rgl"><strong>rgl</strong></a> and some others using it—a workaround is to set environment variable <code>RGL_USE_NULL=true</code>.</p></li></div></div>
<p>ASan also checks system calls and sometimes reports can refer to problems in the system software and not the package nor R. A couple of reports have been of ‘heap-use-after-free’ errors in the X11 libraries called from Tcl/Tk.</p>
</section>
<section id="using-the-leak-sanitizer" class="level3 subsubsection" data-number="4.3.4">
<h3 class="subsubsection anchored" data-number="4.3.4" data-anchor-id="using-the-leak-sanitizer"><span class="header-section-number">4.3.4</span> Using the Leak Sanitizer</h3>
<p>For <code>x86_64</code> Linux there is a leak sanitizer, ‘LSan’: see <a href="https://github.com/google/sanitizers/wiki/AddressSanitizerLeakSanitizer" class="uri">https://github.com/google/sanitizers/wiki/AddressSanitizerLeakSanitizer</a>. This is available on recent versions of <code>gcc</code> and <code>clang</code>, and where available is compiled in as part of ASan.</p>
<p>One way to invoke this from an ASan-enabled build is by the environment variable</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ASAN_OPTIONS<span class="ot">=</span><span class="st">'detect_leaks=1'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However, this was made the default as from <code>clang</code> 3.5 and <code>gcc</code> 5.1.0.</p>
<p>When LSan is enabled, leaks give the process a failure error status (by default <code>23</code>). For an R package this means the R process, and as the parser retains some memory to the end of the process, if R itself was built against ASan all runs will have a failure error status (which may include running R as part of building R itself).</p>
<p>To disable this, allocation-mismatch checking and some strict C++ checking use</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>setenv ASAN_OPTIONS <span class="st">'alloc_dealloc_mismatch=0:detect_leaks=0:detect_odr_violation=0'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>LSan also has a ‘stand-alone’ mode where it is compiled in using <code>-fsanitize=leak</code> and avoids the run-time overhead of ASan.</p>
</section>
<section id="using-the-undefined-behaviour-sanitizer" class="level3 subsection page-columns page-full" data-number="4.3.5">
<h3 class="subsection anchored" data-number="4.3.5" data-anchor-id="using-the-undefined-behaviour-sanitizer"><span class="header-section-number">4.3.5</span> Using the Undefined Behaviour Sanitizer</h3>
<p>‘Undefined behaviour’ is where the language standard does not require particular behaviour from the compiler. Examples include division by zero (where for doubles R requires the ISO/IEC&nbsp;60559 behaviour but C/C++ do not), use of zero-length arrays, shifts too far for signed types (e.g.&nbsp;<code>int x, y; y = x &lt;&lt; 31;</code>), out-of-range coercion, invalid C++ casts and mis-alignment. Not uncommon examples of out-of-range coercion in R packages are attempts to coerce a <code>NaN</code> or infinity to type <code>int</code> or <code>NA_INTEGER</code> to an unsigned type such as <code>size_t</code>. Also common is <code>y[x - 1]</code> forgetting that <code>x</code> might be <code>NA_INTEGER</code>.</p>
<div class="page-columns page-full"><p>‘UBSanitizer’ is a tool for C/C++ source code selected by <code>-fsanitize=undefined</code> in suitable builds<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a> of <code>clang</code> and GCC. Its (main) runtime library is linked into each package’s DLL, so it is less often needed to be included in <code>MAIN_LDFLAGS</code>. Platforms supported by <code>clang</code> are listed at <a href="https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html#supported-platforms" class="uri">https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html#supported-platforms</a>: CRAN uses it for C/C++ with both GCC and <code>clang</code> on <code>x86_64</code> Linux: the two toolchains often highlight different things with more reports from <code>clang</code> than GCC.</p><div class="no-row-height column-margin column-container"><li id="fn13"><p><sup>13</sup>&nbsp;On some platforms the runtime library, <strong>libubsan</strong>, needs to be installed separately.</p></li></div></div>
<p>This sanitizer can be combined with the Address Sanitizer by <code>-fsanitize=undefined,address</code> (where both are supported).</p>
<p>Finer control of what is checked can be achieved by other options.</p>
<p>For <code>clang</code> see <a href="https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html#ubsan-checks" class="uri">https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html#ubsan-checks</a>. The current set is (on a single line):</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>fsanitize<span class="op">=</span>alignment<span class="op">,</span><span class="dt">bool</span><span class="op">,</span>bounds<span class="op">,</span>builtin<span class="op">,</span><span class="kw">enum</span><span class="op">,</span><span class="dt">float</span><span class="op">-</span>cast<span class="op">-</span>overflow<span class="op">,</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span><span class="op">-</span>divide<span class="op">-</span>by<span class="op">-</span>zero<span class="op">,</span>function<span class="op">,</span>implicit<span class="op">-</span><span class="dt">unsigned</span><span class="op">-</span>integer<span class="op">-</span>truncation<span class="op">,</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>implicit<span class="op">-</span><span class="dt">signed</span><span class="op">-</span>integer<span class="op">-</span>truncation<span class="op">,</span>implicit<span class="op">-</span>integer<span class="op">-</span>sign<span class="op">-</span>change<span class="op">,</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>integer<span class="op">-</span>divide<span class="op">-</span>by<span class="op">-</span>zero<span class="op">,</span>nonnull<span class="op">-</span>attribute<span class="op">,</span>null<span class="op">,</span>object<span class="op">-</span>size<span class="op">,</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>pointer<span class="op">-</span>overflow<span class="op">,</span><span class="cf">return</span><span class="op">,</span>returns<span class="op">-</span>nonnull<span class="op">-</span>attribute<span class="op">,</span>shift<span class="op">,</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="dt">signed</span><span class="op">-</span>integer<span class="op">-</span>overflow<span class="op">,</span>unreachable<span class="op">,</span><span class="dt">unsigned</span><span class="op">-</span>integer<span class="op">-</span>overflow<span class="op">,</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span><span class="op">-</span>shift<span class="op">-</span>base<span class="op">,</span>vla<span class="op">-</span>bound<span class="op">,</span>vptr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(plus the more specific versions <code>shift-base</code> and <code>shift-exponent</code>) a subset of which could be combined with <code>address</code>, or use something like</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span>fsanitize<span class="ot">=</span>undefined <span class="sc">-</span>fno<span class="sc">-</span>sanitize<span class="ot">=</span>float<span class="sc">-</span>divide<span class="sc">-</span>by<span class="sc">-</span>zero</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Options <code>function</code>, <code>return</code> and <code>vptr</code> apply only to C++: to use <code>vptr</code> its run-time library needs to be linked into the main R executable by building the latter with something like</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>MAIN_LD<span class="ot">=</span><span class="st">"clang++ -fsanitize=undefined"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Option <code>float-divide-by-zero</code> is undesirable for use with R which allow such divisions as part of IEC&nbsp;60559 arithmetic, and in versions of <code>clang</code> since June 2019 it is no longer part of <code>-fsanitize=undefined</code>.</p>
<p>For GCC see <a href="https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html" class="uri">https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html</a> (or the manual for your version of GCC, installed or <em>via</em> <a href="https://gcc.gnu.org/onlinedocs/" class="uri">https://gcc.gnu.org/onlinedocs/</a>: look for ‘Program Instrumentation Options’) for the options supported by GCC: 10 supported</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>fsanitize<span class="op">=</span>alignment<span class="op">,</span><span class="dt">bool</span><span class="op">,</span>bounds<span class="op">,</span>builtin<span class="op">,</span><span class="kw">enum</span><span class="op">,</span>integer<span class="op">-</span>divide<span class="op">-</span>by<span class="op">-</span>zero<span class="op">,</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>nonnull<span class="op">-</span>attribute<span class="op">,</span>null<span class="op">,</span>object<span class="op">-</span>size<span class="op">,</span>pointer<span class="op">-</span>overflow<span class="op">,</span><span class="cf">return</span><span class="op">,</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>returns<span class="op">-</span>nonnull<span class="op">-</span>attribute<span class="op">,</span>shift<span class="op">,</span><span class="dt">signed</span><span class="op">-</span>integer<span class="op">-</span>overflow<span class="op">,</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>unreachable<span class="op">,</span>vla<span class="op">-</span>bound<span class="op">,</span>vptr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>plus the more specific versions <code>shift-base</code> and <code>shift-exponent</code> and non-default options</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>bound<span class="sc">-</span>strict,float<span class="sc">-</span>cast<span class="sc">-</span>overflow,float<span class="sc">-</span>divide<span class="sc">-</span>by<span class="sc">-</span>zero</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where <code>float-divide-by-zero</code> is not desirable for R uses and <code>bounds-strict</code> is an extension of <code>bounds</code>.</p>
<p>Other useful flags include</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span>no<span class="sc">-</span>fsanitize<span class="sc">-</span>recover</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which causes the first report to be fatal (it always is for the <code>unreachable</code> and <code>return</code> suboptions). For more detailed information on where the runtime error occurs, using</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>setenv UBSAN_OPTIONS 'print_stacktrace<span class="op">=</span><span class="dv">1</span><span class="er">'</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>will include a traceback in the report. Beyond that, R can be run under a debugger with a breakpoint set before the sanitizer report is produced: for <code>gdb</code> or <code>lldb</code> you could use</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span> __ubsan_handle_float_cast_overflow</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span> __ubsan_handle_float_cast_overflow_abort</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or similar (there are handlers for each type of undefined behaviour).</p>
<p>There are also the compiler flags <code>-fcatch-undefined-behavior</code> and <code>-ftrapv</code>, said to be more reliable in <code>clang</code> than <code>gcc</code>.</p>
<p>For more details on the topic see <a href="https://blog.regehr.org/archives/213" class="uri">https://blog.regehr.org/archives/213</a> and <a href="https://blog.llvm.org/2011/05/what-every-c-programmer-should-know.html" class="uri">https://blog.llvm.org/2011/05/what-every-c-programmer-should-know.html</a> (which has 3 parts).</p>
<p>It may or may not be possible to build R itself with <code>-fsanitize=undefined</code>: problems have been seen with OpenMP-using code with <code>gcc</code> but there has been success with <code>clang</code>.</p>
</section>
<section id="other-analyses-with-clang" class="level3 subsection" data-number="4.3.6">
<h3 class="subsection anchored" data-number="4.3.6" data-anchor-id="other-analyses-with-clang"><span class="header-section-number">4.3.6</span> Other analyses with ‘clang’</h3>
<p>Recent versions of <code>clang</code> on <code>x86_64</code> Linux have ‘ThreadSanitizer’ (<a href="https://github.com/google/sanitizers/wiki#threadsanitizer" class="uri">https://github.com/google/sanitizers/wiki#threadsanitizer</a>), a ‘data race detector for C/C++ programs’, and ‘MemorySanitizer’ (<a href="https://clang.llvm.org/docs/MemorySanitizer.html" class="uri">https://clang.llvm.org/docs/MemorySanitizer.html</a>, <a href="https://github.com/google/sanitizers" class="uri">https://github.com/google/sanitizers</a>) for the detection of uninitialized memory. Both are based on and provide similar functionality to tools in <code>valgrind</code>.</p>
<p><code>clang</code> has a ‘Static Analyzer’ which can be run on the source files during compilation: see <a href="https://clang-analyzer.llvm.org/" class="uri">https://clang-analyzer.llvm.org/</a>.</p>
</section>
<section id="other-analyses-with-gcc" class="level3 subsection" data-number="4.3.7">
<h3 class="subsection anchored" data-number="4.3.7" data-anchor-id="other-analyses-with-gcc"><span class="header-section-number">4.3.7</span> Other analyses with ‘gcc’</h3>
<p>GCC 10 introduced a new flag <code>-fanalyzer</code> which does static analysis during compilation, currently for C code. It is regarded as <em>experimental</em> and it may slow down computation considerably when problems are found (and use many GB of resident memory). There is some overlap with problems detected by the Undefined Behaviour sanitizer, but some issues are only reported by this tool and as it is a static analysis, it does not rely on code paths being exercised.</p>
<p>See <a href="https://gcc.gnu.org/onlinedocs/gcc-10.1.0/gcc/Static-Analyzer-Options.html" class="uri">https://gcc.gnu.org/onlinedocs/gcc-10.1.0/gcc/Static-Analyzer-Options.html</a> (or the documentation for your version of <code>gcc</code> if later) and <a href="https://developers.redhat.com/blog/2020/03/26/static-analysis-in-gcc-10" class="uri">https://developers.redhat.com/blog/2020/03/26/static-analysis-in-gcc-10</a></p>
</section>
<section id="using-dr.-memory" class="level3 subsection page-columns page-full" data-number="4.3.8">
<h3 class="subsection anchored" data-number="4.3.8" data-anchor-id="using-dr.-memory"><span class="header-section-number">4.3.8</span> Using ‘Dr.&nbsp;Memory’</h3>
<div class="page-columns page-full"><p>‘Dr.&nbsp;Memory’ from <a href="https://drmemory.org/" class="uri">https://drmemory.org/</a> is a memory checker for (currently) 32-bit Windows, Linux and macOS with similar aims to <code>valgrind</code>. It works with unmodified executables<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a> and detects memory access errors, uninitialized reads and memory leaks.</p><div class="no-row-height column-margin column-container"><li id="fn14"><p><sup>14</sup>&nbsp;but works better if inlining and frame pointer optimizations are disabled.</p></li></div></div>
</section>
<section id="fortran-array-bounds-checking" class="level3 subsection" data-number="4.3.9">
<h3 class="subsection anchored" data-number="4.3.9" data-anchor-id="fortran-array-bounds-checking"><span class="header-section-number">4.3.9</span> Fortran array bounds checking</h3>
<p>Most of the Fortran compilers used with R allow code to be compiled with checking of array bounds: for example <code>gfortran</code> has option <code>-fbounds-check</code> and Oracle Developer Studio has <code>-C</code>. This will give an error when the upper or lower bound is exceeded, e.g.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>At line <span class="dv">97</span> of file ...<span class="sc">/</span>src<span class="sc">/</span>appl<span class="sc">/</span>dqrdc2.f</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>Fortran runtime error<span class="sc">:</span> Index <span class="st">'1'</span> of dimension <span class="dv">1</span> of array <span class="st">'x'</span> above upper bound of <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>One does need to be aware that lazy programmers often specify Fortran dimensions as <code>1</code> rather than <code>*</code> or a real bound and these will be reported (as may <code>*</code> dimensions)</p>
<p>It is easy to arrange to use this check on just the code in your package: add to <code>~/.R/Makevars</code> something like (for <code>gfortran</code>)</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>FFLAGS <span class="ot">=</span> <span class="sc">-</span>g <span class="sc">-</span>O2 <span class="sc">-</span>mtune<span class="ot">=</span>native <span class="sc">-</span>fbounds<span class="sc">-</span>check</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>when you run <code>R CMD check</code>.</p>
<p>This may report errors with the way that Fortran character variables are passed, particularly when Fortran subroutines are called from C code and character lengths are not passed (see <a href="The-R-API.html#fortran-character-strings">Fortran character strings</a>).</p>
</section>
</section>
<section id="debugging-compiled-code" class="level2 section page-columns page-full" data-number="4.4">
<h2 class="section anchored" data-number="4.4" data-anchor-id="debugging-compiled-code"><span class="header-section-number">4.4</span> Debugging compiled code</h2>
<p>Sooner or later programmers will be faced with the need to debug compiled code loaded into R. This section is geared to platforms using <code>gdb</code> with code compiled by <code>gcc</code>, but similar things are possible with other debuggers such as <code>lldb</code> (<a href="https://lldb.llvm.org/" class="uri">https://lldb.llvm.org/</a>, used on macOS) and Sun’s <code>dbx</code>: some debuggers have graphical front-ends available.</p>
<p>Consider first ‘crashes’, that is when R terminated unexpectedly with an illegal memory access (a ‘segfault’ or ‘bus error’), illegal instruction or similar. Unix-alike versions of R use a signal handler which aims to give some basic information. For example</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a> <span class="sc">**</span><span class="er">*</span> caught segfault <span class="sc">**</span><span class="er">*</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>address <span class="dv">0x20000028</span>, cause <span class="st">'memory not mapped'</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>Traceback<span class="sc">:</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span><span class="sc">:</span> <span class="fu">.identC</span>(class1[[<span class="dv">1</span>]], class2)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span><span class="sc">:</span> <span class="fu">possibleExtends</span>(<span class="fu">class</span>(sloti), classi, <span class="at">ClassDef2 =</span> <span class="fu">getClassDef</span>(classi,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="at">where =</span> where))</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span><span class="sc">:</span> <span class="fu">validObject</span>(<span class="fu">t</span>(cu))</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span><span class="sc">:</span> <span class="fu">stopifnot</span>(<span class="fu">validObject</span>(cu <span class="ot">&lt;-</span> <span class="fu">as</span>(tu, <span class="st">"dtCMatrix"</span>)), <span class="fu">validObject</span>(<span class="fu">t</span>(cu)),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="fu">validObject</span>(<span class="fu">t</span>(tu)))</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>Possible actions<span class="sc">:</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="fu">abort</span> (with core dump)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> normal R exit</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> exit R without saving workspace</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> exit R saving workspace</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>Selection<span class="sc">:</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since the R process may be damaged, the only really safe options are the first or third. (Note that a core dump is only produced where enabled: a common default in a shell is to limit its size to 0, thereby disabling it.)</p>
<p>A fairly common cause of such crashes is a package which uses <code>.C</code> or <code>.Fortran</code> and writes beyond (at either end) one of the arguments it is passed. There is a good way to detect this: using <code>options(CBoundsCheck = TRUE)</code> (which can be selected <em>via</em> the environment variable <code>R_C_BOUNDS_CHECK=yes)</code> changes the way <code>.C</code> and <code>.Fortran</code> work to check if the compiled code writes in the 64 bytes at either end of an argument.</p>
<p>Another cause of a ‘crash’ is to overrun the C stack. R tries to track that in its own code, but it may happen in third-party compiled code. For modern POSIX-compliant OSes R can safely catch that and return to the top-level prompt, so one gets something like</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">.C</span>(<span class="st">"aaa"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>Error<span class="sc">:</span> segfault from C stack overflow</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However, C stack overflows are fatal under Windows and normally defeat attempts at debugging on that platform. Further, the size of the stack is set when R is compiled on Windows, whereas on POSIX OSes it can be set in the shell from which R is launched.</p>
<p>If you have a crash which gives a core dump you can use something like</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>gdb <span class="sc">/</span>path<span class="sc">/</span>to<span class="sc">/</span>R<span class="sc">/</span>bin<span class="sc">/</span>exec<span class="sc">/</span>R core<span class="fl">.12345</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>to examine the core dump. If core dumps are disabled or to catch errors that do not generate a dump one can run R directly under a debugger by for example</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span> R <span class="sc">-</span>d gdb <span class="sc">--</span>vanilla</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>gdb<span class="sc">&gt;</span> run</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>at which point R will run normally, and hopefully the debugger will catch the error and return to its prompt. This can also be used to catch infinite loops or interrupt very long-running code. For a simple example</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="cf">for</span><span class="op">(</span>i in <span class="dv">1</span><span class="op">:</span><span class="fl">1e7</span><span class="op">)</span> x <span class="op">&lt;-</span> rnorm<span class="op">(</span><span class="dv">100</span><span class="op">)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>hit Ctrl<span class="op">-</span>C<span class="op">]</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>Program received signal SIGINT<span class="op">,</span> Interrupt<span class="op">.</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="bn">0x00397682</span> in _int_free <span class="op">()</span> from <span class="op">/</span>lib<span class="op">/</span>tls<span class="op">/</span>libc<span class="op">.</span>so<span class="fl">.6</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="op">(</span>gdb<span class="op">)</span> where</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="er">#0  0x00397682 in _int_free () from /lib/tls/libc.so.6</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="er">#1  0x00397eba in free () from /lib/tls/libc.so.6</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="er">#2  0xb7cf2551 in R_gc_internal (size_needed=313)</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    at <span class="op">/</span>users<span class="op">/</span>ripley<span class="op">/</span>R<span class="op">/</span>svn<span class="op">/</span>R<span class="op">-</span>devel<span class="op">/</span>src<span class="op">/</span>main<span class="op">/</span>memory<span class="op">.</span>c<span class="op">:</span><span class="dv">743</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="er">#3  0xb7cf3617 in Rf_allocVector (type=13, length=626)</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    at <span class="op">/</span>users<span class="op">/</span>ripley<span class="op">/</span>R<span class="op">/</span>svn<span class="op">/</span>R<span class="op">-</span>devel<span class="op">/</span>src<span class="op">/</span>main<span class="op">/</span>memory<span class="op">.</span>c<span class="op">:</span><span class="dv">1906</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="er">#4  0xb7c3f6d3 in PutRNGstate ()</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    at <span class="op">/</span>users<span class="op">/</span>ripley<span class="op">/</span>R<span class="op">/</span>svn<span class="op">/</span>R<span class="op">-</span>devel<span class="op">/</span>src<span class="op">/</span>main<span class="op">/</span>RNG<span class="op">.</span>c<span class="op">:</span><span class="dv">351</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="er">#5  0xb7d6c0a5 in do_random2 (call=0x94bf7d4, op=0x92580e8, args=0x9698f98,</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    rho<span class="op">=</span><span class="bn">0x9698f28</span><span class="op">)</span> at <span class="op">/</span>users<span class="op">/</span>ripley<span class="op">/</span>R<span class="op">/</span>svn<span class="op">/</span>R<span class="op">-</span>devel<span class="op">/</span>src<span class="op">/</span>main<span class="op">/</span>random<span class="op">.</span>c<span class="op">:</span><span class="dv">183</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In many cases it is possible to attach a debugger to a running process: this is helpful if an alternative front-end is in use or to investigate a task that seems to be taking far too long. This is done by something like</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>gdb <span class="sc">-</span>p pid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where <var>pid</var> is the id of the R executable or front-end process and can be found from within a running R process by calling <code>Sys.getpid()</code> or from a process monitor. This stops the process so its state can be examined: use <code>continue</code> to resume execution.</p>
<p>Some “tricks” worth knowing follow:</p>
<section id="finding-entry-points-in-dynamically-loaded-code" class="level3 subsection" data-number="4.4.1">
<h3 class="subsection anchored" data-number="4.4.1" data-anchor-id="finding-entry-points-in-dynamically-loaded-code"><span class="header-section-number">4.4.1</span> Finding entry points in dynamically loaded code</h3>
<p>Under most compilation environments, compiled code dynamically loaded into R cannot have breakpoints set within it until it is loaded. To use a symbolic debugger on such dynamically loaded code under Unix-alikes use</p>
<ul>
<li>Call the debugger on the R executable, for example by <kbd>R -d gdb</kbd>.</li>
<li>Start R.</li>
<li>At the R prompt, use <code>dyn.load</code> or <code>library</code> to load your shared object.</li>
<li>Send an interrupt signal. This will put you back to the debugger prompt.</li>
<li>Set the breakpoints in your code.</li>
<li>Continue execution of R by typing <kbd>signal 0<span class="key">RET</span></kbd>.</li>
</ul>
<p>Under Windows signals may not be able to be used, and if so the procedure is more complicated. See the rw-FAQ.</p>
</section>
<section id="inspecting-r-objects-when-debugging" class="level3 subsection" data-number="4.4.2">
<h3 class="subsection anchored" data-number="4.4.2" data-anchor-id="inspecting-r-objects-when-debugging"><span class="header-section-number">4.4.2</span> Inspecting R objects when debugging</h3>
<p>The key to inspecting R objects from compiled code is the function <var>PrintValue(SEXP ``s</var><code>)</code> which uses the normal R printing mechanisms to print the R object pointed to by <var>s</var>, or the safer version <var>R_PV(SEXP ``s</var><code>)</code> which will only print ‘objects’.</p>
<p>One way to make use of <code>PrintValue</code> is to insert suitable calls into the code to be debugged.</p>
<p>Another way is to call <code>R_PV</code> from the symbolic debugger. (<code>PrintValue</code> is hidden as <code>Rf_PrintValue</code>.) For example, from <code>gdb</code> we can use</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>(gdb) p <span class="fu">R_PV</span>(ab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>using the object <code>ab</code> from the convolution example, if we have placed a suitable breakpoint in the convolution C code.</p>
<p>To examine an arbitrary R object we need to work a little harder. For example, let</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>R<span class="sc">&gt;</span> DF <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">b =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By setting a breakpoint at <code>do_get</code> and typing <kbd>get("DF")</kbd> at the R prompt, one can find out the address in memory of <code>DF</code>, for example</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>Value returned is $<span class="dv">1</span> <span class="op">=</span> <span class="op">(</span>SEXPREC <span class="op">*)</span> <span class="bn">0x40583e1c</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="op">(</span>gdb<span class="op">)</span> p <span class="op">*</span>$<span class="dv">1</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>$<span class="dv">2</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  sxpinfo <span class="op">=</span> <span class="op">{</span>type <span class="op">=</span> <span class="dv">19</span><span class="op">,</span> obj <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> named <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> gp <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    mark <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> debug <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> trace <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="op">=</span> <span class="dv">0</span><span class="op">},</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  attrib <span class="op">=</span> <span class="bn">0x40583e80</span><span class="op">,</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  u <span class="op">=</span> <span class="op">{</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    vecsxp <span class="op">=</span> <span class="op">{</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>      length <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>      type <span class="op">=</span> <span class="op">{</span>c <span class="op">=</span> <span class="bn">0x40634700</span> <span class="st">"0&gt;X@D&gt;X@0&gt;X@"</span><span class="op">,</span> i <span class="op">=</span> <span class="bn">0x40634700</span><span class="op">,</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        f <span class="op">=</span> <span class="bn">0x40634700</span><span class="op">,</span> z <span class="op">=</span> <span class="bn">0x40634700</span><span class="op">,</span> s <span class="op">=</span> <span class="bn">0x40634700</span><span class="op">},</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>      truelength <span class="op">=</span> <span class="dv">1075851272</span><span class="op">,</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    primsxp <span class="op">=</span> <span class="op">{</span>offset <span class="op">=</span> <span class="dv">2</span><span class="op">},</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    symsxp <span class="op">=</span> <span class="op">{</span>pname <span class="op">=</span> <span class="bn">0x2</span><span class="op">,</span> value <span class="op">=</span> <span class="bn">0x40634700</span><span class="op">,</span> internal <span class="op">=</span> <span class="bn">0x40203008</span><span class="op">},</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    listsxp <span class="op">=</span> <span class="op">{</span>carval <span class="op">=</span> <span class="bn">0x2</span><span class="op">,</span> cdrval <span class="op">=</span> <span class="bn">0x40634700</span><span class="op">,</span> tagval <span class="op">=</span> <span class="bn">0x40203008</span><span class="op">},</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    envsxp <span class="op">=</span> <span class="op">{</span>frame <span class="op">=</span> <span class="bn">0x2</span><span class="op">,</span> enclos <span class="op">=</span> <span class="bn">0x40634700</span><span class="op">},</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    closxp <span class="op">=</span> <span class="op">{</span>formals <span class="op">=</span> <span class="bn">0x2</span><span class="op">,</span> body <span class="op">=</span> <span class="bn">0x40634700</span><span class="op">,</span> env <span class="op">=</span> <span class="bn">0x40203008</span><span class="op">},</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    promsxp <span class="op">=</span> <span class="op">{</span>value <span class="op">=</span> <span class="bn">0x2</span><span class="op">,</span> expr <span class="op">=</span> <span class="bn">0x40634700</span><span class="op">,</span> env <span class="op">=</span> <span class="bn">0x40203008</span><span class="op">}</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(Debugger output reformatted for better legibility).</p>
<p>Using <code>R_PV()</code> one can “inspect” the values of the various elements of the SEXP, for example,</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>(gdb) p <span class="fu">R_PV</span>(<span class="sc">$</span><span class="dv">1</span><span class="ot">-&gt;</span>attrib)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>names</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"a"</span> <span class="st">"b"</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>row.names</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"1"</span> <span class="st">"2"</span> <span class="st">"3"</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>class</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"data.frame"</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="dv">3</span> <span class="ot">=</span> void</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To find out where exactly the corresponding information is stored, one needs to go “deeper”:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(gdb) set <span class="sc">$</span>a <span class="ot">=</span> <span class="er">$</span><span class="dv">1</span><span class="ot">-&gt;</span>attrib</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>(gdb) p <span class="sc">$</span>a<span class="ot">-&gt;</span>u.listsxp.tagval<span class="ot">-&gt;</span>u.symsxp.pname<span class="ot">-&gt;</span>u.vecsxp.type.c</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="dv">4</span> <span class="ot">=</span> <span class="dv">0x405d40e8</span> <span class="st">"names"</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>(gdb) p <span class="sc">$</span>a<span class="ot">-&gt;</span>u.listsxp.carval<span class="ot">-&gt;</span>u.vecsxp.type.s[<span class="dv">1</span>]<span class="ot">-&gt;</span>u.vecsxp.type.c</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="dv">5</span> <span class="ot">=</span> <span class="dv">0x40634378</span> <span class="st">"b"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>(gdb) p <span class="sc">$</span><span class="dv">1</span><span class="ot">-&gt;</span>u.vecsxp.type.s[<span class="dv">0</span>]<span class="ot">-&gt;</span>u.vecsxp.type.i[<span class="dv">0</span>]</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="dv">6</span> <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>(gdb) p <span class="sc">$</span><span class="dv">1</span><span class="ot">-&gt;</span>u.vecsxp.type.s[<span class="dv">1</span>]<span class="ot">-&gt;</span>u.vecsxp.type.i[<span class="dv">1</span>]</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="dv">7</span> <span class="ot">=</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Another alternative is the <code>R_inspect</code> function which shows the low-level structure of the objects recursively (addresses differ from the above as this example is created on another machine):</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>(gdb) p <span class="fu">R_inspect</span>(<span class="sc">$</span><span class="dv">1</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>100954d18 <span class="dv">19</span> VECSXP g0c2 [OBJ,<span class="fu">NAM</span>(<span class="dv">2</span>),ATT] (<span class="at">len=</span><span class="dv">2</span>, <span class="at">tl=</span><span class="dv">0</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">@</span>100954d50 <span class="dv">13</span> INTSXP g0c2 [<span class="fu">NAM</span>(<span class="dv">2</span>)] (<span class="at">len=</span><span class="dv">3</span>, <span class="at">tl=</span><span class="dv">0</span>) <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">@</span>100954d88 <span class="dv">13</span> INTSXP g0c2 [<span class="fu">NAM</span>(<span class="dv">2</span>)] (<span class="at">len=</span><span class="dv">3</span>, <span class="at">tl=</span><span class="dv">0</span>) <span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>ATTRIB<span class="sc">:</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="er">@</span>102a70140 <span class="dv">02</span> LISTSXP g0c0 []</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    TAG<span class="sc">:</span> <span class="er">@</span>10083c478 <span class="dv">01</span> SYMSXP g0c0 [MARK,<span class="fu">NAM</span>(<span class="dv">2</span>),gp<span class="ot">=</span><span class="dv">0x4000</span>] <span class="st">"names"</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">@</span>100954dc0 <span class="dv">16</span> STRSXP g0c2 [<span class="fu">NAM</span>(<span class="dv">2</span>)] (<span class="at">len=</span><span class="dv">2</span>, <span class="at">tl=</span><span class="dv">0</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>      <span class="sc">@</span>10099df28 <span class="dv">09</span> CHARSXP g0c1 [MARK,gp<span class="ot">=</span><span class="dv">0x21</span>] <span class="st">"a"</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>      <span class="sc">@</span><span class="fl">10095e518</span> <span class="dv">09</span> CHARSXP g0c1 [MARK,gp<span class="ot">=</span><span class="dv">0x21</span>] <span class="st">"b"</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    TAG<span class="sc">:</span> <span class="er">@</span><span class="fl">100859e60</span> <span class="dv">01</span> SYMSXP g0c0 [MARK,<span class="fu">NAM</span>(<span class="dv">2</span>),gp<span class="ot">=</span><span class="dv">0x4000</span>] <span class="st">"row.names"</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="sc">@</span>102a6f868 <span class="dv">13</span> INTSXP g0c1 [<span class="fu">NAM</span>(<span class="dv">2</span>)] (<span class="at">len=</span><span class="dv">2</span>, <span class="at">tl=</span><span class="dv">1</span>) <span class="sc">-</span><span class="dv">2147483648</span>,<span class="sc">-</span><span class="dv">3</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    TAG<span class="sc">:</span> <span class="er">@</span>10083c948 <span class="dv">01</span> SYMSXP g0c0 [MARK,gp<span class="ot">=</span><span class="dv">0x4000</span>] <span class="st">"class"</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="sc">@</span>102a6f838 <span class="dv">16</span> STRSXP g0c1 [<span class="fu">NAM</span>(<span class="dv">2</span>)] (<span class="at">len=</span><span class="dv">1</span>, <span class="at">tl=</span><span class="dv">1</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">@</span>1008c6d48 <span class="dv">09</span> CHARSXP g0c2 [MARK,gp<span class="ot">=</span><span class="dv">0x21</span>,ATT] <span class="st">"data.frame"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In general the representation of each object follows the format:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span><span class="er">&lt;</span>address<span class="sc">&gt;</span> <span class="er">&lt;</span>type<span class="sc">-</span>nr<span class="sc">&gt;</span> <span class="er">&lt;</span>type<span class="sc">-</span>name<span class="sc">&gt;</span> <span class="er">&lt;</span>gc<span class="sc">-</span>info<span class="sc">&gt;</span> [<span class="sc">&lt;</span>flags<span class="sc">&gt;</span>] ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For a more fine-grained control over the depth of the recursion and the output of vectors <code>R_inspect3</code> takes additional two character() parameters: maximum depth and the maximal number of elements that will be printed for scalar vectors. The defaults in <code>R_inspect</code> are currently -1 (no limit) and 5 respectively.</p>
</section>
<section id="debugging-on-macos" class="level3 subsection page-columns page-full" data-number="4.4.3">
<h3 class="subsection anchored" data-number="4.4.3" data-anchor-id="debugging-on-macos"><span class="header-section-number">4.4.3</span> Debugging on macOS</h3>
<p>To debug code in a package it is easiest to unpack it in a directory and install it with</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> CMD INSTALL <span class="at">--dsym</span> pkgname</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>as macOS does not store debugging symbols in the <code>.so</code> file. (It is not necessary to have R built with debugging symbols, although compiling the package should be done including <code>-g</code> in <code>CFLAGS</code> / <code>CXXFLAGS</code> / <code>FCFLAGS</code> as appropriate.)</p>
<p>Security measures may prevent running a CRAN binary distribution of R under <code>lldb</code> or attaching this as a debugger (<a href="https://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html#I-cannot-attach-debugger-to-R" class="uri">https://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html#I-cannot-attach-debugger-to-R</a>), although both were possible on High Sierra and are again from R 4.2.0. This can also affect locally compiled builds, where attaching to an interactive R session under Big Sur or Monterey worked in 2022 after giving administrator permission <em>via</em> a popup-up. (To debug in what Apple deems a non-interactive session, e.g.&nbsp;logged in remotely, see <code>man DevToolsSecurity</code>.)</p>
<div class="page-columns page-full"><p>Debugging a local build of R on macOS can raise additional hurdles as environment variables such as <code>DYLD_FALLBACK_LIBRARY_PATH</code> are not usually passed through<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a> the <code>lldb</code> process, resulting in messages like</p><div class="no-row-height column-margin column-container"><li id="fn15"><p><sup>15</sup>&nbsp;By default as a security measure: see <code>man dyld</code>.</p></li></div></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>R <span class="sc">-</span>d lldb</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>(lldb) run</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>Process <span class="dv">16828</span> launched<span class="sc">:</span> <span class="st">'/path/to/bin/exec/R'</span> (x86_64)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>dyld<span class="sc">:</span> Library not loaded<span class="sc">:</span> libR.dylib</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  Referenced from<span class="sc">:</span> <span class="er">/</span>path<span class="sc">/</span>to<span class="sc">/</span>bin<span class="sc">/</span>exec<span class="sc">/</span>R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="page-columns page-full"><p>A quick workaround is to symlink the dylibs under <code>R_HOME/lib</code> to somewhere where they will be found such as the current working directory. It would be possible to do as the distribution does<a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a> and use <code>install_name_tool</code>, but that would have to be done for all the dylibs including those in packages.</p><div class="no-row-height column-margin column-container"><li id="fn16"><p><sup>16</sup>&nbsp;See <a href="https://svn.r-project.org/R-dev-web/trunk/CRAN/QA/Simon/R-build/fixpathR" class="uri">https://svn.r-project.org/R-dev-web/trunk/CRAN/QA/Simon/R-build/fixpathR</a>: <code>@executable_path</code> could be used rather than absolute paths.</p></li></div></div>
<p>It may be simplest to attach the debugger to a running process (see above). Specifically, run R and when it is at the prompt just before a command that is to be debugged, at a terminal</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ps <span class="sc">-</span>ef <span class="sc">|</span> grep exec<span class="sc">/</span>R</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># identify the pid pid for the next command: it is the second item</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>lldb <span class="sc">-</span>p pid</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>(lldb) continue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and then return to the R console.</p>
<p>For non-interactive use, one may need <code>lldb --batch</code>.</p>
</section>
</section>
<section id="using-link-time-optimization" class="level2 section" data-number="4.5">
<h2 class="section anchored" data-number="4.5" data-anchor-id="using-link-time-optimization"><span class="header-section-number">4.5</span> Using Link-time Optimization</h2>
<p>Where supported, <em>link time optimization</em> provides a comprehensive way to check the consistency of calls between Fortran files or between C and Fortran. Use this <em>via</em> <code>R CMD INSTALL --use-LTO</code>.</p>
<p>To set up support on a Unix-alike, On Linux using GCC without building R with LTO support, it should suffice to set</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>LTO_OPT <span class="ot">=</span> <span class="sc">-</span>flto</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>LTO_FC_OPT <span class="ot">=</span> <span class="sc">-</span>flto</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>AR <span class="ot">=</span> gcc<span class="sc">-</span>ar</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>NM <span class="ot">=</span> gcc<span class="sc">-</span>nm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>in a personal (or site) <code>Makevars</code> file:</p>
<p>For Windows, first edit file <code>etc/${R_ARCH}/Makeconf</code> to give <code>LTO_OPT</code> the value <code>-flto</code> or do so in a personal/site <code>Makevars</code> file; see also file <code>src/gnuwin32/README.compilation</code> in the sources.</p>
<p>For example:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>boot.f<span class="sc">:</span><span class="dv">61</span><span class="sc">:</span> warning<span class="sc">:</span> type of <span class="st">'ddot'</span> does not match original declaration [<span class="sc">-</span>Wlto<span class="sc">-</span>type<span class="sc">-</span>mismatch]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">y</span>(j,i)<span class="ot">=</span><span class="fu">ddot</span>(p,<span class="fu">x</span>(j,<span class="dv">1</span>),n,<span class="fu">b</span>(<span class="dv">1</span>,j,i),<span class="dv">1</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>crq.f<span class="sc">:</span><span class="dv">1023</span><span class="sc">:</span> note<span class="sc">:</span> return value type mismatch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where the package author forgot to declare</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>      <span class="dt">double</span> precision ddot</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>      external ddot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>in <code>boot.f</code>. That package had its own copy of <code>ddot</code>: to detect misuse of the one in R’s BLAS library would have needed R configured with <code>--enable-lto=check</code>.</p>
<p>Further examples:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>rkpk2.f<span class="sc">:</span><span class="dv">77</span><span class="sc">:</span><span class="dv">5</span><span class="sc">:</span> warning<span class="sc">:</span> type of <span class="st">'dstup'</span> does not match original declaration [<span class="sc">-</span>Wlto<span class="sc">-</span>type<span class="sc">-</span>mismatch]</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">*</span>info, wk<span class="er">)</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>rkpk1.f<span class="sc">:</span><span class="dv">2565</span><span class="sc">:</span><span class="dv">5</span><span class="sc">:</span> note<span class="sc">:</span> type mismatch <span class="cf">in</span> parameter <span class="dv">14</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>       subroutine <span class="fu">dstup</span> (s, lds, nobs, nnull, qraux, jpvt, y, q, ldqr,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>rkpk1.f<span class="sc">:</span><span class="dv">2565</span><span class="sc">:</span><span class="dv">5</span><span class="sc">:</span> note<span class="sc">:</span> <span class="st">'dstup'</span> was previously declared here</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where the fourteenth argument <code>dum</code> was missing in the call.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>reg.f<span class="sc">:</span><span class="dv">78</span><span class="sc">:</span><span class="dv">33</span><span class="sc">:</span> warning<span class="sc">:</span> type of <span class="st">'dqrdc'</span> does not match original declaration [<span class="sc">-</span>Wlto<span class="sc">-</span>type<span class="sc">-</span>mismatch]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>       call <span class="fu">dqrdc</span> (sr, nobs, nobs, nnull, wk, dum, dum, <span class="dv">0</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>dstup.f<span class="sc">:</span><span class="dv">20</span><span class="sc">:</span> note<span class="sc">:</span> <span class="st">'dqrdc'</span> was previously declared here</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>       call <span class="fu">dqrdc</span> (s, lds, nobs, nnull, qraux, jpvt, work, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>dqrdc</code> is a LINPACK routine from R, <code>jpvt</code> is an integer array and <code>work</code> is a double precision one so <code>dum</code> cannot match both. (If <code>--enable-lto=check</code> had been used the comparison would have been with the definition in R.)</p>
<p>For Fortran files all in the package, most inconsistencies can be detected by concatenating the Fortran files and compiling the result, sometimes with clearer diagnostics than provided by LTO. For our last two examples this gives</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>all.f:2966:72:</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>      *info, work1)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                                                                        1</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>Warning: Missing actual argument for argument 'dum' at (1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>all.f:1663:72:</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>      *ipvtwk), wk(ikwk), wk(iwork1), wk(iwork2), info)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                                                                        1</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>Warning: Type mismatch in argument 'jpvt' at (1); passed REAL(8) to INTEGER(4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Tidying-and-profiling-R-code.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tidying and profiling R code</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./System-and-foreign-language-interfaces.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">System and foreign language interfaces</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">A re-styled version of the original R manuals at <a href="https://cran.r-project.org/manuals.html" class="uri">https://cran.r-project.org/manuals.html</a></div>   
    <div class="nav-footer-right">Built using <a href="https://quarto.org">Quarto</a></div>
  </div>
</footer>



</body></html>