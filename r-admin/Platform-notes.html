<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.2.462">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>R Manuals :: R Installation and Administration - 12&nbsp; Platform notes</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="site_libs/quarto-nav/headroom.min.js"></script>
  <script src="site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="./">
  <script src="site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="site_libs/quarto-search/fuse.min.js"></script>
  <script src="site_libs/quarto-search/quarto-search.js"></script>
  <link href="./Function-and-variable-index.html" rel="next">
  <link href="./Configuration-on-a-Unix-alike.html" rel="prev">
  <script src="site_libs/quarto-html/quarto.js"></script>
  <script src="site_libs/quarto-html/popper.min.js"></script>
  <script src="site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="site_libs/quarto-html/anchor.min.js"></script>
  <link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "end",
    "type": "overlay",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
</head>
<body class="floating slimcontent">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R Manuals :: R Installation and Administration</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./../index.html">Home</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-manuals" role="button" data-bs-toggle="dropdown" aria-expanded="false">Manuals</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-manuals">    
        <li>
    <a class="dropdown-item" href="./../r-intro/index.html">An Introduction to R</a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-data/index.html">R Data Import/Export</a>
  </li>  
        <li>
    <a class="dropdown-item" href="./index.html">R Installation and Administration</a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-exts/index.html">Writing R Extensions</a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-lang/index.html">R Language Definition</a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-ints/index.html">R Internals</a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./../about.html">About</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Platform notes</span></h1>
      <button type="button" class="quarto-btn-toggle btn">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-1">
      <li class="sidebar-item">
  <a href="./index.html" class="">R Installation and Administration</a>
</li>
      <li class="sidebar-item">
  <a href="./Obtaining-R.html" class=""><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Obtaining R</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Installing-R-under-Unix-alikes.html" class=""><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Installing R under Unix-alikes</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Installing-R-under-Windows.html" class=""><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Installing R under Windows</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Installing-R-under-macOS.html" class=""><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Installing R under macOS</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Running-R.html" class=""><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Running R</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Add-on-packages.html" class=""><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Add-on packages</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Internationalization.html" class=""><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Internationalization and Localization</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Choosing-between-32--and-64-bit-builds.html" class=""><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Choosing between 32- and 64-bit builds</span></a>
</li>
      <li class="sidebar-item">
  <a href="./The-standalone-Rmath-library.html" class=""><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The standalone Rmath library</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Essential-and-useful-other-programs-under-a-Unix-alike.html" class=""><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Essential and useful other programs under a Unix-alike</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Configuration-on-a-Unix-alike.html" class=""><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Configuration on a Unix-alike</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Platform-notes.html" class="active"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Platform notes</span></a>
</li>
      <li class="sidebar-item">
  <a href="./Function-and-variable-index.html" class="">Function and variable index</a>
</li>
      <li class="sidebar-item">
  <a href="./Concept-index.html" class="">Concept index</a>
</li>
      <li class="sidebar-item">
  <a href="./Environment-variable-index.html" class="">Environment variable index</a>
</li>
  </ul>
  </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
      <nav id="TOC" role="doc-toc">
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#x11-issues" class="nav-link active" data-scroll-target="#x11-issues"> <span class="header-section-number">12.1</span> X11 issues</a></li>
<li><a href="#linux" class="nav-link" data-scroll-target="#linux"> <span class="header-section-number">12.2</span> Linux</a>
<ul class="collapse">
<li><a href="#clang" class="nav-link" data-scroll-target="#clang"> <span class="header-section-number">12.2.1</span> Clang</a></li>
<li><a href="#intel-compilers" class="nav-link" data-scroll-target="#intel-compilers"> <span class="header-section-number">12.2.2</span> Intel compilers</a></li>
</ul></li>
<li><a href="#macos" class="nav-link" data-scroll-target="#macos"> <span class="header-section-number">12.3</span> macOS</a>
<ul class="collapse">
<li><a href="#prerequisites" class="nav-link" data-scroll-target="#prerequisites"> <span class="header-section-number">12.3.1</span> Prerequisites</a></li>
<li><a href="#note-for-catalina-and-later-users" class="nav-link" data-scroll-target="#note-for-catalina-and-later-users"> <span class="header-section-number">12.3.2</span> Note for Catalina and later users</a></li>
<li><a href="#cairo-graphics" class="nav-link" data-scroll-target="#cairo-graphics"> <span class="header-section-number">12.3.3</span> Cairo graphics</a></li>
<li><a href="#other-cc-compilers" class="nav-link" data-scroll-target="#other-cc-compilers"> <span class="header-section-number">12.3.4</span> Other C/C++ compilers</a></li>
<li><a href="#other-libraries" class="nav-link" data-scroll-target="#other-libraries"> <span class="header-section-number">12.3.5</span> Other libraries</a></li>
<li><a href="#tcltk-headers-and-libraries" class="nav-link" data-scroll-target="#tcltk-headers-and-libraries"> <span class="header-section-number">12.3.6</span> Tcl/Tk headers and libraries</a></li>
<li><a href="#java" class="nav-link" data-scroll-target="#java"> <span class="header-section-number">12.3.7</span> Java</a></li>
<li><a href="#frameworks" class="nav-link" data-scroll-target="#frameworks"> <span class="header-section-number">12.3.8</span> Frameworks</a></li>
<li><a href="#building-r.app" class="nav-link" data-scroll-target="#building-r.app"> <span class="header-section-number">12.3.9</span> Building R.app</a></li>
<li><a href="#building-binary-packages" class="nav-link" data-scroll-target="#building-binary-packages"> <span class="header-section-number">12.3.10</span> Building binary packages</a></li>
<li><a href="#arm64-aka-apple-silicon" class="nav-link" data-scroll-target="#arm64-aka-apple-silicon"> <span class="header-section-number">12.3.11</span> <code>arm64</code> aka ‘Apple Silicon’</a></li>
<li><a href="#native-builds" class="nav-link" data-scroll-target="#native-builds"> <span class="header-section-number">12.3.12</span> Native builds</a></li>
</ul></li>
<li><a href="#freebsd" class="nav-link" data-scroll-target="#freebsd"> <span class="header-section-number">12.4</span> FreeBSD</a></li>
<li><a href="#openbsd" class="nav-link" data-scroll-target="#openbsd"> <span class="header-section-number">12.5</span> OpenBSD</a></li>
<li><a href="#cygwin" class="nav-link" data-scroll-target="#cygwin"> <span class="header-section-number">12.6</span> Cygwin</a></li>
<li><a href="#new-platforms" class="nav-link" data-scroll-target="#new-platforms"> <span class="header-section-number">12.7</span> New platforms</a></li>
</ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full">
<header id="title-block-header">
<h1 class="title display-7"><span id="platform-notes" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Platform notes</span></span></h1>
</header>

<p>This section provides some notes on building R on different Unix-alike platforms. These notes are based on tests run on one or two systems in each case with particular sets of compilers and support libraries. Success in building R depends on the proper installation and functioning of support software; your results may differ if you have other versions of compilers and support libraries.</p>
<p>Older versions of this manual contain notes on platforms such as HP-UX, IRIX, Alpha/OSF1 (for R &lt; 2.10.0, and support has since been removed for all of these) and AIX (for R &lt; = 3.5.x) for which we have had no recent reports.</p>
<p>C macros to select particular platforms can be tricky to track down (there is a fair amount of misinformation on the Web). The Wiki (currently) at <a href="https://sourceforge.net/p/predef/wiki/Home/" class="uri">https://sourceforge.net/p/predef/wiki/Home/</a> can be helpful. The R sources have used (often in included software under <code>src/extra</code>)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>AIX<span class="sc">:</span> _AIX</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>Cygwin<span class="sc">:</span> __CYGWIN__</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>FreeBSD<span class="sc">:</span> __FreeBSD__</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>HP<span class="sc">-</span>UX<span class="sc">:</span> __hpux__, __hpux</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>IRIX<span class="sc">:</span> sgi, __sgi</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>Linux<span class="sc">:</span> __linux__</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>macOS<span class="sc">:</span> __APPLE__</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>NetBSD<span class="sc">:</span> __NetBSD__</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>OpenBSD<span class="sc">:</span> __OpenBSD__</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>Windows<span class="sc">:</span> _WIN32, _WIN64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="x11-issues" class="level2 section page-columns page-full" data-number="12.1">
<h2 class="section anchored" data-number="12.1" data-anchor-id="x11-issues"><span class="header-section-number">12.1</span> X11 issues</h2>
<p>The <code>X11()</code> graphics device is the one started automatically on Unix-alikes (except most macOS builds) when plotting. As its name implies, it displays on a (local or remote) X server, and relies on the services provided by the X server.</p>
<p>The ‘modern’ version of the <code>X11()</code> device is based on <code>cairo</code> graphics and (in most implementations) uses <code>fontconfig</code> to pick and render fonts. This is done on the server, and although there can be selection issues, they are more amenable than the issues with <code>X11()</code> discussed in the rest of this section.</p>
<div class="page-columns page-full"><p>When X11 was designed, most displays were around 75dpi, whereas today they are of the order of 100dpi or more. If you find that X11() is reporting<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> missing font sizes, especially larger ones, it is likely that you are not using scalable fonts and have not installed the 100dpi versions of the X11 fonts. The names and details differ by system, but will likely have something like Fedora’s</p><div class="no-row-height column-margin column-container"><li id="fn1" role="doc-endnote"><p><sup>1</sup>&nbsp;for example, <code>X11 font at size 14 could not be loaded</code>.</p></li></div></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>xorg<span class="sc">-</span>x11<span class="sc">-</span>fonts<span class="sc">-</span>75dpi</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>xorg<span class="sc">-</span>x11<span class="sc">-</span>fonts<span class="sc">-</span>100dpi</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>xorg<span class="sc">-</span>x11<span class="sc">-</span>fonts<span class="sc">-</span>ISO8859<span class="dv">-2</span><span class="sc">-</span>75dpi</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>xorg<span class="sc">-</span>x11<span class="sc">-</span>fonts<span class="sc">-</span>Type1</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>xorg<span class="sc">-</span>x11<span class="sc">-</span>fonts<span class="sc">-</span>cyrillic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and you need to ensure that the <code>-100dpi</code> versions are installed and on the X11 font path (check via <code>xset -q</code>). The <code>X11()</code> device does try to set a pointsize and not a pixel size: laptop users may find the default setting of 12 too large (although very frequently laptop screens are set to a fictitious dpi to appear like a scaled-down desktop screen).</p>
<p>More complicated problems can occur in non-Western-European locales, so if you are using one, the first thing to check is that things work in the <code>C</code> locale. The likely issues are a failure to find any fonts or glyphs being rendered incorrectly (often as a pair of ASCII characters). X11 works by being asked for a font specification and coming up with its idea of a close match. For text (as distinct from the symbols used by plotmath), the specification is the first element of the option <code>"X11fonts"</code> which defaults to</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="st">"-adobe-helvetica-%s-%s-*-*-%d-*-*-*-*-*-*-*"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you are using a single-byte encoding, for example ISO 8859-2 in Eastern Europe or KOI8-R in Russian, use <code>xlsfonts</code> to find an appropriate family of fonts in your encoding (the last field in the listing). If you find none, it is likely that you need to install further font packages, such as <code>xorg-x11-fonts-ISO8859-2-75dpi</code> and <code>xorg-x11-fonts-cyrillic</code> shown in the listing above.</p>
<p>Multi-byte encodings (most commonly UTF-8) are even more complicated. There are few fonts in <code>iso10646-1</code>, the Unicode encoding, and they only contain a subset of the available glyphs (and are often fixed-width designed for use in terminals). In such locales <em>fontsets</em> are used, made up of fonts encoded in other encodings. If the locale you are using has an entry in the <code>XLC_LOCALE</code> directory (typically <code>/usr/share/X11/locale</code>), it is likely that all you need to do is to pick a suitable font specification that has fonts in the encodings specified there. If not, you may have to get hold of a suitable locale entry for X11. This may mean that, for example, Japanese text can be displayed when running in <code>ja_JP.UTF-8</code> but not when running in <code>en_GB.UTF-8</code> on the same machine (although on some systems many UTF-8 X11 locales are aliased to <code>en_US.UTF-8</code> which covers several character sets, e.g.&nbsp;ISO 8859-1 (Western European), JISX0208 (Kanji), KSC5601 (Korean), GB2312 (Chinese Han) and JISX0201 (Kana)).</p>
<p>On some systems scalable fonts are available covering a wide range of glyphs. One source is TrueType/OpenType fonts, and these can provide high coverage. Another is Type 1 fonts: the URW set of Type 1 fonts provides standard typefaces such as Helvetica with a larger coverage of Unicode glyphs than the standard X11 bitmaps, including Cyrillic. These are generally not part of the default install, and the X server may need to be configured to use them. They might be under the X11 <code>fonts</code> directory or elsewhere, for example,</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span>usr<span class="sc">/</span>share<span class="sc">/</span>fonts<span class="sc">/</span>default<span class="sc">/</span>Type1</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span>usr<span class="sc">/</span>share<span class="sc">/</span>fonts<span class="sc">/</span>ja<span class="sc">/</span>TrueType</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="linux" class="level2 section page-columns page-full" data-number="12.2">
<h2 class="section anchored" data-number="12.2" data-anchor-id="linux"><span class="header-section-number">12.2</span> Linux</h2>
<div class="page-columns page-full"><p>Linux is the main development platform for R, so compilation from the sources is normally straightforward with the most common compilers and libraries.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p><div class="no-row-height column-margin column-container"><li id="fn2" role="doc-endnote"><p><sup>2</sup>&nbsp;For example, <code>glibc</code>: other C libraries such as <code>musl</code> have been used but are not routinely tested.</p></li></div></div>
<p>Recall that some package management systems (such as RPM and deb) make a distinction between the user version of a package and the developer version. The latter usually has the same name but with the extension <code>-devel</code> or <code>-dev</code>: you need both versions installed. So please check the <code>configure</code> output to see if the expected features are detected: if for example <code>readline</code> is missing add the developer package. (On most systems you will also need <code>ncurses</code> and its developer package, although these should be dependencies of the <code>readline</code> package(s).) You should expect to see in the <code>configure</code> summary</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  Interfaces supported<span class="sc">:</span>      X11, tcltk</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  External libraries<span class="sc">:</span>        pcre2, readline, curl</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  Additional capabilities<span class="sc">:</span>   PNG, JPEG, TIFF, NLS, cairo, ICU</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When R has been installed from a binary distribution there are sometimes problems with missing components such as the Fortran compiler. Searching the <code>R-help</code> archives will normally reveal what is needed.</p>
<p>It seems that <code>ix86</code> Linux accepts non-PIC code in shared libraries, but this is not necessarily so on other platforms, in particular on 64-bit CPUs such as <code>x86_64</code>. So care can be needed with BLAS libraries and when building R as a shared library to ensure that position-independent code is used in any static libraries (such as the Tcl/Tk libraries, <code>libpng</code>, <code>libjpeg</code> and <code>zlib</code>) which might be linked against. Fortunately these are normally built as shared libraries with the exception of the ATLAS BLAS libraries.</p>
<p>The default optimization settings chosen for <code>CFLAGS</code> etc are conservative. It is likely that using <code>-mtune</code> will result in significant performance improvements on recent CPUs: one possibility is to add <code>-mtune=native</code> for the best possible performance on the machine on which R is being installed. It is also possible to increase the optimization levels to <code>-O3</code>: however for many versions of the compilers this has caused problems in at least one CRAN package.</p>
<p>For platforms with both 64- and 32-bit support, it is likely that</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>LDFLAGS<span class="ot">=</span><span class="st">"-L/usr/local/lib64 -L/usr/local/lib"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>is appropriate since most (but not all) software installs its 64-bit libraries in <code>/usr/local/lib64</code>. To build a 32-bit version of R on <code>x86_64</code> with Fedora 32 we used</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span><span class="ch">=</span><span class="st">"gcc -m32"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CXX</span><span class="ch">=</span><span class="st">"g++ -m32"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="dt">FC</span><span class="ch">=</span><span class="st">"gfortran -m32"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJC</span><span class="ch">=${</span><span class="dt">CC</span><span class="ch">}</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="dt">LDFLAGS</span><span class="ch">=</span><span class="st">"-L/usr/local/lib"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBnn</span><span class="ch">=</span><span class="st">lib</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note the use of <code>LIBnn</code>: <code>x86_64</code> Fedora installs its 64-bit software in <code>/usr/lib64</code> and 32-bit software in <code>/usr/lib</code>. Linking will skip over inappropriate binaries, but for example the 32-bit Tcl/Tk configure scripts are in <code>/usr/lib</code>. It may also be necessary to set the <code>pkg-config</code> path, e.g.&nbsp;by</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>export PKG_CONFIG_PATH<span class="op">=/</span>usr<span class="op">/</span>local<span class="op">/</span>lib<span class="op">/</span>pkgconfig<span class="op">:/</span>usr<span class="op">/</span>lib<span class="op">/</span>pkgconfig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The 32-bit system <code>libcurl</code> did not work with the system CA certificates: this is worked around in R’s test suite.</p>
<p>64-bit versions on Linux are built with support for files &gt; 2Gb, and 32-bit versions will be if possible unless <code>--disable-largefile</code> is specified.</p>
<p>Note that 32-bit <code>glibc</code> before version 2.29 uses a 32-bit <code>time_t</code> type, so to pass all the date-time checks needs R built with flag <code>--with-internal-tzcode</code>.</p>
<div class="page-columns page-full"><p>Users of <code>ix86</code> CPUs with SSE2 support<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> may prefer to use the C/C++/Fortran flags</p><div class="no-row-height column-margin column-container"><li id="fn3" role="doc-endnote"><p><sup>3</sup>&nbsp;Likely all since 2005, including Pentium 4 and all <code>x86_64</code> CPUs with 32-bit compilers.</p></li></div></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span>mfpmath<span class="ot">=</span>sse <span class="sc">-</span>msse2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>to force floating-point to use the same instructions as <code>x86_64</code> builds and hence not make use of 80-bit ‘extended precision’ intermediate results. (NB: this affects more than floating-point operations. For some OSes and versions of <code>gcc</code> it might be necessary to add <code>-mstackrealign</code>.)</p>
<p>To build a 64-bit version of R on <code>ppc64</code> (also known as <code>powerpc64</code>) with <code>gcc</code>&nbsp;4.1.1, Ei-ji Nakama used</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span><span class="ch">=</span><span class="st">"gcc -m64"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CXX</span><span class="ch">=</span><span class="st">"gxx -m64"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dt">FC</span><span class="ch">=</span><span class="st">"gfortran -m64"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span><span class="ch">=</span><span class="st">"-mminimal-toc -fno-optimize-sibling-calls -g -O2"</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="dt">FFLAGS</span><span class="ch">=</span><span class="st">"-mminimal-toc -fno-optimize-sibling-calls -g -O2"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>the additional flags being needed to resolve problems linking against <code>libnmath.a</code> and when linking R as a shared library.</p>
<p>The setting of the macro <code>SAFE_FFLAGS</code> may need some help. It should not need additional flags on platforms other than <code>68000</code> (not likely to be encountered) and <code>ix86</code>. For the latter, if the Fortran compiler is GNU (<code>gfortran</code> or possibly <code>g77</code>) the flags</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span>msse2 <span class="sc">-</span>mfpmath<span class="ot">=</span>sse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>are added: earlier versions of R added <code>-ffloat-store</code> and this might still be needed if a <code>ix86</code> CPU is encountered without SSE2 support. Note that it is a <em>replacement</em> for <code>FFLAGS</code>, so should include all the flags in that macro (except perhaps the optimization level).</p>
<p>Additional compilation flags can be specified for added safety/security checks. For example Fedora adds</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">-Werror</span><span class="ch">=</span><span class="st">format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ch">-</span><span class="fu">Fexceptions -fstack-protector-strong -fasynchronous-unwind-tables</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ch">-</span><span class="fu">fstack-clash-protection -fcf-protection</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>to all the C, C++ and Fortran compiler flags (even though <code>_GLIBCXX_ASSERTIONS</code> is only for C++ in current GCC and <code>glibc</code> and none of these are documented for <code>gfortran</code>). Use of <code>_GLIBCXX_ASSERTIONS</code> will link <code>abort</code> and <code>printf</code> into almost all C++ code, and <code>R CMD check --as-cran</code> will warn.</p>
<section id="clang" class="level3 subsection page-columns page-full" data-number="12.2.1">
<h3 class="subsection anchored" data-number="12.2.1" data-anchor-id="clang"><span class="header-section-number">12.2.1</span> Clang</h3>
<p>R has been built with Linux <code>ix86</code> and <code>x86_64</code> C and C++ compilers (<a href="https://clang.llvm.org" class="uri">https://clang.llvm.org</a>) based on the Clang front-ends, invoked by <code>CC=clang CXX=clang++</code>, together with <code>gfortran</code>. These take very similar options to the corresponding GCC compilers.</p>
<p>This has to be used in conjunction with a Fortran compiler: the <code>configure</code> code will remove <code>-lgcc</code> from <code>FLIBS</code>, which is needed for some versions of <code>gfortran</code>.</p>
<p>The current out-of-the-box default for <code>clang++</code> is to use the C++ runtime from the installed <code>g++</code>. Using the runtime from the <a href="https://libcxx.llvm.org/"><code>libc++</code></a> project (Fedora RPM <code>libcxx-devel</code>) <em>via</em> <code>-stdlib=libc++</code> has also been tested.</p>
<div class="page-columns page-full"><p>Recent versions have (optional when built) OpenMP support.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p><div class="no-row-height column-margin column-container"><li id="fn4" role="doc-endnote"><p><sup>4</sup>&nbsp;This also needs the OpenMP runtime which has sometimes been distributed separately.</p></li></div></div>
<p>There is a project called <code>flang</code> (<a href="https://github.com/flang-compiler/flang" class="uri">https://github.com/flang-compiler/flang</a>)) to develop a Fortran compiler similar to clang but based on the Portland Group’s front end. This needs something like</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>FC<span class="ot">=</span><span class="er">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>flang<span class="sc">/</span>bin<span class="sc">/</span>flang</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>LDFLAGS<span class="ot">=</span><span class="st">"-L/usr/local/flang/lib -L/usr/local/lib64"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that <code>flang</code> accepts all the flags which <code>clang</code> does (the driver is a modified version of <code>clang</code>, and <code>flang</code> is a symbolic link to <code>clang</code>), but does not implement all of them for Fortran compilation: it also accepts most PGI-style flags such as <code>-mp</code> for OpenMP. It currently produces few diagnostics even with <code>-Wall -pedantic</code>.</p>
<p><code>flang</code>s Fortran runtime is compiled against OpenMP and it seems this conflicts with using OpenMP in R. So it may be necessary to disable the latter by configuring R using <code>--disable-openmp</code>.</p>
<p>It is not clear what architectures <code>flang</code> intends to support: our experiments were done on <code>x86_64</code>. At the time of writing binary ‘releases’ were available for that platform (called by them <code>x86</code>) and <code>ppc64le</code>.</p>
</section>
<section id="intel-compilers" class="level3 subsection" data-number="12.2.2">
<h3 class="subsection anchored" data-number="12.2.2" data-anchor-id="intel-compilers"><span class="header-section-number">12.2.2</span> Intel compilers</h3>
<p>Intel compilers have been used under <code>ix86</code> and <code>x86_64</code> Linux. Brian Ripley used version 9.0 of the compilers for <code>x86_64</code> on Fedora Core 5 with</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>CC<span class="op">=</span>icc</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>CFLAGS<span class="op">=</span><span class="st">"-g -O3 -wd188 -ip -mp"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>FC<span class="op">=</span>ifort</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>FLAGS<span class="op">=</span><span class="st">"-g -O3 -mp"</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>CXX<span class="op">=</span>icpc</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>CXXFLAGS<span class="op">=</span><span class="st">"-g -O3 -mp"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>ICC_LIBS<span class="op">=/</span>opt<span class="op">/</span>compilers<span class="op">/</span>intel<span class="op">/</span>cce<span class="op">/</span><span class="fl">9.1</span><span class="er">.039</span><span class="op">/</span>lib</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>IFC_LIBS<span class="op">=/</span>opt<span class="op">/</span>compilers<span class="op">/</span>intel<span class="op">/</span>fce<span class="op">/</span><span class="fl">9.1</span><span class="er">.033</span><span class="op">/</span>lib</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>LDFLAGS<span class="op">=</span><span class="st">"-L$ICC_LIBS -L$IFC_LIBS -L/usr/local/lib64"</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>SHLIB_CXXLD<span class="op">=</span>icpc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It may be necessary to use <code>CC="icc -std=c99"</code> or <code>CC="icc -c99"</code> for C99-compliance. The flag <code>-wd188</code> suppresses a large number of warnings about the enumeration type <code>Rboolean</code>. Because the Intel C compiler sets <code>__GNUC__</code> without complete emulation of <code>gcc</code>, we suggest adding <code>CPPFLAGS=-no-gcc</code>.</p>
<p>To maintain correct IEC&nbsp;60559 arithmetic you most likely need add flags to <code>CFLAGS</code>, <code>FFLAGS</code> and <code>CXXFLAGS</code> such as <code>-mp</code> (shown above) or <code>-fp-model precise -fp-model source</code>, depending on the compiler version.</p>
<p>Others have reported success with versions 10.x and 11.x. Bjørn-Helge Mevik reported success with version 2015.3 of the compilers, using (for a SandyBridge CPU on Centos 6.x)</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">fast</span><span class="ch">=</span><span class="st">"-fp-model precise -ip -O3 -opt-mem-layout-trans=3 -xHost -mavx"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span><span class="ch">=</span><span class="st">icc</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dt">CFLAGS</span><span class="ch">=</span><span class="st">"</span><span class="ch">$f</span><span class="st">ast -wd188"</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dt">FC</span><span class="ch">=</span><span class="st">ifort</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="dt">FFLAGS</span><span class="ch">=</span><span class="st">"</span><span class="ch">$f</span><span class="st">ast"</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="dt">CXX</span><span class="ch">=</span><span class="st">icpc</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="dt">CXXFLAGS</span><span class="ch">=</span><span class="st">"</span><span class="ch">$f</span><span class="st">ast"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It is possible that 32-builds need to force the use of SSE2 instructions in <code>SAFE_FFLAGS</code>, e.g.&nbsp;by</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>SAFE_FFLAGS<span class="ot">=</span><span class="sc">-</span>axsse2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="macos" class="level2 section page-columns page-full" data-number="12.3">
<h2 class="section anchored" data-number="12.3" data-anchor-id="macos"><span class="header-section-number">12.3</span> macOS</h2>
<p>The main instructions here are for Intel 64-bit (<code>x86_64</code>) builds on 10.13–10.15 (High Sierra, Mojave and Catalina), 11 (Big Sur) and 12 (Monterey).</p>
<section id="prerequisites" class="level3 subsection page-columns page-full" data-number="12.3.1">
<h3 class="subsection anchored" data-number="12.3.1" data-anchor-id="prerequisites"><span class="header-section-number">12.3.1</span> Prerequisites</h3>
<p>The following are essential to build R:</p>
<ul>
<li><p>Apple’s ‘Command Line Tools’: these can be (re-)installed by running <code>xcode-select --install</code> in a terminal.</p>
<p>If you have a fresh OS installation, running e.g.&nbsp;<code>make</code> in a terminal will offer the installation of the command-line tools. If you have installed Xcode, this provides the command-line tools. The tools may need to be reinstalled when macOS is upgraded, as upgrading may partially or completely remove them.</p>
<p>The Command Line Tools provide C and C++ compilers derived from LLVM’s <code>clang</code> but nowadays known as ‘Apple clang’ with different versioning (so Apple clang 12 is unrelated to LLVM clang 12).</p></li>
<li><p>A Fortran compiler. An installer for <code>gfortran</code> is available at <a href="https://github.com/fxcoudert/gfortran-for-macOS/releases/download/8.2/gfortran-8.2-Mojave.dmg" class="uri">https://github.com/fxcoudert/gfortran-for-macOS/releases/download/8.2/gfortran-8.2-Mojave.dmg</a>.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> This installs into <code>/usr/local/gfortran</code>.</p></li>
<li><p>Binary components <code>pcre2</code> and <code>xz</code> (for <code>liblzma</code>) from <a href="https://mac.R-project.org/libs-4/" class="uri">https://mac.R-project.org/libs-4/</a>. For example</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-OL</span> https://mac.r-project.org/libs-4/pcre2-10.34-darwin.17-x86_64.tar.gz</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> tar <span class="at">-xvzf</span> pcre2-10.34-darwin.17-x86_64.tar.gz <span class="at">-C</span> /</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-OL</span> https://mac.r-project.org/libs-4/xz-5.2.4-darwin.17-x86_64.tar.gz</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> tar <span class="at">-xvzf</span> xz-5.2.4-darwin.17-x86_64.tar.gz <span class="at">-C</span> /</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(Messages like <code>usr/local/: Can't restore time</code> should be ignored.)</p></li>
</ul>
<div class="no-row-height column-margin column-container"><li id="fn5" role="doc-endnote"><p><sup>5</sup>&nbsp;This is said to be for Mojave and later but works well enough on High Sierra.</p></li></div><p>and desirable</p>
<ul>
<li><p>GNU <code>readline</code> from <a href="https://mac.R-project.org/libs-4/" class="uri">https://mac.R-project.org/libs-4/</a>,<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. If <code>readline</code> is not present, the emulation in Apple’s version of <code>libedit</code> (aka <code>editline</code>) will be used: if you wish to avoid that, configure with <code>--without-readline</code>.</p></li>
<li><p>Components <code>jpeg</code>, <code>libpng</code>, <code>pkgconfig</code>, <code>tiff</code> and <code>zlib-system-stub</code> from <a href="https://mac.R-project.org/libs-4/" class="uri">https://mac.R-project.org/libs-4/</a>, for the full range of bitmapped graphics devices. (Some builds of <code>tiff</code> may require <code>libwepb</code> and/or <code>openjpeg</code>.)</p></li>
<li><p>An X sub-system unless configuring using <code>--without-x</code>: see <a href="https://www.xquartz.org/" class="uri">https://www.xquartz.org/</a>. R’s <code>configure</code> script can be told to look for <code>X11</code> in XQuartz’s main location of <code>/opt/X11</code>, e.g.&nbsp;by</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>x<span class="sc">-</span>includes<span class="ot">=</span><span class="er">/</span>opt<span class="sc">/</span>X11<span class="sc">/</span>include <span class="sc">--</span>x<span class="sc">-</span>libraries<span class="ot">=</span><span class="er">/</span>opt<span class="sc">/</span>X11<span class="sc">/</span>lib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>although without this linked versions under <code>/usr/X11</code> will be found. (It seems that for some versions of macOS/XQuartz <code>/usr/X11</code> may exist but be a link to a non-existent directory: reinstalling XQuartz might help.) Be wary of pre-release versions of XQuartz, which may be offered as an update.</p></li>
<li><p>An Objective-C compiler, as provided by <code>clang</code> in the Command Line Tools: this is needed for the <code>quartz()</code> graphics device.</p>
<p>Use <code>--without-aqua</code> if you want a standard Unix-alike build: apart from disabling <code>quartz()</code> and the ability to use the build with <span class="small">R.APP</span>, it also changes the default location of the personal library (see <code>?.libPaths</code>).</p></li>
<li><p>Support for Cairo-based graphics devices. See <a href="#cairo-graphics">Cairo graphics</a>.</p></li>
<li><p>A TeX installation. See <a href="#other-libraries">Other libraries</a>.</p></li>
<li><p><code>texi2any</code> from a <code>texinfo</code> distribution, which requires <code>perl</code> (currently version 5.18 (High Sierra) – 5.28 is a default part of macOS but it has been announced that it may not be in future). A version of <code>texi2any</code> has been included in the binary distribution of R and there is a <code>texinfo</code> component at <a href="https://mac.R-project.org/libs-4/" class="uri">https://mac.R-project.org/libs-4/</a>.</p></li>
</ul>
<div class="no-row-height column-margin column-container"><li id="fn6" role="doc-endnote"><p><sup>6</sup>&nbsp;For licence reasons this is version 5.2 of <code>readline</code>: for those who want a more recent version it is straightforward to compile it from its sources.</p></li></div><p>To build R itself from the sources with the compilers in the Command Line Tools (or Xcode) and <code>gfortran</code> from the installer mentioned above, use a file <code>config.site</code> containing</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span><span class="ch">=</span><span class="st">clang</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJC</span><span class="ch">=$C</span><span class="st">C</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="dt">FC</span><span class="ch">=</span><span class="st">/usr/local/gfortran/bin/gfortran</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="dt">CXX</span><span class="ch">=</span><span class="st">clang++</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and configure by something like</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">./</span>configure <span class="op">-</span>C \</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="op">--</span>enable<span class="op">-</span>R<span class="op">-</span>shlib <span class="op">--</span>enable<span class="op">-</span>memory<span class="op">-</span>profiling \</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="op">--</span>x<span class="op">-</span>includes<span class="op">=/</span>opt<span class="op">/</span>X11<span class="op">/</span>include <span class="op">--</span>x<span class="op">-</span>libraries<span class="op">=/</span>opt<span class="op">/</span>X11<span class="op">/</span>lib \</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="op">--</span>with<span class="op">-</span>tcl<span class="op">-</span>config<span class="op">=/</span>usr<span class="op">/</span>local<span class="op">/</span>lib<span class="op">/</span>tclConfig<span class="op">.</span>sh \</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="op">--</span>with<span class="op">-</span>tk<span class="op">-</span>config<span class="op">=/</span>usr<span class="op">/</span>local<span class="op">/</span>lib<span class="op">/</span>tkConfig<span class="op">.</span>sh \</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>PKG_CONFIG_PATH<span class="op">=/</span>opt<span class="op">/</span>X11<span class="op">/</span>lib<span class="op">/</span>pkgconfig<span class="op">:/</span>usr<span class="op">/</span>local<span class="op">/</span>lib<span class="op">/</span>pkgconfig<span class="op">:/</span>usr<span class="op">/</span>lib<span class="op">/</span>pkgconfig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(See below for Tcl/Tk, including other options.)</p>
<p>To install packages using compiled code one needs the Command Line Tools (or Xcode) and appropriate compilers, e.g.&nbsp;Fortran and the C/C++ compilers from those tools. Some packages have further requirements such as <code>pkg-config</code>.</p>
<div class="page-columns page-full"><p>A subversion client, <code>svn</code> version 1.10, used to be part of macOS<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>. A more recent client can be obtained from <a href="https://mac.r-project.org/tools/" class="uri">https://mac.r-project.org/tools/</a>, for example by</p><div class="no-row-height column-margin column-container"><li id="fn7" role="doc-endnote"><p><sup>7</sup>&nbsp;but as a stub invoking an executable provided by the Command Line Tools and the latter is not in versions 11.5 and later of the Command Line Tools.</p></li></div></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-OL</span> https://mac.r-project.org/tools/subversion-1.14.0-darwin15.6.tar.gz</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> xf subversion-1.14.0-darwin15.6.tar.gz</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cp subversion-1.14.0-darwin15.6/svn /usr/local/bin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="page-columns page-full"><p>If you have a build<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> of <code>cairo</code> with dynamic libraries, you can add option <code>--without-static-cairo</code> to the <code>configure</code> call (it probably would work anyway).</p><div class="no-row-height column-margin column-container"><li id="fn8" role="doc-endnote"><p><sup>8</sup>&nbsp;For example, some Homebrew distributions.</p></li></div></div>
<p>As from Command Line Tools version 12, <code>-Wno-implicit-function-declaration</code> needs to be included in <code>CFLAGS</code> to configure R up to 4.0.2 and earlier as well as some external software.</p>
</section>
<section id="note-for-catalina-and-later-users" class="level3 subsubsection page-columns page-full" data-number="12.3.2">
<h3 class="subsubsection anchored" data-number="12.3.2" data-anchor-id="note-for-catalina-and-later-users"><span class="header-section-number">12.3.2</span> Note for Catalina and later users</h3>
<p>A more recent Fortran compiler for Catalina and later is available at <a href="https://github.com/fxcoudert/gfortran-for-macOS/releases/download/10.2/gfortran-10.2-Catalina.dmg" class="uri">https://github.com/fxcoudert/gfortran-for-macOS/releases/download/10.2/gfortran-10.2-Catalina.dmg</a>. (That does not run on High Sierra.) This supports the option <code>-fc-prototypes-external</code> mentioned in the ‘Writing R Extensions’ manual.</p>
<p>For Big Sur and later there is <a href="https://github.com/fxcoudert/gfortran-for-macOS/releases/download/11.1-bigsur-intel/gfortran-Intel-11.1-BigSur.dmg" class="uri">https://github.com/fxcoudert/gfortran-for-macOS/releases/download/11.1-bigsur-intel/gfortran-Intel-11.1-BigSur.dmg</a>..</p>
<div class="page-columns page-full"><p>The default security settings for Catalina and later can make it difficult to install recently-built Apple packages which have not been ‘notarized’<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> by Apple. And not just packages, as this has been seen for executables contained in tarballs/zipfiles (for example, for <code>pandoc</code>). Usually one can use <code>Open With</code> (Control/right/two-finger-click in Finder), then select <code>Installer</code> and <code>Open</code> if you get a further warning message. This applies also to some ‘nightly builds’ from <a href="https://mac.R-project.org/" class="uri">https://mac.R-project.org/</a>.</p><div class="no-row-height column-margin column-container"><li id="fn9" role="doc-endnote"><p><sup>9</sup>&nbsp;See <a href="https://developer.apple.com/documentation/xcode/notarizing_macos_software_before_distribution" class="uri">https://developer.apple.com/documentation/xcode/notarizing_macos_software_before_distribution</a>.</p></li></div></div>
<p>If you run into problems with ‘quarantine’ for tarballs downloaded in a browser, consider using <code>curl -OL</code> to download (as illustrated above) or <code>xattr -c</code> to remove extended attributes.</p>
<p>Should one want to build R for Intel on an <code>arm64</code> Big Sur Mac, add the target for the C and C++ compilers:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span><span class="ch">=</span><span class="st">"clang -arch x86_64</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJC</span><span class="ch">=$C</span><span class="st">C</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="dt">CXX</span><span class="ch">=</span><span class="st">"clang++ -arch x86_64"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and install the Fortran compiler and external software as described above.</p>
</section>
<section id="cairo-graphics" class="level3 subsection" data-number="12.3.3">
<h3 class="subsection anchored" data-number="12.3.3" data-anchor-id="cairo-graphics"><span class="header-section-number">12.3.3</span> Cairo graphics</h3>
<p>Cairo-based graphics devices such as <code>cairo_ps</code>, <code>cairo_pdf</code>, <code>X11(type = "cairo")</code> and the Cairo-based types of devices <code>bmp</code> <code>jpeg</code>, <code>png</code> and <code>tiff</code> are not the default on macOS, and much less used than the Quartz-based devices. However, the only SVG device in the R distribution, <code>svg</code>, is based on Cairo.</p>
<p>Support for Cairo is optional and can be added in several ways, all of which need <code>pkg-config</code>. <code>configure</code> will add Cairo support if <code>pkg-config</code> finds package <code>cairo</code> unless <code>--without-cairo</code> is used.</p>
<p>A way to statically link Cairo is by downloading and unpacking components <code>cairo</code>, <code>fontconfig</code>, <code>freetype</code>, <code>pixman</code> and <code>zlib-system-stub</code> (and do not have <code>/opt/X11/lib/pkgconfig</code> in <code>PKG_CONFIG_PATH</code>). Some static builds of <code>fontconfig</code> need <code>libxml2</code> (from component <code>xml2</code>) and others <code>expat</code>, supplied by macOS but needing a file <code>/usr/local/lib/pkgconfig/expat.pc</code> along the lines of</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Name<span class="sc">:</span> expat</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>Version<span class="sc">:</span> <span class="dv">2</span>.<span class="fl">2.8</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>Description<span class="sc">:</span> expat XML parser</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>URL<span class="sc">:</span> http<span class="sc">:</span><span class="er">//</span>www.libexpat.org</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>Libs<span class="sc">:</span> <span class="sc">-</span>lexpat</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>Cflags<span class="sc">:</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the list of components is liable to change: running <code>pkg-config cairo --exists --print-errors</code> should tell you if any others are required.</p>
<p>If you have XQuartz 2.7.x installed (not 2.8.x) and ensure XQuartz’s <code>pkg-config</code> files are found first on its configuration path, Cairo will be linked dynamically. This can be done by setting something like</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>export PKG_CONFIG_PATH<span class="op">=/</span>opt<span class="op">/</span>X11<span class="op">/</span>lib<span class="op">/</span>pkgconfig<span class="op">:/</span>usr<span class="op">/</span>local<span class="op">/</span>lib<span class="op">/</span>pkgconfig<span class="op">:/</span>usr<span class="op">/</span>lib<span class="op">/</span>pkgconfig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or by appending that variable to the <code>configure</code> command. (Note that this uses rather old versions of the graphics software.)</p>
<p>If you use XQuartz or another build of <code>cairo</code> with dynamic libraries, you can add option <code>--without-static-cairo</code> to the <code>configure</code> call (it may work without).</p>
<p>The best font experience of Cairo graphics will be to use it in combination with Pango which will match that supported on most other Unix-alikes. <code>configure</code> uses <code>pkg-config</code> to determine if all the external software required by both Pango and Cairo is available: running <code>pkg-config pangocairo --exists --print-errors</code> should show if the installation suffices and if not, what is missing. At the time of writing pre-built components were available only for <code>arm64</code>, where components <code>cairo</code>, <code>fontconfig</code>, <code>freetype</code>, <code>ffi</code>, <code>glib</code>, <code>harfbuzz</code>, <code>pango</code> and <code>xml2</code> sufficed.</p>
</section>
<section id="other-cc-compilers" class="level3 subsection page-columns page-full" data-number="12.3.4">
<h3 class="subsection anchored" data-number="12.3.4" data-anchor-id="other-cc-compilers"><span class="header-section-number">12.3.4</span> Other C/C++ compilers</h3>
<p>Other distributions of <code>clang</code> may be available from <a href="https://github.com/llvm/llvm-project/releases/" class="uri">https://github.com/llvm/llvm-project/releases/</a>. In particular, these include support for OpenMP which Apple builds of <code>clang</code> do not.</p>
<p>Suppose one of these distributions is installed under <code>/usr/local/clang</code>. Use a file <code>config.site</code> containing</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>CC<span class="op">=/</span>usr<span class="op">/</span>local<span class="op">/</span>clang<span class="op">/</span>bin<span class="op">/</span>clang</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>OBJC<span class="op">=</span>$CC</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>FC<span class="op">=/</span>usr<span class="op">/</span>local<span class="op">/</span>gfortran<span class="op">/</span>bin<span class="op">/</span>gfortran</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>CXX<span class="op">=/</span>usr<span class="op">/</span>local<span class="op">/</span>clang<span class="op">/</span>bin<span class="op">/</span>clang<span class="op">++</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>LDFLAGS<span class="op">=</span><span class="st">"-L/usr/local/clang/lib -L/usr/local/lib"</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>R_LD_LIBRARY_PATH<span class="op">=/</span>usr<span class="op">/</span>local<span class="op">/</span>clang<span class="op">/</span>lib<span class="op">:/</span>usr<span class="op">/</span>local<span class="op">/</span>lib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The care to specify library paths is to ensure that the OpenMP runtime library, here <code>/usr/local/clang/lib/libomp.dylib</code>, is found when needed. If this works, you should see the line</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>checking whether OpenMP SIMD reduction is supported... yes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>in the <code>configure</code> output. Also, <code>R_LD_LIBRARY_PATH</code> needs to be set to find the latest version of the C++ run-time libraries rather than the system ones.</p>
<p>For Mojave and later the system paths need to be specified <em>via</em></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span><span class="ch">=</span><span class="st">"/usr/local/clang/bin/clang -isysroot</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk<span class="st">"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="dt">CXX</span><span class="ch">=</span><span class="st">"/usr/local/clang/bin/clang++ -isysroot</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a> /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk<span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(Long lines split for the manual, only.) Should the location of the SDK change (or where Xcode provides the SDK rather than the Command Line Tools), it can be found by running <code>xcrun -show-sdk-path</code>.</p>
<div class="page-columns page-full"><p>It is usually possible to build R with GCC (built from the sources, from a <code>gfortran</code> distribution, from Homebrew, …). When last tested<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a> it was not possible to use <code>gcc</code> to build the <code>quartz()</code> device, so <code>configure --without-aqua</code> may be required.</p><div class="no-row-height column-margin column-container"><li id="fn10" role="doc-endnote"><p><sup>10</sup>&nbsp;with <code>gcc</code> 10.2.</p></li></div></div>
</section>
<section id="other-libraries" class="level3 subsection page-columns page-full" data-number="12.3.5">
<h3 class="subsection anchored" data-number="12.3.5" data-anchor-id="other-libraries"><span class="header-section-number">12.3.5</span> Other libraries</h3>
<p>Pre-compiled versions of many of the <a href="Essential-and-useful-other-programs-under-a-Unix_002dalike.html#useful-libraries-and-programs">Useful libraries and programs</a> are available from <a href="https://mac.R-project.org/libs-4/" class="uri">https://mac.R-project.org/libs-4/</a> or <a href="https://mac.R-project.org/libs/" class="uri">https://mac.R-project.org/libs/</a>.</p>
<div class="page-columns page-full"><p>The <code>Accelerate</code> library<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a> can be used <em>via</em> the configuration option</p><div class="no-row-height column-margin column-container"><li id="fn11" role="doc-endnote"><p><sup>11</sup>&nbsp;<a href="https://developer.apple.com/documentation/accelerate" class="uri">https://developer.apple.com/documentation/accelerate</a>.</p></li></div></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>with<span class="sc">-</span>blas<span class="ot">=</span><span class="st">"-framework Accelerate"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="page-columns page-full"><p>to provide potentially higher-performance versions of the BLAS and LAPACK routines.<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a> This also includes a full LAPACK which can be used <em>via</em> <code>--with-lapack</code>: however, the version of LAPACK it contains has often been seriously old (and is not used unless <code>--with-lapack</code> is specified).</p><div class="no-row-height column-margin column-container"><li id="fn12" role="doc-endnote"><p><sup>12</sup>&nbsp;It has been reported that for some non-Apple toolchains <code>CPPFLAGS</code> needed to contain <code>-D__ACCELERATE__</code>: not needed for <code>clang</code> from <a href="https://releases.llvm.org" class="uri">https://releases.llvm.org</a> though.</p></li></div></div>
<p>Threading in Accelerate is controlled by ‘Grand Central Dispatch’ and is said not to need user control. Test <code>nls.R</code> in package <strong>stats</strong> usually fails with the Accelerate BLAS.</p>
<p>Looking at the top of <code>/Library/Frameworks/R.framework/Resources/etc/Makeconf</code> will show the compilers and configuration options used for the CRAN binary package for R: at the time of writing the non-default options</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>enable<span class="sc">-</span>memory<span class="sc">-</span>profiling <span class="sc">--</span>enable<span class="sc">-</span>R<span class="sc">-</span>framework</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>x<span class="sc">-</span>libraries<span class="ot">=</span><span class="er">/</span>opt<span class="sc">/</span>X11<span class="sc">/</span>lib <span class="sc">--</span>x<span class="sc">-</span>includes<span class="ot">=</span><span class="er">/</span>opt<span class="sc">/</span>X11<span class="sc">/</span>include</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>were used. (<code>--enable-R-framework</code> implies <code>--enable-R-shlib</code>.)</p>
<p>Configure option <code>--with-internal-tzcode</code> is the default on macOS, as the system implementation of time zones does not work correctly for times before 1902 or after 2037 (despite using a 64-bit <code>time_t</code>).</p>
<div class="page-columns page-full"><p>The main TeX implementation used by the developers is MacTeX<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a> (<a href="https://www.tug.org/mactex/" class="uri">https://www.tug.org/mactex/</a>): the full installation is about 7.5GB, but a much smaller version (‘Basic TeX’) is available at <a href="https://www.tug.org/mactex/morepackages.html" class="uri">https://www.tug.org/mactex/morepackages.html</a> to which you will need to add some packages to build R, e.g.&nbsp;for the 2021 version we needed to add<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a> <strong>cm-super</strong>, <strong>helvetic</strong>, <strong>inconsolata</strong> and <strong>texinfo</strong> which brought this to about 370MB.<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a> <code>TeX Live Utility</code> (available <em>via</em> the MacTeX front page) provides a graphical means to manage TeX packages. MacTeX 2021 requires Mojave or later: for earlier macOS versions see the instructions<a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a> on the MacTeX front page. It contains executables which run natively on both <code>x86_64</code> and <code>arm64</code>.</p><div class="no-row-height column-margin column-container"><li id="fn13" role="doc-endnote"><p><sup>13</sup>&nbsp;An essentially equivalent TeX installation can be obtained by the Unix TeX Live installation scripts.</p></li><li id="fn14" role="doc-endnote"><p><sup>14</sup>&nbsp;E.g. <em>via</em> <code>tlmgr install cm-super helvetic inconsolata texinfo</code> .</p></li><li id="fn15" role="doc-endnote"><p><sup>15</sup>&nbsp;Adding all the packages needed to check CRAN increased this to about 600MB.</p></li><li id="fn16" role="doc-endnote"><p><sup>16</sup>&nbsp;which amount to installing MacTeX 2020 (whose LaTeX packages are frozen) or TeXLive 2021 (which has been tried and has current updates).</p></li></div></div>
<p>Checking packages thoroughly requires <code>ghostscript</code> (part of the full MacTeX distribution or separately from <a href="https://www.tug.org/mactex/morepackages.html" class="uri">https://www.tug.org/mactex/morepackages.html</a>, including for High Sierra) and <code>qpdf</code> (from <a href="https://mac.R-project.org/libs-4/" class="uri">https://mac.R-project.org/libs-4/</a>, a version of which is in the <code>bin</code> directory of a binary installation of R, usually <code>/Library/Frameworks/R.framework/Resources/bin/qpdf</code>).</p>
<p>One macOS quirk is that the default path has <code>/usr/local/bin</code> after <code>/usr/bin</code>, contrary to common practice on Unix-alikes. This means that if you install tools from the sources they will by default be installed under <code>/usr/local</code> and not supersede the system versions.</p>
<p>Parallel installation of packages will make use of the utility <code>timeout</code> if available. A dual-architecture build can be downloaded from <a href="https://www.stats.ox.ac.uk/pub/bdr/timeout" class="uri">https://www.stats.ox.ac.uk/pub/bdr/timeout</a>: make it executable (<code>chmod 755 timeout</code>) and put it somewhere on your path.</p>
</section>
<section id="tcltk-headers-and-libraries" class="level3 subsection page-columns page-full" data-number="12.3.6">
<h3 class="subsection anchored" data-number="12.3.6" data-anchor-id="tcltk-headers-and-libraries"><span class="header-section-number">12.3.6</span> Tcl/Tk headers and libraries</h3>
<div class="page-columns page-full"><p>If you plan to use the <code>tcltk</code> package for R, you need to install a distribution of Tcl/Tk. There are two alternatives. If you use <span class="small">R.APP</span> you will want to use X11-based Tcl/Tk (as used on other Unix-alikes), which is installed under <code>/usr/local/lib</code> as part of the CRAN binary for R.<a href="#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a> This may need <code>configure</code> options</p><div class="no-row-height column-margin column-container"><li id="fn17" role="doc-endnote"><p><sup>17</sup>&nbsp;Just that component can be selected from the installer for R: at the ‘Installation Type’ screen select ‘Customise’ and then just the ‘Tcl/Tk 8.6.6’ component.</p></li></div></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>with<span class="sc">-</span>tcltk<span class="ot">=</span><span class="er">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>lib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>with<span class="sc">-</span>tcl<span class="sc">-</span>config<span class="ot">=</span><span class="er">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>lib<span class="sc">/</span>tclConfig.sh</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>with<span class="sc">-</span>tk<span class="sc">-</span>config<span class="ot">=</span><span class="er">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>lib<span class="sc">/</span>tkConfig.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="page-columns page-full"><p>Note that this requires a matching<a href="#fn18" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a> XQuartz installation.</p><div class="no-row-height column-margin column-container"><li id="fn18" role="doc-endnote"><p><sup>18</sup>&nbsp;At the time of writing the Intel distribution used 2.7.11 and the <code>arm64</code> used 2.8.1.</p></li></div></div>
<div class="page-columns page-full"><p>There is also a native (‘Aqua’) version of Tcl/Tk which produces widgets in the native macOS style: this will not work with <span class="small">R.APP</span> because of conflicts over the macOS menu, but for those only using command-line R this provides a much more intuitive interface to Tk for experienced Mac users. Earlier versions of macOS came with an Aqua Tcl/Tk distribution but these were often not at all recent versions of Tcl/Tk. It is better to install Tcl/Tk 8.6.x from the sources<a href="#fn19" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a> or a binary distribution from <a href="https://www.activestate.com/activetcl/downloads" class="uri">https://www.activestate.com/activetcl/downloads</a>. For the latter, configure R with</p><div class="no-row-height column-margin column-container"><li id="fn19" role="doc-endnote"><p><sup>19</sup>&nbsp;Configure Tk with <code>--enable-aqua</code>.</p></li></div></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>with<span class="sc">-</span>tcl<span class="sc">-</span>config<span class="ot">=</span><span class="er">/</span>Library<span class="sc">/</span>Frameworks<span class="sc">/</span>Tcl.framework<span class="sc">/</span>tclConfig.sh </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>with<span class="sc">-</span>tk<span class="sc">-</span>config<span class="ot">=</span><span class="er">/</span>Library<span class="sc">/</span>Frameworks<span class="sc">/</span>Tk.framework<span class="sc">/</span>tkConfig.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you need to find out which distribution of Tk is in use at run time, use</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tcltk)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tclvalue</span>(<span class="fu">.Tcl</span>(<span class="st">"tk windowingsystem"</span>))  <span class="co"># "x11" or "aqua"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that some Tcl/Tk extensions only support the X11 interface: this includes <code>Tktable</code> and the CRAN package <a href="https://CRAN.R-project.org/package=tkrplot"><strong>tkrplot</strong></a>.</p>
</section>
<section id="java" class="level3 subsection page-columns page-full" data-number="12.3.7">
<h3 class="subsection anchored" data-number="12.3.7" data-anchor-id="java"><span class="header-section-number">12.3.7</span> Java</h3>
<div class="page-columns page-full"><p>macOS does not comes with an installed Java runtime (JRE) and a macOS upgrade may remove one if already installed: it is intended to be installed at first use. Check if a JRE is installed by running <code>java -version</code> in a <code>Terminal</code> window: if Java is not installed<a href="#fn20" class="footnote-ref" id="fnref20" role="doc-noteref"><sup>20</sup></a> this should prompt you to install it.<a href="#fn21" class="footnote-ref" id="fnref21" role="doc-noteref"><sup>21</sup></a> You can also install directly a recent Java from <a href="https://www.oracle.com/java/technologies/javase-downloads.html">Oracle</a>. Builds of OpenJDK with a less restrictive licence may also be available, e.g.&nbsp;from <a href="https://adoptium.net">Adoptium</a>, <a href="https://www.azul.com/downloads/zulu-community/">Azul</a> or <a href="https://jdk.java.net/" class="uri">https://jdk.java.net/</a>. We recommend you install a version with long-term support, e.g.&nbsp;11 or 17 but not 9, 10, 12–16 or 18 which have/had a 6-month lifetime. (Note that these sources may use unusual designations for Intel macOS builds such as <code>x86 64-bit</code> and <code>x64</code>.)</p><div class="no-row-height column-margin column-container"><li id="fn20" role="doc-endnote"><p><sup>20</sup>&nbsp;In the unlikely event that the version reported does not start with <code>1.8.0</code>, <code>11</code> or higher you need to update your Java.</p></li><li id="fn21" role="doc-endnote"><p><sup>21</sup>&nbsp;Not at the time of writing for <code>arm64</code>.</p></li></div></div>
<p>Binary distributions of R are built against a specific version (e.g. 11.0.6) of Java so <code>sudo R CMD javareconf</code> will likely be needed to be run before using Java-using packages.</p>
<p>To use Java (specifically, package <a href="https://CRAN.R-project.org/package=rJava"><strong>rJava</strong></a>) with a CRAN (<code>x86_64</code>) binary distribution of R on <code>arm64</code> macOS, install an Intel build of a Java JRE from one of the sites linked above, then run <code>sudo R CMD javareconf</code>.</p>
<p>To see what compatible versions of Java are currently installed, run <code>/usr/libexec/java_home -V -a x86_64</code>. If needed, set the environment variable <code>JAVA_HOME</code> to choose between these, both when R is built from the sources and when <code>R CMD javareconf</code> is run.</p>
<p>Configuring and building R both looks for a JRE and for support for compiling JNI programs (used to install packages <a href="https://CRAN.R-project.org/package=rJava"><strong>rJava</strong></a> and <a href="https://CRAN.R-project.org/package=JavaGD"><strong>JavaGD</strong></a>); the latter requires a JDK (Java SDK). Most distributions of Java 9 or later are of a full JDK.</p>
<p>The build process tries to fathom out what JRE/JDK to use, but it may need some help, e.g.&nbsp;by setting environment variable <code>JAVA_HOME</code>. To select a build from <a href="https://adoptium.net">Adoptium</a> set e.g.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>JAVA_HOME<span class="ot">=</span><span class="er">/</span>Library<span class="sc">/</span>Java<span class="sc">/</span>JavaVirtualMachines<span class="sc">/</span>termurin<span class="fl">-11.</span>jdk<span class="sc">/</span>Contents<span class="sc">/</span>Home</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>in <code>config.site</code>. For Java 17 from <a href="https://jdk.java.net/" class="uri">https://jdk.java.net/</a>, use</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>JAVA_HOME<span class="ot">=</span><span class="er">/</span>path<span class="sc">/</span>to<span class="sc">/</span>jdk<span class="fl">-17.</span>jdk<span class="sc">/</span>Contents<span class="sc">/</span>Home</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For an <code>arm64</code> build, the earliest Java version which is officially supported is 17. The currently simplest way to install Java is from <a href="https://adoptium.net">Adoptium</a> (who call the architecture <code>aarch64</code>): this installs into an Apple-standard location and so works with <code>/usr/bin/java</code>. Other builds are available from <a href="https://www.azul.com/downloads/zulu-community/?os=macos&amp;architecture=arm-64-bit&amp;package=jdk" class="uri">https://www.azul.com/downloads/zulu-community/?os=macos&amp;architecture=arm-64-bit&amp;package=jdk</a> and from OpenJDK at <a href="https://jdk.java.net/17/" class="uri">https://jdk.java.net/17/</a>, for which <code>JAVA_HOME</code> may need to be set both when configuring R and at runtime.</p>
<p>Note that it is necessary to set the environment variable <code>NOAWT</code> to <code>1</code> to install many of the Java-using packages.</p>
</section>
<section id="frameworks" class="level3 subsection" data-number="12.3.8">
<h3 class="subsection anchored" data-number="12.3.8" data-anchor-id="frameworks"><span class="header-section-number">12.3.8</span> Frameworks</h3>
<p>The CRAN build of R is installed as a framework, which is selected by the option</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>.<span class="sc">/</span>configure <span class="sc">--</span>enable<span class="sc">-</span>R<span class="sc">-</span>framework</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(This is intended to be used with an Apple toolchain: others may not support frameworks correctly but those from <a href="https://releases.llvm.org" class="uri">https://releases.llvm.org</a> do.)</p>
<p>It is only needed if you want to build R for use with the <span class="small">R.APP</span> console, and implies <code>--enable-R-shlib</code> to build R as a dynamic library. This option configures R to be built and installed as a framework called <code>R.framework</code>. The default installation path for <code>R.framework</code> is <code>/Library/Frameworks</code> but this can be changed at configure time by specifying the flag <code>--enable-R-framework[=DIR]</code> (or <code>--prefix</code>) or at install time <em>via</em></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>make prefix<span class="ot">=</span><span class="er">/</span>where<span class="sc">/</span>you<span class="sc">/</span>want<span class="sc">/</span>R.framework<span class="sc">/</span>to<span class="sc">/</span>go install</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that installation as a framework is non-standard (especially to a non-standard location) and Unix utilities may not support it (e.g.&nbsp;the <code>pkg-config</code> file <code>libR.pc</code> will be put somewhere unknown to <code>pkg-config</code>).</p>
</section>
<section id="building-r.app" class="level3 subsection" data-number="12.3.9">
<h3 class="subsection anchored" data-number="12.3.9" data-anchor-id="building-r.app"><span class="header-section-number">12.3.9</span> Building R.app</h3>
<p>Building the <span class="small">R.APP</span> GUI console is a separate project, using Xcode. Before compiling <span class="small">R.APP</span> make sure the current version of R is installed in <code>/Library/Frameworks/R.framework</code> and working at the command-line (this can be a binary install).</p>
<p>The current sources can be checked out by</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>svn co https<span class="sc">:</span><span class="er">//</span>svn.r<span class="sc">-</span>project.org<span class="sc">/</span>R<span class="sc">-</span>packages<span class="sc">/</span>trunk<span class="sc">/</span>Mac<span class="sc">-</span>GUI</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and built by loading the <code>R.xcodeproj</code> project (select the <code>R</code> target and a suitable configuration), or from the command-line by e.g.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>xcodebuild <span class="sc">-</span>target R <span class="sc">-</span>configuration Release</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See also the <code>INSTALL</code> file in the checkout or directly at <a href="https://svn.r-project.org/R-packages/trunk/Mac-GUI/INSTALL" class="uri">https://svn.r-project.org/R-packages/trunk/Mac-GUI/INSTALL</a>.</p>
<p><span class="small">R.APP</span> does not need to be installed in any specific way. Building <span class="small">R.APP</span> results in the <span class="small">R.APP</span> bundle which appears as one R icon. This application bundle can be run anywhere and it is customary to place it in the <code>/Applications</code> folder.</p>
</section>
<section id="building-binary-packages" class="level3 subsection" data-number="12.3.10">
<h3 class="subsection anchored" data-number="12.3.10" data-anchor-id="building-binary-packages"><span class="header-section-number">12.3.10</span> Building binary packages</h3>
<p>CRAN macOS binary packages are distributed as tarballs with suffix <code>.tgz</code> to distinguish them from source tarballs. One can <code>tar</code> an existing installed package, or use <code>R CMD INSTALL --build</code>.</p>
<p>However, there are some important details.</p>
<ul>
<li><p>Current CRAN <code>x86_64</code> macOS distributions are targeted at High Sierra so it is wise to ensure that the compilers generate code that will run on High Sierra or later. With the recommended compilers we can use <code>makefile     CC="clang -mmacosx-version-min=10.13"     CXX="clang++ -mmacosx-version-min=10.13"     FC="/usr/local/gfortran/bin/gfortran -mmacosx-version-min=10.13"</code></p></li>
<li><p>Using the flag <code>-Werror=partial-availability</code> can help trigger compilation errors on functionality not in High Sierra.</p></li>
<li><p>Check that any compiled code is not dynamically linked to libraries only on your machine, for example by using <code>otool -L</code> or <code>objdump -macho -dylibs-used</code>. This can include C++ and Fortran run-time libraries under <code>/usr/local</code>: one can use <code>install_name_tool</code> to point these at system versions or those shipped with R, for example</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>install_name_tool <span class="sc">-</span>change <span class="sc">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>clang<span class="sc">/</span>lib<span class="sc">/</span>libc<span class="sc">++</span>.<span class="fl">1.</span>dylib \</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span>usr<span class="sc">/</span>lib<span class="sc">/</span>libc<span class="sc">++</span>.<span class="fl">1.</span>dylib \</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>pkg.so</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>install_name_tool <span class="sc">-</span>change <span class="sc">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>gfortran<span class="sc">/</span>lib<span class="sc">/</span>libgfortran.<span class="fl">5.</span>dylib \</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span>Library<span class="sc">/</span>Frameworks<span class="sc">/</span>R.framework<span class="sc">/</span>Resources<span class="sc">/</span>lib<span class="sc">/</span>libgfortran.<span class="fl">5.</span>dylib \</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>pkg.so</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(where the details depend on the compilers and CRAN macOS R release).</p></li>
<li><p>For C++ code there is the possibility that calls will be generated to entry points not in the system <code>/usr/lib/libc++.1.dylib</code>. The previous step allows this to be tested against the system library on the build OS, but not against earlier ones. It may be possible to circumvent that by static linking to <code>libc++.a</code> and <code>libc++abi.a</code> by something like</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>SHLIB_CXXLD <span class="op">=</span> <span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>clang<span class="op">/</span>bin<span class="op">/</span>clang</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>PKG_LIBS <span class="op">=</span> <span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>clang<span class="op">/</span>lib<span class="op">/</span>libc<span class="op">++.</span>a <span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>clang<span class="op">/</span>lib<span class="op">/</span>libc<span class="op">++</span>abi<span class="op">.</span>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>in <code>src/Makevars</code>. It would also be possible to static link the Fortran runtime libraries <code>/usr/local/gfortran/lib/libgfortran.a</code> and <code>/usr/local/gfortran/lib/libquadmath.a</code> should the Fortran compiler have later versions (but <code>gfortran</code> 8, 9, 10 and 11 all have version <code>5.0.0</code>).</p></li>
</ul>
<p>The CRAN binary packages are built with the Apple compiler on High Sierra, which avoids the first two and any issues with C++ libraries.</p>
</section>
<section id="arm64-aka-apple-silicon" class="level3 subsection" data-number="12.3.11">
<h3 class="subsection anchored" data-number="12.3.11" data-anchor-id="arm64-aka-apple-silicon"><span class="header-section-number">12.3.11</span> <code>arm64</code> aka ‘Apple Silicon’</h3>
<p>In November 2020 Apple launched Macs using ‘Apple Silicon’: this architecture has unfortunately many names, including <code>aarch64</code> (in the FOSS world) <code>arm64</code> and <code>arm64e</code> (by Apple): the machines are also known as ‘M1’, Apple’s name for their (first-generation) CPU.</p>
<p>It is possible to build and run R and almost all packages for <code>x86_64</code> using ‘Rosetta’ emulation. To do so, install all the prerequisites and other software described above, but include the flag <code>-arch x86_64</code> for <code>clang</code> and <code>clang++</code>, for example with a <code>config.site</code> file containing</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="dt">CC</span><span class="ch">=</span><span class="st">"clang -arch x86_64"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJC</span><span class="ch">=$C</span><span class="st">C</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="dt">CXX</span><span class="ch">=</span><span class="st">"clang++ -arch x86_64"</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="dt">FC</span><span class="ch">=</span><span class="st">"/usr/local/gfortran/bin/gfortran -mtune=native -mmacosx-version-min=10.13"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To correctly set the architecture (which will be auto-detected as <code>aarch64</code>), use something like</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span>path<span class="sc">/</span>to<span class="sc">/</span>configure <span class="sc">--</span>build<span class="ot">=</span>x86_64<span class="sc">-</span>apple<span class="sc">-</span>darwin20</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="native-builds" class="level3 subsubsection page-columns page-full" data-number="12.3.12">
<h3 class="subsubsection anchored" data-number="12.3.12" data-anchor-id="native-builds"><span class="header-section-number">12.3.12</span> Native builds</h3>
<p>This section follows the CRAN distribution in using <code>/opt/R/arm64</code> rather than <code>/usr/local</code>: this largely allows natively-compiled software to co-exist with compiled-for-Intel software (although the C/C++ compilers and linker will still search <code>/usr/local/include</code> and <code>/usr/local/lib</code>).</p>
<div class="page-columns page-full"><p>No Fortran compiler has been released for this architecture although there are ports under development. We used the fork of <code>gfortran</code> from <a href="https://github.com/iains/gcc-darwin-arm64" class="uri">https://github.com/iains/gcc-darwin-arm64</a> of which there are binary distributions at <a href="https://mac.r-project.org/libs-arm64/" class="uri">https://mac.r-project.org/libs-arm64/</a> and <a href="https://github.com/fxcoudert/gfortran-for-macOS/releases/" class="uri">https://github.com/fxcoudert/gfortran-for-macOS/releases/</a>. It seems some of these have been built using the SDK path for Xcode and not that for the Command Line Tools which causes some problems<a href="#fn22" class="footnote-ref" id="fnref22" role="doc-noteref"><sup>22</sup></a> when using the Fortran compiler to link: to fix that change the symbolic link <code>/opt/R/arm64/gfortran/SDK</code> to point to your SDK, e.g.&nbsp;to <code>/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk</code> (the appropriate path can be found by running <code>xcrun -show-sdk-path</code>).</p><div class="no-row-height column-margin column-container"><li id="fn22" role="doc-endnote"><p><sup>22</sup>&nbsp;such as being unable to find <code>-lm</code>.</p></li></div></div>
<p>A release of XQuartz 2.8.1 is available <em>via</em> <a href="https://www.xquartz.org/releases/" class="uri">https://www.xquartz.org/releases/</a>: this is dual-architecture so supports both <code>arm64</code> and <code>x86_64</code> builds.</p>
<div class="page-columns page-full"><p>Binary builds of the prerequisites <a href="#fn23" class="footnote-ref" id="fnref23" role="doc-noteref"><sup>23</sup></a> are available at <a href="https://mac.r-project.org/libs-arm64/" class="uri">https://mac.r-project.org/libs-arm64/</a>. (The simplest way to get Tcl/Tk is to install <a href="https://mac.r-project.org/libs-arm64/tcltk-8.6.11-xft-darwin20.4-arm64.pkg" class="uri">https://mac.r-project.org/libs-arm64/tcltk-8.6.11-xft-darwin20.4-arm64.pkg</a> which bundles Tcl, Tk and Tktable.) These unpack into <code>/opt/R/arm64</code>: it is simplest to first create that directory and adjust its ownership if desired:</p><div class="no-row-height column-margin column-container"><li id="fn23" role="doc-endnote"><p><sup>23</sup>&nbsp;There is no <code>readline</code>: the CRAN distribution uses <code>libedit</code> emulation.</p></li></div></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /opt/R/arm64</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> myaccount /opt/R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then components can be downloaded and unpacked, for example</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-OL</span> https://mac.r-project.org/libs-arm64/jpeg-9d-darwin.20-arm64.tar.gz</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-C</span>/ <span class="at">-xf</span> jpeg-9d-darwin.20-arm64.tar.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>using <code>sudo</code> if necessary.</p>
<p>Prerequisite <code>readline</code> can easily be built from source, although <code>libedit</code> emulation can also be used. If compiling from source, <code>pcre2</code> (at least up to version 10.37) needs to be built without JIT support (the default) as the R build segfaults if that is enabled, so do run <code>make check</code> on your build.</p>
<p>Add <code>/opt/R/arm64/bin</code> to the <code>PATH</code>, create a file <code>config.site</code> something like</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>CC<span class="op">=</span><span class="st">"clang -target arm64-apple-macos11"</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>OBJC<span class="op">=</span>$CC</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>FC<span class="op">=</span><span class="st">"/opt/R/arm64/gfortran/bin/gfortran -mtune=native"</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>CXX<span class="op">=</span><span class="st">"clang++ -target arm64-apple-macos11"</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>CFLAGS<span class="op">=</span><span class="st">"-falign-functions=8 -g -O2 -Wall -pedantic"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>CPPFLAGS<span class="op">=-</span>I<span class="op">/</span>opt<span class="op">/</span>R<span class="op">/</span>arm64<span class="op">/</span>include</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>LDFLAGS<span class="op">=-</span>L<span class="op">/</span>opt<span class="op">/</span>R<span class="op">/</span>arm64<span class="op">/</span>lib</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>R_LD_LIBRARY_PATH<span class="op">=/</span>opt<span class="op">/</span>R<span class="op">/</span>arm64<span class="op">/</span>lib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(the first flag in <code>CFLAGS</code> is needed to inter-work with the current <code>gfortran</code> without segfaulting in some packages). Then configure R using something like</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="op">/</span>path<span class="op">/</span>to<span class="op">/</span>configure <span class="op">--</span>enable<span class="op">-</span>R<span class="op">-</span>shlib <span class="op">--</span>enable<span class="op">-</span>memory<span class="op">-</span>profiling \</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">--</span>with<span class="op">-</span>tcl<span class="op">-</span>config<span class="op">=/</span>opt<span class="op">/</span>R<span class="op">/</span>arm64<span class="op">/</span>lib<span class="op">/</span>tclConfig<span class="op">.</span>sh \</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">--</span>with<span class="op">-</span>tk<span class="op">-</span>config<span class="op">=/</span>opt<span class="op">/</span>R<span class="op">/</span>arm64<span class="op">/</span>lib<span class="op">/</span>tkConfig<span class="op">.</span>sh \</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  PKG_CONFIG_PATH<span class="op">=/</span>opt<span class="op">/</span>R<span class="op">/</span>arm64<span class="op">/</span>lib<span class="op">/</span>pkgconfig<span class="op">:/</span>usr<span class="op">/</span>lib<span class="op">/</span>pkgconfig \</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  JAVA_HOME<span class="op">=/</span>path<span class="op">/</span>to<span class="op">/</span>jdk<span class="op">-</span><span class="fl">17.</span><span class="er">jdk</span><span class="op">/</span>Contents<span class="op">/</span>Home</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Updating a build may fail because of the bug described at <a href="https://openradar.appspot.com/FB8914243" class="uri">https://openradar.appspot.com/FB8914243</a> but <em>ab initio</em> builds work.</p>
<p>As with Intel builds, the <code>Accelerate</code> library could be used <em>via</em> the configuration option</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span>with<span class="sc">-</span>blas<span class="ot">=</span><span class="st">"-framework Accelerate"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>According to Apple, C/C++ code intended only for this architecture can be enclosed in an <code>#ifdef</code> block using macro <code>__arm64__</code> or <code>__aarch64__</code> : you may want to also condition on <code>__APPLE__</code> as those macros are defined on other OSes, at least for <code>clang</code> and <code>gcc</code> (<code>__aarch64__</code>).</p>
<p>If building software or installing source packages with <code>cmake</code> (or a non-Apple <code>make</code>) ensure it contains the <code>arm64</code> architecture (use <code>file</code> to be sure). Running compilers from an <code>x86_64</code> executable will generate <code>x86_64</code> code ….</p>
</section>
</section>
<section id="freebsd" class="level2 section" data-number="12.4">
<h2 class="section anchored" data-number="12.4" data-anchor-id="freebsd"><span class="header-section-number">12.4</span> FreeBSD</h2>
<p>There have been few recent reports on FreeBSD: there is a ‘port’ at <a href="https://svnweb.freebsd.org/ports/head/math/" class="uri">https://svnweb.freebsd.org/ports/head/math/</a>. Recent versions of FreeBSD use Clang and the <code>libc++</code> C++ headers and runtime, but the ‘port’ is configured to use GCC.</p>
<p>Use of ICU for collation and the <code>configure</code> option <code>--with-internal-tzcode</code> are desirable workarounds.</p>
</section>
<section id="openbsd" class="level2 section" data-number="12.5">
<h2 class="section anchored" data-number="12.5" data-anchor-id="openbsd"><span class="header-section-number">12.5</span> OpenBSD</h2>
<p>Ingo Feinerer installed R version 3.2.2 on OpenBSD 5.8 arch <code>amd64</code> (their name for <code>x86_64</code>). Details of the build (and patches applied) are at <a href="https://cvsweb.openbsd.org/cgi-bin/cvsweb/ports/math/R/" class="uri">https://cvsweb.openbsd.org/cgi-bin/cvsweb/ports/math/R/</a>. (Downgrading the <code>zlib</code> requirement to 1.2.3 is against the advice of the R developers.)</p>
</section>
<section id="cygwin" class="level2 section" data-number="12.6">
<h2 class="section anchored" data-number="12.6" data-anchor-id="cygwin"><span class="header-section-number">12.6</span> Cygwin</h2>
<p>The 32-bit version never worked well enough to pass R’s <code>make check</code>, and residual support from earlier experiments was removed in R 3.3.0.</p>
<p>The 64-bit version was never supported.</p>
</section>
<section id="new-platforms" class="level2 section" data-number="12.7">
<h2 class="section anchored" data-number="12.7" data-anchor-id="new-platforms"><span class="header-section-number">12.7</span> New platforms</h2>
<p>There are a number of sources of problems when installing R on a new hardware/OS platform. These include</p>
<p><strong>Floating Point Arithmetic</strong>: R requires arithmetic compliant with IEC&nbsp;60559, also known as IEEE&nbsp;754. This mandates the use of plus and minus infinity and <code>NaN</code> (not a number) as well as specific details of rounding. Although almost all current FPUs can support this, selecting such support can be a pain. The problem is that there is no agreement on how to set the signalling behaviour; Sun/Sparc, SGI/IRIX and <code>ix86</code> Linux require no special action, FreeBSD requires a call to (the macro) <code>fpsetmask(0)</code> and OSF1 required that computation be done with a <code>-ieee_with_inexact</code> flag etc. With Intel compilers on 32-bit and 64-bit Intel machines, one has to explicitly disable flush-to-zero and denormals-are-zero modes. Some ARM processors including A12Z and M1 (Apple Silicon) by default use runfast mode, which includes flush-to-zero and default-nan and hence has to be disabled. With default-nan mode, the NaN payload used for representation of numeric NA values is lost even on simple operations with finite values. On a new platform you must find out the magic recipe and add some code to make it work. This can often be done via the file <code>config.site</code> which resides in the top level directory.</p>
<p>Beware of using high levels of optimization, at least initially. On many compilers these reduce the degree of compliance to the IEEE model. For example, using <code>-fast</code> on the Oracle compilers has caused R’s <code>NaN</code> to be set incorrectly, and <code>gcc</code>s <code>-ffast-math</code> and <code>clang</code>s <code>-Ofast</code> have given incorrect results.</p>
<p><strong>Shared Objects</strong>: There seems to be very little agreement across platforms on what needs to be done to build shared objects. there are many different combinations of flags for the compilers and loaders. GNU libtool cannot be used (yet), as it currently does not fully support Fortran: one would need a shell wrapper for this). The technique we use is to first interrogate the X window system about what it does (using <code>xmkmf</code>), and then override this in situations where we know better (for tools from the GNU Compiler Collection and/or platforms we know about). This typically works, but you may have to manually override the results. Scanning the manual entries for <code>cc</code> and <code>ld</code> usually reveals the correct incantation. Once you know the recipe you can modify the file <code>config.site</code> (following the instructions therein) so that the build will use these options.</p>
<p>It seems that <code>gcc</code>&nbsp;3.4.x and later on <code>ix86</code> Linux defeat attempts by the LAPACK code to avoid computations entirely in extended-precision registers, so file <code>src/modules/lapack/dlamc.f</code> may need to be compiled without optimization or with additional flags. Set the configure variable <code>SAFE_FFLAGS</code> to the flags to be used for this file.</p>
<p>If you do manage to get R running on a new platform please let us know about it so we can modify the configuration procedures to include that platform.</p>
<p>If you are having trouble getting R to work on your platform please feel free to use the <code>R-devel</code> mailing list to ask questions. We have had a fair amount of practice at porting R to new platforms <span class="small">...</span></p>


</section>

</main> <!-- /main -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.toc-action)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Configuration-on-a-Unix-alike.html">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Configuration on a Unix-alike</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Function-and-variable-index.html">
        <span class="nav-page-text">Function and variable index</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">A re-styled version of the original R manuals at <a href="https://cran.r-project.org/manuals.html" class="uri">https://cran.r-project.org/manuals.html</a></div>   
    <div class="nav-footer-right">Built using <a href="https://quarto.org">Quarto</a></div>
  </div>
</footer>


</body></html>