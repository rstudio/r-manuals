<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Spreadsheet-like data ¶ – R Manuals :: R Data Import/Export ¶</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Importing-from-other-statistical-systems.html" rel="next">
<link href="./Introduction.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c829ce05b6823b53f8936fe7d46e29b9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R Manuals :: R Data Import/Export ¶</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-manuals" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Manuals</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-manuals">    
        <li>
    <a class="dropdown-item" href="./../r-intro/index.html">
 <span class="dropdown-text">An Introduction to R ¶</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-data/index.html">
 <span class="dropdown-text">R Data Import/Export ¶</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-admin/index.html">
 <span class="dropdown-text">R Installation and Administration ¶</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-exts/index.html">
 <span class="dropdown-text">Writing R Extensions ¶</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-lang/index.html">
 <span class="dropdown-text">R Language Definition ¶</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-ints/index.html">
 <span class="dropdown-text">R Internals ¶</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Spreadsheet-like-data.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Spreadsheet-like data </span></a><a href="#spreadsheet-like-data-1" class="copiable-link">¶</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Top (R Data Import/Export)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgements </span></a><a href="#acknowledgements-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction </span></span></a><a href="#introduction-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Spreadsheet-like-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Spreadsheet-like data </span></span></a><a href="#spreadsheet-like-data-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Importing-from-other-statistical-systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Importing from other statistical systems </span></span></a><a href="#importing-from-other-statistical-systems-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Relational-databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Relational databases </span></span></a><a href="#relational-databases-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Binary-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Binary files </span></span></a><a href="#binary-files-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Image-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Image files </span></span></a><a href="#image-files-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Connections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Connections </span></span></a><a href="#connections-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Network-interfaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Network interfaces </span></span></a><a href="#network-interfaces-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Reading-Excel-spreadsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Reading Excel spreadsheets </span></span></a><a href="#reading-excel-spreadsheets-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./References.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References </span></a><a href="#references-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Function-and-variable-index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Function and variable index </span></a><a href="#function-and-variable-index-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Concept-index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concept index </span></a><a href="#concept-index-1" class="copiable-link">¶</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#variations-on-read.table" id="toc-variations-on-read.table" class="nav-link active" data-scroll-target="#variations-on-read.table"><span class="header-section-number">2.1</span> Variations on <code class="code">read.table</code> ¶</a></li>
  <li><a href="#fixed-width-format-files" id="toc-fixed-width-format-files" class="nav-link" data-scroll-target="#fixed-width-format-files"><span class="header-section-number">2.2</span> Fixed-width-format files ¶</a></li>
  <li><a href="#data-interchange-format-dif" id="toc-data-interchange-format-dif" class="nav-link" data-scroll-target="#data-interchange-format-dif"><span class="header-section-number">2.3</span> Data Interchange Format (DIF) ¶</a></li>
  <li><a href="#using-scan-directly" id="toc-using-scan-directly" class="nav-link" data-scroll-target="#using-scan-directly"><span class="header-section-number">2.4</span> Using <code class="code">scan</code> directly ¶</a></li>
  <li><a href="#re-shaping-data" id="toc-re-shaping-data" class="nav-link" data-scroll-target="#re-shaping-data"><span class="header-section-number">2.5</span> Re-shaping data ¶</a></li>
  <li><a href="#flat-contingency-tables" id="toc-flat-contingency-tables" class="nav-link" data-scroll-target="#flat-contingency-tables"><span class="header-section-number">2.6</span> Flat contingency tables ¶</a>
  <ul class="collapse">
  <li><a href="#footnotes" id="toc-footnotes" class="nav-link" data-scroll-target="#footnotes"><span class="header-section-number">2.6.1</span> Footnotes</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Spreadsheet-like data <a href="#spreadsheet-like-data-1" class="copiable-link">¶</a></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Next: <a href="Importing-from-other-statistical-systems.html#importing-from-other-statistical-systems" accesskey="n" rel="next">Importing from other statistical systems</a>, Previous: <a href="Introduction.html#introduction" accesskey="p" rel="prev">Introduction</a>, Up: <a href="index.html" accesskey="u" rel="up">R Data Import/Export</a> &nbsp; [<a href="index.html#sec_contents" rel="contents" title="Table of contents">Contents</a>][<a href="Function-and-variable-index.html" rel="index" title="Index">Index</a>]</p>
<p>In <a href="Introduction.html#export-to-text-files" class="ref">Export to text files</a> we saw a number of variations on the format of a spreadsheet-like text file, in which the data are presented in a rectangular grid, possibly with row and column labels. In this section we consider importing such files into R.</p>
<section id="variations-on-read.table" class="level2 section" data-number="2.1">
<h2 class="section anchored" data-number="2.1" data-anchor-id="variations-on-read.table"><span class="header-section-number">2.1</span> Variations on <code class="code">read.table</code> <a href="#variations-on-read.table-1" class="copiable-link">¶</a></h2>
<p>The function <code class="code">read.table</code> is the most convenient way to read in a rectangular grid of data. Because of the many possibilities, there are several other functions that call <code class="code">read.table</code> but change a group of default arguments.</p>
<p>Beware that <code class="code">read.table</code> is an inefficient way to read in very large numerical matrices: see <code class="code">scan</code> below.</p>
<p>Some of the issues to consider are:</p>
<ol type="1">
<li><p><strong>Encoding</strong></p>
<p>If the file contains non-ASCII character fields, ensure that it is read in the correct encoding. This is mainly an issue for reading Latin-1 files in a UTF-8 locale, which can be done by something like</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span>(<span class="st">"file.dat"</span>, <span class="at">fileEncoding=</span><span class="st">"latin1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that this will work in any locale which can represent Latin-1 strings, but not many Greek/Russian/Chinese/Japanese … locales.</p></li>
<li><p><strong>Header line</strong></p>
<p>We recommend that you specify the <code class="code">header</code> argument explicitly, Conventionally the header line has entries only for the columns and not for the row labels, so is one field shorter than the remaining lines. (If R sees this, it sets <code class="code">header = TRUE</code>.) If presented with a file that has a (possibly empty) header field for the row labels, read it in by something like</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span>(<span class="st">"file.dat"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Column names can be given explicitly via the <code class="code">col.names</code>; explicit names override the header line (if present).</p></li>
<li><p><strong>Separator</strong></p>
<p>Normally looking at the file will determine the field separator to be used, but with white-space separated files there may be a choice between the default <code class="code">sep = ""</code> which uses any white space (spaces, tabs or newlines) as a separator, <code class="code">sep = " "</code> and <code class="code">sep = "\t"</code>. Note that the choice of separator affects the input of quoted strings.</p>
<p>If you have a tab-delimited file containing empty fields be sure to use <code class="code">sep = "\t"</code>.</p></li>
<li><p><strong>Quoting</strong> <span id="index-Quoting-strings-1" class="index-entry-id"></span></p>
<p>By default character strings can be quoted by either <samp class="samp">"</samp>’ or {.sample .samp}’, and in each case all the characters up to a matching quote are taken as part of the character string. The set of valid quoting characters (which might be none) is controlled by the <code class="code">quote</code> argument. For <code class="code">sep = "\n"</code> the default is changed to <code class="code">quote = ""</code>.</p>
<p>If no separator character is specified, quotes can be escaped within quoted strings by immediately preceding them by <samp class="samp">\</samp>’, C-style.</p>
<p>If a separator character is specified, quotes can be escaped within quoted strings by doubling them as is conventional in spreadsheets. For example</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="st">'One string isn''t two'</span>,<span class="st">"one more"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>can be read by</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span>(<span class="st">"testfile"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This does not work with the default separator.</p></li>
<li><p><strong>Missing values</strong> <span id="index-Missing-values-1" class="index-entry-id"></span></p>
<p>By default the file is assumed to contain the character string <code class="code">NA</code> to represent missing values, but this can be changed by the argument <code class="code">na.strings</code>, which is a vector of one or more character representations of missing values.</p>
<p>Empty fields in numeric columns are also regarded as missing values.</p>
<p>In numeric columns, the values <code class="code">NaN</code>, <code class="code">Inf</code> and <code class="code">-Inf</code> are accepted.</p></li>
<li><p><strong>Unfilled lines</strong></p>
<p>It is quite common for a file exported from a spreadsheet to have all trailing empty fields (and their separators) omitted. To read such files set <code class="code">fill = TRUE</code>.</p></li>
<li><p><strong>White space in character fields</strong></p>
<p>If a separator is specified, leading and trailing white space in character fields is regarded as part of the field. To strip the space, use argument <code class="code">strip.white = TRUE</code>.</p></li>
<li><p><strong>Blank lines</strong></p>
<p>By default, <code class="code">read.table</code> ignores empty lines. This can be changed by setting <code class="code">blank.lines.skip = FALSE</code>, which will only be useful in conjunction with <code class="code">fill = TRUE</code>, perhaps to use blank rows to indicate missing cases in a regular layout.</p></li>
<li><p><strong>Classes for the variables</strong></p>
<p>Unless you take any special action, <code class="code">read.table</code> reads all the columns as character vectors and then tries to select a suitable class for each variable in the data frame. It tries in turn <code class="code">logical</code>, <code class="code">integer</code>, <code class="code">numeric</code> and <code class="code">complex</code>, moving on if any entry is not missing and cannot be converted.<a href="#FOOT3" id="DOCF3" class="footnote"><sup>3</sup></a> If all of these fail, the variable is converted to a factor.</p>
<p>Arguments <code class="code">colClasses</code> and <code class="code">as.is</code> provide greater control. Specifying <code class="code">as.is = TRUE</code> suppresses conversion of character vectors to factors (only). Using <code class="code">colClasses</code> allows the desired class to be set for each column in the input: it will be faster and use less memory.</p>
<p>Note that <code class="code">colClasses</code> and <code class="code">as.is</code> are specified <em>per</em> column, not <em>per</em> variable, and so include the column of row names (if any).</p></li>
<li><p><strong>Comments</strong></p>
<p>By default, <code class="code">read.table</code> uses <samp class="samp">#</samp>’ as a comment character, and if this is encountered (except in quoted strings) the rest of the line is ignored. Lines containing only white space and a comment are treated as blank lines.</p>
<p>If it is known that there will be no comments in the data file, it is safer (and may be faster) to use <code class="code">comment.char = ""</code>.</p></li>
<li><p><strong>Escapes</strong></p>
<p>Many OSes have conventions for using backslash as an escape character in text files, but Windows does not (and uses backslash in path names). It is optional in R whether such conventions are applied to data files.</p>
<p>Both <code class="code">read.table</code> and <code class="code">scan</code> have a logical argument <code class="code">allowEscapes</code>. This is false by default, and backslashes are then only interpreted as (under circumstances described above) escaping quotes. If this set to be true, C-style escapes are interpreted, namely the control characters <code class="code">\a, \b, \f, \n, \r, \t, \v</code> and octal and hexadecimal representations like <code class="code">\040</code> and <code class="code">\0x2A</code>. Any other escaped character is treated as itself, including backslash. Note that Unicode escapes such as <code class="code">\u</code><var class="var">xxxx</var> are never interpreted.</p></li>
<li><p><strong>Encoding</strong></p>
<p>This can be specified by the <code class="code">fileEncoding</code> argument, for example</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fileEncoding <span class="ot">=</span> <span class="st">"UCS-2LE"</span>    <span class="co"># Windows 'Unicode' files</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>fileEncoding <span class="ot">=</span> <span class="st">"UTF-8"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you know (correctly) the file’s encoding this will almost always work. However, we know of one exception, UTF-8 files with a BOM. Some people claim that UTF-8 files should never have a BOM, but some software (apparently including Excel:mac) uses them, and many Unix-alike OSes do not accept them. So faced with a file which <code class="command">file</code> reports as</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>intro<span class="op">.</span>dat<span class="op">:</span> UTF<span class="op">-</span><span class="dv">8</span> Unicode <span class="op">(</span>with BOM<span class="op">)</span> text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>it can be read on Windows by</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>read<span class="op">.</span>table<span class="op">(</span><span class="st">"intro.dat"</span><span class="op">,</span> fileEncoding <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>but on a Unix-alike might need</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>read<span class="op">.</span>table<span class="op">(</span><span class="st">"intro.dat"</span><span class="op">,</span> fileEncoding <span class="op">=</span> <span class="st">"UTF-8-BOM"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(This would most likely work without specifying an encoding in a UTF-8 locale.)</p></li>
</ol>
<p><span id="index-read_002ecsv" class="index-entry-id"></span> <span id="index-read_002ecsv2" class="index-entry-id"></span> <span id="index-read_002edelim" class="index-entry-id"></span> <span id="index-read_002edelim2" class="index-entry-id"></span> <span id="index-CSV-files-1" class="index-entry-id"></span> <span id="index-Sys_002elocaleconv" class="index-entry-id"></span></p>
<p>Convenience functions <code class="code">read.csv</code> and <code class="code">read.delim</code> provide arguments to <code class="code">read.table</code> appropriate for CSV and tab-delimited files exported from spreadsheets in English-speaking locales. The variations <code class="code">read.csv2</code> and <code class="code">read.delim2</code> are appropriate for use in those locales where the comma is used for the decimal point and (for <code class="code">read.csv2</code>) for spreadsheets which use semicolons to separate fields.</p>
<p>If the options to <code class="code">read.table</code> are specified incorrectly, the error message will usually be of the form</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">scan</span>(<span class="at">file =</span> file, <span class="at">what =</span> what, <span class="at">sep =</span> sep, <span class="sc">:</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>        line <span class="dv">1</span> did not have <span class="dv">5</span> elements</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">read.table</span>(<span class="st">"files.dat"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>) <span class="sc">:</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>        more columns than column names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This may give enough information to find the problem, but the auxiliary function <code class="code">count.fields</code> can be useful to investigate further.</p>
<p>Efficiency can be important when reading large data grids. It will help to specify <code class="code">comment.char = ""</code>, <code class="code">colClasses</code> as one of the atomic vector types (logical, integer, numeric, complex, character or perhaps raw) for each column, and to give <code class="code">nrows</code>, the number of rows to be read (and a mild over-estimate is better than not specifying this at all). See the examples in later sections.</p>
</section>
<section id="fixed-width-format-files" class="level2 section" data-number="2.2">
<h2 class="section anchored" data-number="2.2" data-anchor-id="fixed-width-format-files"><span class="header-section-number">2.2</span> Fixed-width-format files <a href="#fixed-width-format-files-1" class="copiable-link">¶</a></h2>
<p>Sometimes data files have no field delimiters but have fields in pre-specified columns. This was very common in the days of punched cards, and is still sometimes used to save file space.</p>
<p>Function <code class="code">read.fwf</code> provides a simple way to read such files, specifying a vector of field widths. The function reads the file into memory as whole lines, splits the resulting character strings, writes out a temporary tab-separated file and then calls <code class="code">read.table</code>. This is adequate for small files, but for anything more complicated we recommend using the facilities of a language like <code class="code">perl</code> to pre-process the file. <span id="index-perl-1" class="index-entry-id"></span></p>
<p>Function <code class="code">read.fortran</code> is a similar function for fixed-format files, using Fortran-style column specifications.</p>
</section>
<section id="data-interchange-format-dif" class="level2 section" data-number="2.3">
<h2 class="section anchored" data-number="2.3" data-anchor-id="data-interchange-format-dif"><span class="header-section-number">2.3</span> Data Interchange Format (DIF) <a href="#data-interchange-format-_0028dif_0029-1" class="copiable-link">¶</a></h2>
<p>An old format sometimes used for spreadsheet-like data is DIF, or Data Interchange format.</p>
<p>Function <code class="code">read.DIF</code> provides a simple way to read such files. It takes arguments similar to <code class="code">read.table</code> for assigning types to each of the columns.</p>
<p>On Windows, spreadsheet programs often store spreadsheet data copied to the clipboard in this format; <code class="code">read.DIF("clipboard")</code> can read it from there directly. It is slightly more robust than <code class="code">read.table("clipboard")</code> in handling spreadsheets with empty cells.</p>
</section>
<section id="using-scan-directly" class="level2 section" data-number="2.4">
<h2 class="section anchored" data-number="2.4" data-anchor-id="using-scan-directly"><span class="header-section-number">2.4</span> Using <code class="code">scan</code> directly <a href="#using-scan-directly-1" class="copiable-link">¶</a></h2>
<p>Both <code class="code">read.table</code> and <code class="code">read.fwf</code> use <code class="code">scan</code> to read the file, and then process the results of <code class="code">scan</code>. They are very convenient, but sometimes it is better to use <code class="code">scan</code> directly.</p>
<p>Function <code class="code">scan</code> has many arguments, most of which we have already covered under <code class="code">read.table</code>. The most crucial argument is <code class="code">what</code>, which specifies a list of modes of variables to be read from the file. If the list is named, the names are used for the components of the returned list. Modes can be numeric, character or complex, and are usually specified by an example, e.g.&nbsp;<code class="code">0</code>, <code class="code">""</code> or <code class="code">0i</code>. For example</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2 3 5 7"</span>, <span class="st">"11 13 17 19"</span>, <span class="at">file=</span><span class="st">"ex.dat"</span>, <span class="at">sep=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scan</span>(<span class="at">file=</span><span class="st">"ex.dat"</span>, <span class="at">what=</span><span class="fu">list</span>(<span class="at">x=</span><span class="dv">0</span>, <span class="at">y=</span><span class="st">""</span>, <span class="at">z=</span><span class="dv">0</span>), <span class="at">flush=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>returns a list with three components and discards the fourth column in the file.</p>
<p>There is a function <code class="code">readLines</code> which will be more convenient if all you want is to read whole lines into R for further processing.</p>
<p>One common use of <code class="code">scan</code> is to read in a large matrix. Suppose file <samp class="file">matrix.dat</samp> just contains the numbers for a 200 x 2000 matrix. Then we can use</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">scan</span>(<span class="st">"matrix.dat"</span>, <span class="at">n =</span> <span class="dv">200</span><span class="sc">*</span><span class="dv">2000</span>), <span class="dv">200</span>, <span class="dv">2000</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On one test this took 1 second (under Linux, 3 seconds under Windows on the same machine) whereas</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">read.table</span>(<span class="st">"matrix.dat"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>took 10 seconds (and more memory), and</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">read.table</span>(<span class="st">"matrix.dat"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">nrows =</span> <span class="dv">200</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">comment.char =</span> <span class="st">""</span>, <span class="at">colClasses =</span> <span class="st">"numeric"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>took 7 seconds. The difference is almost entirely due to the overhead of reading 2000 separate short columns: were they of length 2000, <code class="code">scan</code> took 9 seconds whereas <code class="code">read.table</code> took 18 if used efficiently (in particular, specifying <code class="code">colClasses</code>) and 125 if used naively.</p>
<p>Note that timings can depend on the type read and the data. Consider reading a million distinct integers:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>writeLines<span class="op">(</span>as<span class="op">.</span>character<span class="op">((</span><span class="dv">1</span><span class="op">+</span><span class="fl">1e6</span><span class="op">):</span><span class="fl">2e6</span><span class="op">),</span> <span class="st">"ints.dat"</span><span class="op">)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>xi <span class="op">&lt;-</span> scan<span class="op">(</span><span class="st">"ints.dat"</span><span class="op">,</span> what<span class="op">=</span>integer<span class="op">(</span><span class="dv">0</span><span class="op">),</span> n<span class="op">=</span><span class="fl">1e6</span><span class="op">)</span>   # <span class="fl">0.77</span><span class="er">s</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>xn <span class="op">&lt;-</span> scan<span class="op">(</span><span class="st">"ints.dat"</span><span class="op">,</span> what<span class="op">=</span>numeric<span class="op">(</span><span class="dv">0</span><span class="op">),</span> n<span class="op">=</span><span class="fl">1e6</span><span class="op">)</span>   # <span class="fl">0.93</span><span class="er">s</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>xc <span class="op">&lt;-</span> scan<span class="op">(</span><span class="st">"ints.dat"</span><span class="op">,</span> what<span class="op">=</span>character<span class="op">(</span><span class="dv">0</span><span class="op">),</span> n<span class="op">=</span><span class="fl">1e6</span><span class="op">)</span> # <span class="fl">0.85</span><span class="er">s</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>xf <span class="op">&lt;-</span> as<span class="op">.</span>factor<span class="op">(</span>xc<span class="op">)</span>                              # <span class="fl">2.2</span><span class="er">s</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>DF <span class="op">&lt;-</span> read<span class="op">.</span>table<span class="op">(</span><span class="st">"ints.dat"</span><span class="op">)</span>                     # <span class="fl">4.5</span><span class="er">s</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and a million examples of a small set of codes:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>code <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"LMH"</span>, <span class="st">"SJC"</span>, <span class="st">"CHCH"</span>, <span class="st">"SPC"</span>, <span class="st">"SOM"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">sample</span>(code, <span class="fl">1e6</span>, <span class="at">replace=</span><span class="cn">TRUE</span>), <span class="st">"code.dat"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">scan</span>(<span class="st">"code.dat"</span>, <span class="at">what=</span><span class="fu">character</span>(<span class="dv">0</span>), <span class="at">n=</span><span class="fl">1e6</span>)  <span class="co"># 0.44s</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>yf <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(y)                               <span class="co"># 0.21s</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>DF <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"code.dat"</span>)                     <span class="co"># 4.9s</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>DF <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"code.dat"</span>, <span class="at">nrows=</span><span class="fl">1e6</span>)          <span class="co"># 3.6s</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that these timings depend heavily on the operating system (the basic reads in Windows take at least as twice as long as these Linux times) and on the precise state of the garbage collector.</p>
</section>
<section id="re-shaping-data" class="level2 section" data-number="2.5">
<h2 class="section anchored" data-number="2.5" data-anchor-id="re-shaping-data"><span class="header-section-number">2.5</span> Re-shaping data <a href="#re-shaping-data-1" class="copiable-link">¶</a></h2>
<p>Sometimes spreadsheet data is in a compact format that gives the covariates for each subject followed by all the observations on that subject. R’s modelling functions need observations in a single column. Consider the following sample of data from repeated MRI brain measurements</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a> Status   Age    V1     V2     V3    V4</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>      P <span class="dv">23646</span> <span class="dv">45190</span>  <span class="dv">50333</span>  <span class="dv">55166</span> <span class="dv">56271</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>     CC <span class="dv">26174</span> <span class="dv">35535</span>  <span class="dv">38227</span>  <span class="dv">37911</span> <span class="dv">41184</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>     CC <span class="dv">27723</span> <span class="dv">25691</span>  <span class="dv">25712</span>  <span class="dv">26144</span> <span class="dv">26398</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>     CC <span class="dv">27193</span> <span class="dv">30949</span>  <span class="dv">29693</span>  <span class="dv">29754</span> <span class="dv">30772</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>     CC <span class="dv">24370</span> <span class="dv">50542</span>  <span class="dv">51966</span>  <span class="dv">54341</span> <span class="dv">54273</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>     CC <span class="dv">28359</span> <span class="dv">58591</span>  <span class="dv">58803</span>  <span class="dv">59435</span> <span class="dv">61292</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>     CC <span class="dv">25136</span> <span class="dv">45801</span>  <span class="dv">45389</span>  <span class="dv">47197</span> <span class="dv">47126</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There are two covariates and up to four measurements on each subject. The data were exported from Excel as a file <samp class="file">mr.csv</samp>.</p>
<p>We can use <code class="code">stack</code> to help manipulate these data to give a single response.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>zz <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"mr.csv"</span>, <span class="at">strip.white =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>zzz <span class="ot">&lt;-</span> <span class="fu">cbind</span>(zz[<span class="fu">gl</span>(<span class="fu">nrow</span>(zz), <span class="dv">1</span>, <span class="dv">4</span><span class="sc">*</span><span class="fu">nrow</span>(zz)), <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="fu">stack</span>(zz[, <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>with result</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>      Status   Age values ind</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>X1         P <span class="dv">23646</span>  <span class="dv">45190</span>  V1</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>X2        CC <span class="dv">26174</span>  <span class="dv">35535</span>  V1</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>X3        CC <span class="dv">27723</span>  <span class="dv">25691</span>  V1</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>X4        CC <span class="dv">27193</span>  <span class="dv">30949</span>  V1</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>X5        CC <span class="dv">24370</span>  <span class="dv">50542</span>  V1</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>X6        CC <span class="dv">28359</span>  <span class="dv">58591</span>  V1</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>X7        CC <span class="dv">25136</span>  <span class="dv">45801</span>  V1</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>X11        P <span class="dv">23646</span>  <span class="dv">50333</span>  V2</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Function <code class="code">unstack</code> goes in the opposite direction, and may be useful for exporting data.</p>
<p>Another way to do this is to use the function <code class="code">reshape</code>, by</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">reshape</span>(zz, <span class="at">idvar=</span><span class="st">"id"</span>,<span class="at">timevar=</span><span class="st">"var"</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"V1"</span>,<span class="st">"V2"</span>,<span class="st">"V3"</span>,<span class="st">"V4"</span>)),<span class="at">direction=</span><span class="st">"long"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    Status   Age var    V1 id</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fl">1.1</span>      P <span class="dv">23646</span>   <span class="dv">1</span> <span class="dv">45190</span>  <span class="dv">1</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fl">2.1</span>     CC <span class="dv">26174</span>   <span class="dv">1</span> <span class="dv">35535</span>  <span class="dv">2</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fl">3.1</span>     CC <span class="dv">27723</span>   <span class="dv">1</span> <span class="dv">25691</span>  <span class="dv">3</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fl">4.1</span>     CC <span class="dv">27193</span>   <span class="dv">1</span> <span class="dv">30949</span>  <span class="dv">4</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fl">5.1</span>     CC <span class="dv">24370</span>   <span class="dv">1</span> <span class="dv">50542</span>  <span class="dv">5</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fl">6.1</span>     CC <span class="dv">28359</span>   <span class="dv">1</span> <span class="dv">58591</span>  <span class="dv">6</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fl">7.1</span>     CC <span class="dv">25136</span>   <span class="dv">1</span> <span class="dv">45801</span>  <span class="dv">7</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fl">1.2</span>      P <span class="dv">23646</span>   <span class="dv">2</span> <span class="dv">50333</span>  <span class="dv">1</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fl">2.2</span>     CC <span class="dv">26174</span>   <span class="dv">2</span> <span class="dv">38227</span>  <span class="dv">2</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code class="code">reshape</code> function has a more complicated syntax than <code class="code">stack</code> but can be used for data where the ‘long’ form has more than the one column in this example. With <code class="code">direction="wide"</code>, <code class="code">reshape</code> can also perform the opposite transformation.</p>
<p>Some people prefer the tools in packages <a href="https://CRAN.R-project.org/package=reshape" class="url"><strong>reshape</strong></a>, <a href="https://CRAN.R-project.org/package=reshape2" class="url"><strong>reshape2</strong></a> and <a href="https://CRAN.R-project.org/package=plyr" class="url"><strong>plyr</strong></a>.</p>
</section>
<section id="flat-contingency-tables" class="level2 section" data-number="2.6">
<h2 class="section anchored" data-number="2.6" data-anchor-id="flat-contingency-tables"><span class="header-section-number">2.6</span> Flat contingency tables <a href="#flat-contingency-tables-1" class="copiable-link">¶</a></h2>
<p>Displaying higher-dimensional contingency tables in array form typically is rather inconvenient. In categorical data analysis, such information is often represented in the form of bordered two-dimensional arrays with leading rows and columns specifying the combination of factor levels corresponding to the cell counts. These rows and columns are typically “ragged” in the sense that labels are only displayed when they change, with the obvious convention that rows are read from top to bottom and columns are read from left to right. In R, such “flat” contingency tables can be created using <code class="code">ftable</code>, <span id="index-ftable" class="index-entry-id"></span> which creates objects of class <code class="code">"ftable"</code> with an appropriate print method.</p>
<p>As a simple example, consider the R standard data set <code class="code">UCBAdmissions</code> which is a 3-dimensional contingency table resulting from classifying applicants to graduate school at UC Berkeley for the six largest departments in 1973 classified by admission and sex.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">data</span>(UCBAdmissions)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">ftable</span>(UCBAdmissions)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                Dept   A   B   C   D   E   F</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>Admit    Gender                             </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>Admitted Male        <span class="dv">512</span> <span class="dv">353</span> <span class="dv">120</span> <span class="dv">138</span>  <span class="dv">53</span>  <span class="dv">22</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>         Female       <span class="dv">89</span>  <span class="dv">17</span> <span class="dv">202</span> <span class="dv">131</span>  <span class="dv">94</span>  <span class="dv">24</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>Rejected Male        <span class="dv">313</span> <span class="dv">207</span> <span class="dv">205</span> <span class="dv">279</span> <span class="dv">138</span> <span class="dv">351</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>         Female       <span class="dv">19</span>   <span class="dv">8</span> <span class="dv">391</span> <span class="dv">244</span> <span class="dv">299</span> <span class="dv">317</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The printed representation is clearly more useful than displaying the data as a 3-dimensional array.</p>
<p>There is also a function <code class="code">read.ftable</code> for reading in flat-like contingency tables from files. <span id="index-read_002eftable" class="index-entry-id"></span> This has additional arguments for dealing with variants on how exactly the information on row and column variables names and levels is represented. The help page for <code class="code">read.ftable</code> has some useful examples. The flat tables can be converted to standard contingency tables in array form using <code class="code">as.table</code>.</p>
<p>Note that flat tables are characterized by their “ragged” display of row (and maybe also column) labels. If the full grid of levels of the row variables is given, one should instead use <code class="code">read.table</code> to read in the data, and create the contingency table from this using <code class="code">xtabs</code>.</p>

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Introduction.html" class="pagination-link" aria-label="Introduction [¶](#introduction-1){.copiable-link}">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction </span></span></a><a href="#introduction-1" class="copiable-link">¶</a>
                
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Importing-from-other-statistical-systems.html" class="pagination-link" aria-label="Importing from other statistical systems [¶](#importing-from-other-statistical-systems-1){.copiable-link}">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Importing from other statistical systems </span></span></a><a href="#importing-from-other-statistical-systems-1" class="copiable-link">¶</a> <i class="bi bi-arrow-right-short"></i>
      
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>A re-styled version of the original R manuals at <a href="https://cran.r-project.org/manuals.html" class="uri">https://cran.r-project.org/manuals.html</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built using <a href="https://quarto.org">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>