<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>11&nbsp; Statistical models in R ¶ – R Manuals :: An Introduction to R ¶</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Graphics.html" rel="next">
<link href="./Writing-your-own-functions.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c829ce05b6823b53f8936fe7d46e29b9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R Manuals :: An Introduction to R ¶</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-manuals" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Manuals</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-manuals">    
        <li>
    <a class="dropdown-item" href="./../r-intro/index.html">
 <span class="dropdown-text">An Introduction to R ¶</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-data/index.html">
 <span class="dropdown-text">R Data Import/Export ¶</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-admin/index.html">
 <span class="dropdown-text">R Installation and Administration ¶</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-exts/index.html">
 <span class="dropdown-text">Writing R Extensions ¶</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-lang/index.html">
 <span class="dropdown-text">R Language Definition ¶</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./../r-ints/index.html">
 <span class="dropdown-text">R Internals ¶</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Statistical-models-in-R.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Statistical models in R </span></a><a href="#statistical-models-in-r-1" class="copiable-link">¶</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Top (An Introduction to R)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface </span></a><a href="#preface-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction-and-preliminaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and preliminaries </span></span></a><a href="#introduction-and-preliminaries-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Simple-manipulations-numbers-and-vectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Simple manipulations; numbers and vectors </span></span></a><a href="#simple-manipulations_003b-numbers-and-vectors" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Objects, their modes and attributes </span></span></a><a href="#objects_002c-their-modes-and-attributes" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Ordered and unordered factors </span></span></a><a href="#ordered-and-unordered-factors" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Arrays-and-matrices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Arrays and matrices </span></span></a><a href="#arrays-and-matrices-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lists-and-data-frames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Lists and data frames </span></span></a><a href="#lists-and-data-frames-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Reading-data-from-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Reading data from files </span></span></a><a href="#reading-data-from-files-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Probability-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Probability distributions </span></span></a><a href="#probability-distributions-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Loops-and-conditional-execution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Grouping, loops and conditional execution </span></span></a><a href="#grouping_002c-loops-and-conditional-execution" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Writing-your-own-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Writing your own functions </span></span></a><a href="#writing-your-own-functions-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Statistical-models-in-R.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Statistical models in R </span></span></a><a href="#statistical-models-in-r-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Graphical procedures </span></span></a><a href="#graphical-procedures" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Packages </span></span></a><a href="#packages-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./OS-facilities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">OS facilities </span></span></a><a href="#os-facilities-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./References.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References </span></a><a href="#references-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Function-and-variable-index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Function and variable index </span></a><a href="#function-and-variable-index-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Concept-index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concept index </span></a><a href="#concept-index-1" class="copiable-link">¶</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A-sample-session.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">A sample session </span></span></a><a href="#a-sample-session-1" class="copiable-link">¶</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Invoking-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Invoking R </span></span></a><a href="#invoking-r-1" class="copiable-link">¶</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./The-command-line-editor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">The command-line editor </span></span></a><a href="#the-command-line-editor-1" class="copiable-link">¶</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#defining-statistical-models-formulae" id="toc-defining-statistical-models-formulae" class="nav-link active" data-scroll-target="#defining-statistical-models-formulae"><span class="header-section-number">11.1</span> Defining statistical models; formulae ¶</a>
  <ul class="collapse">
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">11.1.1</span> Examples ¶</a></li>
  <li><a href="#contrasts" id="toc-contrasts" class="nav-link" data-scroll-target="#contrasts"><span class="header-section-number">11.1.2</span> Contrasts ¶</a></li>
  </ul></li>
  <li><a href="#linear-models" id="toc-linear-models" class="nav-link" data-scroll-target="#linear-models"><span class="header-section-number">11.2</span> Linear models ¶</a></li>
  <li><a href="#generic-functions-for-extracting-model-information" id="toc-generic-functions-for-extracting-model-information" class="nav-link" data-scroll-target="#generic-functions-for-extracting-model-information"><span class="header-section-number">11.3</span> Generic functions for extracting model information ¶</a></li>
  <li><a href="#analysis-of-variance-and-model-comparison" id="toc-analysis-of-variance-and-model-comparison" class="nav-link" data-scroll-target="#analysis-of-variance-and-model-comparison"><span class="header-section-number">11.4</span> Analysis of variance and model comparison ¶</a>
  <ul class="collapse">
  <li><a href="#anova-tables" id="toc-anova-tables" class="nav-link" data-scroll-target="#anova-tables"><span class="header-section-number">11.4.1</span> ANOVA tables ¶</a></li>
  </ul></li>
  <li><a href="#updating-fitted-models" id="toc-updating-fitted-models" class="nav-link" data-scroll-target="#updating-fitted-models"><span class="header-section-number">11.5</span> Updating fitted models ¶</a></li>
  <li><a href="#generalized-linear-models" id="toc-generalized-linear-models" class="nav-link" data-scroll-target="#generalized-linear-models"><span class="header-section-number">11.6</span> Generalized linear models ¶</a>
  <ul class="collapse">
  <li><a href="#families" id="toc-families" class="nav-link" data-scroll-target="#families"><span class="header-section-number">11.6.1</span> Families ¶</a></li>
  <li><a href="#the-glm-function" id="toc-the-glm-function" class="nav-link" data-scroll-target="#the-glm-function"><span class="header-section-number">11.6.2</span> The <code class="code">glm()</code> function ¶</a></li>
  <li><a href="#the-gaussian-family" id="toc-the-gaussian-family" class="nav-link" data-scroll-target="#the-gaussian-family"><span class="header-section-number">11.6.3</span> The <code class="code">gaussian</code> family ¶</a></li>
  <li><a href="#the-binomial-family" id="toc-the-binomial-family" class="nav-link" data-scroll-target="#the-binomial-family"><span class="header-section-number">11.6.4</span> The <code class="code">binomial</code> family ¶</a></li>
  <li><a href="#poisson-models" id="toc-poisson-models" class="nav-link" data-scroll-target="#poisson-models"><span class="header-section-number">11.6.5</span> Poisson models ¶</a></li>
  <li><a href="#quasi-likelihood-models" id="toc-quasi-likelihood-models" class="nav-link" data-scroll-target="#quasi-likelihood-models"><span class="header-section-number">11.6.6</span> Quasi-likelihood models ¶</a></li>
  </ul></li>
  <li><a href="#nonlinear-least-squares-and-maximum-likelihood-models" id="toc-nonlinear-least-squares-and-maximum-likelihood-models" class="nav-link" data-scroll-target="#nonlinear-least-squares-and-maximum-likelihood-models"><span class="header-section-number">11.7</span> Nonlinear least squares and maximum likelihood models ¶</a>
  <ul class="collapse">
  <li><a href="#least-squares" id="toc-least-squares" class="nav-link" data-scroll-target="#least-squares"><span class="header-section-number">11.7.1</span> Least squares ¶</a></li>
  <li><a href="#maximum-likelihood" id="toc-maximum-likelihood" class="nav-link" data-scroll-target="#maximum-likelihood"><span class="header-section-number">11.7.2</span> Maximum likelihood ¶</a></li>
  </ul></li>
  <li><a href="#some-non-standard-models" id="toc-some-non-standard-models" class="nav-link" data-scroll-target="#some-non-standard-models"><span class="header-section-number">11.8</span> Some non-standard models ¶</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Statistical models in R <a href="#statistical-models-in-r-1" class="copiable-link">¶</a></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Next: <a href="Graphics.html#graphics" accesskey="n" rel="next">Graphical procedures</a>, Previous: <a href="Writing-your-own-functions.html#writing-your-own-functions" accesskey="p" rel="prev">Writing your own functions</a>, Up: <a href="index.html" accesskey="u" rel="up">An Introduction to R</a> &nbsp; [<a href="index.html#sec_contents" rel="contents" title="Table of contents">Contents</a>][<a href="Function-and-variable-index.html" rel="index" title="Index">Index</a>]</p>
<p>This section presumes the reader has some familiarity with statistical methodology, in particular with regression analysis and the analysis of variance. Later we make some rather more ambitious presumptions, namely that something is known about generalized linear models and nonlinear regression.</p>
<p>The requirements for fitting statistical models are sufficiently well defined to make it possible to construct general tools that apply in a broad spectrum of problems.</p>
<p>R provides an interlocking suite of facilities that make fitting statistical models very simple. As we mention in the introduction, the basic output is minimal, and one needs to ask for the details by calling extractor functions.</p>
<section id="defining-statistical-models-formulae" class="level2 section" data-number="11.1">
<h2 class="section anchored" data-number="11.1" data-anchor-id="defining-statistical-models-formulae"><span class="header-section-number">11.1</span> Defining statistical models; formulae <a href="#defining-statistical-models_003b-formulae" class="copiable-link">¶</a></h2>
<p>The template for a statistical model is a linear regression model with independent, homoscedastic errors</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>y_i <span class="ot">=</span> sum_{j<span class="ot">=</span><span class="dv">0</span>}<span class="sc">^</span>p beta_j x_{ij} <span class="sc">+</span> e_i, &nbsp;&nbsp;&nbsp;&nbsp;i <span class="ot">=</span> <span class="dv">1</span>, ..., n,</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where the e_i are NID(0, sigma^2). In matrix terms this would be written</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> X &nbsp;beta <span class="sc">+</span> e</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where the <em>y</em> is the response vector, <em>X</em> is the <em>model matrix</em> or <em>design matrix</em> and has columns <em>x_0, x_1, ..., x_p</em>, the determining variables. Very often <em>x_0</em> will be a column of ones defining an <em>intercept</em> term.</p>
<section id="examples" class="level3 subsubheading" data-number="11.1.1">
<h3 class="subsubheading anchored" data-number="11.1.1" data-anchor-id="examples"><span class="header-section-number">11.1.1</span> Examples <a href="#examples" class="copiable-link">¶</a></h3>
<p>Before giving a formal specification, a few examples may usefully set the picture.</p>
<p>Suppose <code class="code">y</code>, <code class="code">x</code>, <code class="code">x0</code>, <code class="code">x1</code>, <code class="code">x2</code>, … are numeric variables, <code class="code">X</code> is a matrix and <code class="code">A</code>, <code class="code">B</code>, <code class="code">C</code>, … are factors. The following formulae on the left side below specify statistical models as described on the right.</p>
<p><code class="code">y ~ x</code><br>
<code class="code">y ~ 1 + x</code></p>
<p>: Both imply the same simple linear regression model of <em>y</em> on <em>x</em>. The first has an implicit intercept term, and the second an explicit one.</p>
<p><code class="code">y ~ 0 + x</code><br>
<code class="code">y ~ -1 + x</code><br>
<code class="code">y ~ x - 1</code></p>
<p>: Simple linear regression of <em>y</em> on <em>x</em> through the origin (that is, without an intercept term).</p>
<dl>
<dt><code class="code">log(y) ~ x1 + x2</code></dt>
<dd>
<p>Multiple regression of the transformed variable,log(y), on <em>x1</em> and <em>x2</em> (with an implicit intercept term).</p>
</dd>
</dl>
<p><code class="code">y ~ poly(x,2)</code><br>
<code class="code">y ~ 1 + x + I(x^2)</code></p>
<p>: Polynomial regression of <em>y</em> on <em>x</em> of degree 2. The first form uses orthogonal polynomials, and the second uses explicit powers, as basis.</p>
<dl>
<dt><code class="code">y ~ X + poly(x,2)</code></dt>
<dd>
<p>Multiple regression <em>y</em> with model matrix consisting of the matrix <em>X</em> as well as polynomial terms in <em>x</em> to degree 2.</p>
</dd>
<dt><code class="code">y ~ A</code></dt>
<dd>
<p>Single classification analysis of variance model of <em>y</em>, with classes determined by <em>A</em>.</p>
</dd>
<dt><code class="code">y ~ A + x</code></dt>
<dd>
<p>Single classification analysis of covariance model of <em>y</em>, with classes determined by <em>A</em>, and with covariate <em>x</em>.</p>
</dd>
</dl>
<p><code class="code">y ~ A*B</code><br>
<code class="code">y ~ A + B + A:B</code><br>
<code class="code">y ~ B %in% A</code><br>
<code class="code">y ~ A/B</code></p>
<p>: Two factor non-additive model of <em>y</em> on <em>A</em> and <em>B</em>. The first two specify the same crossed classification and the second two specify the same nested classification. In abstract terms all four specify the same model subspace.</p>
<p><code class="code">y ~ (A + B + C)^2</code><br>
<code class="code">y ~ A*B*C - A:B:C</code></p>
<p>: Three factor experiment but with a model containing main effects and two factor interactions only. Both formulae specify the same model.</p>
<p><code class="code">y ~ A * x</code><br>
<code class="code">y ~ A/x</code><br>
<code class="code">y ~ A/(1 + x) - 1</code></p>
<p>: Separate simple linear regression models of <em>y</em> on <em>x</em> within the levels of <em>A</em>, with different codings. The last form produces explicit estimates of as many different intercepts and slopes as there are levels in <em>A</em>.</p>
<dl>
<dt><code class="code">y ~ A*B + Error(C)</code></dt>
<dd>
<p>An experiment with two treatment factors, <em>A</em> and <em>B</em>, and error strata determined by factor <em>C</em>. For example a split plot experiment, with whole plots (and hence also subplots), determined by factor <em>C</em>.</p>
</dd>
</dl>
<p>The operator <code class="code">~</code> is used to define a <em>model formula</em> in R. The form, for an ordinary linear model, is</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>response <span class="sc">~</span> op_1 term_1 op_2 term_2 op_3 term_3 ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where</p>
<dl>
<dt><var class="var">response</var></dt>
<dd>
<p>is a vector or matrix, (or expression evaluating to a vector or matrix) defining the response variable(s).</p>
</dd>
<dt><var class="var">op_i</var></dt>
<dd>
<p>is an operator, either <code class="code">+</code> or <code class="code">-</code>, implying the inclusion or exclusion of a term in the model, (the first is optional).</p>
</dd>
<dt><var class="var">term_i</var></dt>
<dd>
<p>is either</p>
<ul>
<li>a vector or matrix expression, or <code class="code">1</code>,</li>
<li>a factor, or</li>
<li>a <em>formula expression</em> consisting of factors, vectors or matrices connected by <em>formula operators</em>.</li>
</ul>
<p>In all cases each term defines a collection of columns either to be added to or removed from the model matrix. A <code class="code">1</code> stands for an intercept column and is by default included in the model matrix unless explicitly removed.</p>
</dd>
</dl>
<p>The <em>formula operators</em> are similar in effect to the Wilkinson and Rogers notation used by such programs as Glim and Genstat. One inevitable change is that the operator <code class="code">.</code>’ becomes <code class="code">:</code>’ since the period is a valid name character in R.</p>
<p>The notation is summarized below (based on Chambers &amp; Hastie, 1992, p.29):</p>
<dl>
<dt><var class="var">Y</var><code class="code">~</code><var class="var">M</var></dt>
<dd>
<p><var class="var">Y</var> is modeled as <var class="var">M</var>.</p>
</dd>
<dt><var class="var">M_1</var><code class="code">+</code><var class="var">M_2</var></dt>
<dd>
<p>Include <var class="var">M_1</var> and <var class="var">M_2</var>.</p>
</dd>
<dt><var class="var">M_1</var><code class="code">-</code><var class="var">M_2</var></dt>
<dd>
<p>Include <var class="var">M_1</var> leaving out terms of <var class="var">M_2</var>.</p>
</dd>
<dt><var class="var">M_1</var><code class="code">:</code><var class="var">M_2</var></dt>
<dd>
<p>The tensor product of <var class="var">M_1</var> and <var class="var">M_2</var>. If both terms are factors, then the “subclasses” factor.</p>
</dd>
<dt><var class="var">M_1</var><code class="code">%in%</code><var class="var">M_2</var></dt>
<dd>
<p>Similar to <var class="var">M_1</var><code class="code">:</code><var class="var">M_2</var>, but with a different coding.</p>
</dd>
<dt><var class="var">M_1</var><code class="code">*</code><var class="var">M_2</var></dt>
<dd>
<p><var class="var">M_1</var><code class="code">+</code><var class="var">M_2</var><code class="code">+</code><var class="var">M_1</var><code class="code">:</code><var class="var">M_2</var>.</p>
</dd>
<dt><var class="var">M_1</var><code class="code">/</code><var class="var">M_2</var></dt>
<dd>
<p><var class="var">M_1</var><code class="code">+</code><var class="var">M_2</var><code class="code">%in%</code><var class="var">M_1</var>.</p>
</dd>
<dt><var class="var">M</var><code class="code">^</code><var class="var">n</var></dt>
<dd>
<p>All terms in <var class="var">M</var> together with “interactions” up to order <var class="var">n</var></p>
</dd>
<dt><code class="code">I(</code><var class="var">M</var><code class="code">)</code></dt>
<dd>
<p>Insulate <var class="var">M</var>. Inside <var class="var">M</var> all operators have their normal arithmetic meaning, and that term appears in the model matrix.</p>
</dd>
</dl>
<p>Note that inside the parentheses that usually enclose function arguments all operators have their normal arithmetic meaning. The function <code class="code">I()</code> is an identity function used to allow terms in model formulae to be defined using arithmetic operators.</p>
<p>Note particularly that the model formulae specify the <em>columns of the model matrix</em>, the specification of the parameters being implicit. This is not the case in other contexts, for example in specifying nonlinear models.</p>
</section>
<section id="contrasts" class="level3 subsection" data-number="11.1.2">
<h3 class="subsection anchored" data-number="11.1.2" data-anchor-id="contrasts"><span class="header-section-number">11.1.2</span> Contrasts <a href="#contrasts-1" class="copiable-link">¶</a></h3>
<p>We need at least some idea how the model formulae specify the columns of the model matrix. This is easy if we have continuous variables, as each provides one column of the model matrix (and the intercept will provide a column of ones if included in the model).</p>
<p><span id="index-Factors-1" class="index-entry-id"></span> <span id="index-Ordered-factors-1" class="index-entry-id"></span></p>
<p>What about a <em>k</em>-level factor <code class="code">A</code>? The answer differs for unordered and ordered factors. For <em>unordered</em> factors <em>k - 1</em> columns are generated for the indicators of the second, …, <em>k</em>-th levels of the factor. (Thus the implicit parameterization is to contrast the response at each level with that at the first.) For <em>ordered</em> factors the <em>k - 1</em> columns are the orthogonal polynomials on <em>1, ..., k</em>, omitting the constant term.</p>
<p>Although the answer is already complicated, it is not the whole story. First, if the intercept is omitted in a model that contains a factor term, the first such term is encoded into <em>k</em> columns giving the indicators for all the levels. Second, the whole behavior can be changed by the <code class="code">options</code> setting for <code class="code">contrasts</code>. The default setting in R is</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">"contr.treatment"</span>, <span class="st">"contr.poly"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The main reason for mentioning this is that R and S have different defaults for unordered factors, S using Helmert contrasts. So if you need to compare your results to those of a textbook or paper which used <span class="small">S-PLUS</span>, you will need to set</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">"contr.helmert"</span>, <span class="st">"contr.poly"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is a deliberate difference, as treatment contrasts (R’s default) are thought easier for newcomers to interpret.</p>
<p>We have still not finished, as the contrast scheme to be used can be set for each term in the model using the functions <code class="code">contrasts</code> and <code class="code">C</code>. <span id="index-contrasts" class="index-entry-id"></span> <span id="index-C" class="index-entry-id"></span></p>
<p>We have not yet considered interaction terms: these generate the products of the columns introduced for their component terms.</p>
<p>Although the details are complicated, model formulae in R will normally generate the models that an expert statistician would expect, provided that marginality is preserved. Fitting, for example, a model with an interaction but not the corresponding main effects will in general lead to surprising results, and is for experts only.</p>
</section>
</section>
<section id="linear-models" class="level2 section" data-number="11.2">
<h2 class="section anchored" data-number="11.2" data-anchor-id="linear-models"><span class="header-section-number">11.2</span> Linear models <a href="#linear-models-1" class="copiable-link">¶</a></h2>
<p>The basic function for fitting ordinary multiple models is <code class="code">lm()</code>, and a streamlined version of the call is as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fitted.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(formula, <span class="at">data =</span> data.frame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For example</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> production)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>would fit a multiple regression model of <em>y</em> on <em>x1</em> and <em>x2</em> (with implicit intercept term).</p>
<p>The important (but technically optional) parameter <code class="code">data = production</code> specifies that any variables needed to construct the model should come first from the <code class="code">production</code> <em>data frame</em>. <em>This is the case regardless of whether data frame <code class="code">production</code> has been attached on the search path or not</em>.</p>
</section>
<section id="generic-functions-for-extracting-model-information" class="level2 section" data-number="11.3">
<h2 class="section anchored" data-number="11.3" data-anchor-id="generic-functions-for-extracting-model-information"><span class="header-section-number">11.3</span> Generic functions for extracting model information <a href="#generic-functions-for-extracting-model-information-1" class="copiable-link">¶</a></h2>
<p>The value of <code class="code">lm()</code> is a fitted model object; technically a list of results of class <code class="code">"lm"</code>. Information about the fitted model can then be displayed, extracted, plotted and so on by using generic functions that orient themselves to objects of class <code class="code">"lm"</code>. These include</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>add1    deviance   formula      predict  step</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>alias   drop1      kappa        print    summary</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>anova   effects    labels       proj     vcov</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>coef    family     plot         residuals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A brief description of the most commonly used ones is given below.</p>
<p>: Compare a submodel with an outer model and produce an analysis of variance table.</p>
<p>: Extract the regression coefficient (matrix).</p>
<pre><code>Long form: `coefficients(`{.code}`object`{.variable .var}`)`{.code}.</code></pre>
<p>: Residual sum of squares, weighted if appropriate.</p>
<p>: Extract the model formula.</p>
<p>: Produce four plots, showing residuals, fitted values and some diagnostics.</p>
<p>: The data frame supplied must have variables specified with the same labels as the original. The value is a vector or matrix of predicted values corresponding to the determining variable values in <var class="var">data.frame</var>.</p>
<p>: Print a concise version of the object. Most often used implicitly.</p>
<p>: Extract the (matrix of) residuals, weighted as appropriate.</p>
<pre><code>Short form: `resid(`{.code}`object`{.variable .var}`)`{.code}.</code></pre>
<p>: Select a suitable model by adding or dropping terms and preserving hierarchies. The model with the smallest value of AIC (Akaike’s An Information Criterion) discovered in the stepwise search is returned.</p>
<p>: Print a comprehensive summary of the results of the regression analysis.</p>
<p>: Returns the variance-covariance matrix of the main parameters of a fitted model object.</p>
</section>
<section id="analysis-of-variance-and-model-comparison" class="level2 section" data-number="11.4">
<h2 class="section anchored" data-number="11.4" data-anchor-id="analysis-of-variance-and-model-comparison"><span class="header-section-number">11.4</span> Analysis of variance and model comparison <a href="#analysis-of-variance-and-model-comparison-1" class="copiable-link">¶</a></h2>
<p>The model fitting function <code class="code">aov(</code><var class="var">formula</var><code class="code">, data=</code><var class="var">data.frame</var><code class="code">)</code> <span id="index-aov" class="index-entry-id"></span> operates at the simplest level in a very similar way to the function <code class="code">lm()</code>, and most of the generic functions listed in the table in <a href="#generic-functions-for-extracting-model-information" class="ref">Generic functions for extracting model information</a> apply.</p>
<p>It should be noted that in addition <code class="code">aov()</code> allows an analysis of models with multiple error strata such as split plot experiments, or balanced incomplete block designs with recovery of inter-block information. The model formula</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>response <span class="sc">~</span> mean.formula <span class="sc">+</span> <span class="fu">Error</span>(strata.formula)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>specifies a multi-stratum experiment with error strata defined by the <var class="var">strata.formula</var>. In the simplest case, <var class="var">strata.formula</var> is simply a factor, when it defines a two strata experiment, namely between and within the levels of the factor.</p>
<p>For example, with all determining variables factors, a model formula such as that in:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fm <span class="ot">&lt;-</span> <span class="fu">aov</span>(yield <span class="sc">~</span> v <span class="sc">+</span> n<span class="sc">*</span>p<span class="sc">*</span>k <span class="sc">+</span> <span class="fu">Error</span>(farms<span class="sc">/</span>blocks), <span class="at">data=</span>farm.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>would typically be used to describe an experiment with mean model <code class="code">v + n*p*k</code> and three error strata, namely “between farms”, “within farms, between blocks” and “within blocks”.</p>
<section id="anova-tables" class="level3 subsection" data-number="11.4.1">
<h3 class="subsection anchored" data-number="11.4.1" data-anchor-id="anova-tables"><span class="header-section-number">11.4.1</span> ANOVA tables <a href="#anova-tables-1" class="copiable-link">¶</a></h3>
<p>Note also that the analysis of variance table (or tables) are for a sequence of fitted models. The sums of squares shown are the decrease in the residual sums of squares resulting from an inclusion of <em>that term</em> in the model at <em>that place</em> in the sequence. Hence only for orthogonal experiments will the order of inclusion be inconsequential.</p>
<p>For multistratum experiments the procedure is first to project the response onto the error strata, again in sequence, and to fit the mean model to each projection. For further details, see Chambers &amp; Hastie (1992).</p>
<p>A more flexible alternative to the default full ANOVA table is to compare two or more models directly using the <code class="code">anova()</code> function.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">anova</span>(fitted.model<span class="fl">.1</span>, fitted.model<span class="fl">.2</span>, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The display is then an ANOVA table showing the differences between the fitted models when fitted in sequence. The fitted models being compared would usually be an hierarchical sequence, of course. This does not give different information to the default, but rather makes it easier to comprehend and control.</p>
</section>
</section>
<section id="updating-fitted-models" class="level2 section" data-number="11.5">
<h2 class="section anchored" data-number="11.5" data-anchor-id="updating-fitted-models"><span class="header-section-number">11.5</span> Updating fitted models <a href="#updating-fitted-models-1" class="copiable-link">¶</a></h2>
<p>The <code class="code">update()</code> function is largely a convenience function that allows a model to be fitted that differs from one previously fitted usually by just a few additional or removed terms. Its form is</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> new.model <span class="ot">&lt;-</span> <span class="fu">update</span>(old.model, new.formula)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the <var class="var">new.formula</var> the special name consisting of a period, <code class="code">.</code>’, <span id="index-_002e" class="index-entry-id"></span> only, can be used to stand for “the corresponding part of the old model formula”. For example,</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fm05 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3 <span class="sc">+</span> x4 <span class="sc">+</span> x5, <span class="at">data =</span> production)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fm6  <span class="ot">&lt;-</span> <span class="fu">update</span>(fm05, . <span class="sc">~</span> . <span class="sc">+</span> x6)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> smf6 <span class="ot">&lt;-</span> <span class="fu">update</span>(fm6, <span class="fu">sqrt</span>(.) <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>would fit a five variate multiple regression with variables (presumably) from the data frame <code class="code">production</code>, fit an additional model including a sixth regressor variable, and fit a variant on the model where the response had a square root transform applied.</p>
<p>Note especially that if the <code class="code">data=</code> argument is specified on the original call to the model fitting function, this information is passed on through the fitted model object to <code class="code">update()</code> and its allies.</p>
<p>The name <samp class="samp">.</samp>’ can also be used in other contexts, but with slightly different meaning. For example</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fmfull <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> . , <span class="at">data =</span> production)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>would fit a model with response <code class="code">y</code> and regressor variables <em>all other variables in the data frame <code class="code">production</code></em>.</p>
<p>Other functions for exploring incremental sequences of models are <code class="code">add1()</code>, <code class="code">drop1()</code> and <code class="code">step()</code>. <span id="index-add1" class="index-entry-id"></span> <span id="index-drop1" class="index-entry-id"></span> <span id="index-step-1" class="index-entry-id"></span> The names of these give a good clue to their purpose, but for full details see the on-line help.</p>
</section>
<section id="generalized-linear-models" class="level2 section" data-number="11.6">
<h2 class="section anchored" data-number="11.6" data-anchor-id="generalized-linear-models"><span class="header-section-number">11.6</span> Generalized linear models <a href="#generalized-linear-models-1" class="copiable-link">¶</a></h2>
<p>Generalized linear modeling is a development of linear models to accommodate both non-normal response distributions and transformations to linearity in a clean and straightforward way. A generalized linear model may be described in terms of the following sequence of assumptions:</p>
<ul>
<li><p>There is a response, <em>y</em>, of interest and stimulus variables x_1, x_2, …, whose values influence the distribution of the response.</p></li>
<li><p>The stimulus variables influence the distribution of <em>y</em> through <em>a single linear function, only</em>. This linear function is called the <em>linear predictor</em>, and is usually written</p>
<div class="display">
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">=</span> beta_1 x_1 <span class="sc">+</span> beta_2 x_2 <span class="sc">+</span> ... <span class="sc">+</span> beta_p x_p,</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>hence <em>x_i</em> has no influence on the distribution of <em>y</em> if and only if beta_i is zero.</p></li>
<li><p>The distribution of <em>y</em> is of the form</p>
<div class="display">
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_Y</span>(y; mu, phi)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">=</span> <span class="fu">exp</span>((A<span class="sc">/</span>phi) <span class="sc">*</span> (y <span class="fu">lambda</span>(mu) <span class="sc">-</span> <span class="fu">gamma</span>(<span class="fu">lambda</span>(mu))) <span class="sc">+</span> <span class="fu">tau</span>(y, phi))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where phi is a <em>scale parameter</em> (possibly known), and is constant for all observations, <em>A</em> represents a prior weight, assumed known but possibly varying with the observations, and mu is the mean of <em>y</em>.</p>
<p>So it is assumed that the distribution of <em>y</em> is determined by its mean and possibly a scale parameter as well.</p></li>
<li><p>The mean, mu, is a smooth invertible function of the linear predictor:</p>
<div class="display">
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> <span class="fu">m</span>(eta),    eta <span class="ot">=</span> m<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}(mu) <span class="ot">=</span> <span class="fu">ell</span>(mu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and this inverse function, ell(), is called the <em>link function</em>.</p></li>
</ul>
<p>These assumptions are loose enough to encompass a wide class of models useful in statistical practice, but tight enough to allow the development of a unified methodology of estimation and inference, at least approximately. The reader is referred to any of the current reference works on the subject for full details, such as McCullagh &amp; Nelder (1989) or Dobson (1990).</p>
<section id="families" class="level3 subsection" data-number="11.6.1">
<h3 class="subsection anchored" data-number="11.6.1" data-anchor-id="families"><span class="header-section-number">11.6.1</span> Families <a href="#families-1" class="copiable-link">¶</a></h3>
<p>The class of generalized linear models handled by facilities supplied in R includes <em>gaussian</em>, <em>binomial</em>, <em>poisson</em>, <em>inverse gaussian</em> and <em>gamma</em> response distributions and also <em>quasi-likelihood</em> models where the response distribution is not explicitly specified. In the latter case the <em>variance function</em> must be specified as a function of the mean, but in other cases this function is implied by the response distribution.</p>
<p>Each response distribution admits a variety of link functions to connect the mean with the linear predictor. Those automatically available are shown in the following table:</p>
<blockquote class="blockquote">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Family name</th>
<th style="text-align: left;">Link functions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code class="code">binomial</code></td>
<td style="text-align: left;"><code class="code">logit</code>, <code class="code">probit</code>, <code class="code">log</code>, <code class="code">cloglog</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code class="code">gaussian</code></td>
<td style="text-align: left;"><code class="code">identity</code>, <code class="code">log</code>, <code class="code">inverse</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code class="code">Gamma</code></td>
<td style="text-align: left;"><code class="code">identity</code>, <code class="code">inverse</code>, <code class="code">log</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code class="code">inverse.gaussian</code></td>
<td style="text-align: left;"><code class="code">1/mu^2</code>, <code class="code">identity</code>, <code class="code">inverse</code>, <code class="code">log</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code class="code">poisson</code></td>
<td style="text-align: left;"><code class="code">identity</code>, <code class="code">log</code>, <code class="code">sqrt</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code class="code">quasi</code></td>
<td style="text-align: left;"><code class="code">logit</code>, <code class="code">probit</code>, <code class="code">cloglog</code>, <code class="code">identity</code>, <code class="code">inverse</code>, <code class="code">log</code>, <code class="code">1/mu^2</code>, <code class="code">sqrt</code></td>
</tr>
</tbody>
</table>
</blockquote>
<p>The combination of a response distribution, a link function and various other pieces of information that are needed to carry out the modeling exercise is called the <em>family</em> of the generalized linear model.</p>
</section>
<section id="the-glm-function" class="level3 subsection" data-number="11.6.2">
<h3 class="subsection anchored" data-number="11.6.2" data-anchor-id="the-glm-function"><span class="header-section-number">11.6.2</span> The <code class="code">glm()</code> function <a href="#the-glm_0028_0029-function-1" class="copiable-link">¶</a></h3>
<p>Since the distribution of the response depends on the stimulus variables through a single linear function <em>only</em>, the same mechanism as was used for linear models can still be used to specify the linear part of a generalized model. The family has to be specified in a different way.</p>
<p>The R function to fit a generalized linear model is <code class="code">glm()</code> which uses the form</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fitted.model <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula, <span class="at">family=</span>family.generator, <span class="at">data=</span>data.frame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The only new feature is the <var class="var">family.generator</var>, which is the instrument by which the family is described. It is the name of a function that generates a list of functions and expressions that together define and control the model and estimation process. Although this may seem a little complicated at first sight, its use is quite simple.</p>
<p>The names of the standard, supplied family generators are given under “Family Name” in the table in <a href="#families" class="ref">Families</a>. Where there is a choice of links, the name of the link may also be supplied with the family name, in parentheses as a parameter. In the case of the <code class="code">quasi</code> family, the variance function may also be specified in this way.</p>
<p>Some examples make the process clear.</p>
</section>
<section id="the-gaussian-family" class="level3 subsubheading" data-number="11.6.3">
<h3 class="subsubheading anchored" data-number="11.6.3" data-anchor-id="the-gaussian-family"><span class="header-section-number">11.6.3</span> The <code class="code">gaussian</code> family <a href="#the-gaussian-family" class="copiable-link">¶</a></h3>
<p>A call such as</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fm <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">family =</span> gaussian, <span class="at">data =</span> sales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>achieves the same result as</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1<span class="sc">+</span>x2, <span class="at">data=</span>sales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>but much less efficiently. Note how the gaussian family is not automatically provided with a choice of links, so no parameter is allowed. If a problem requires a gaussian family with a nonstandard link, this can usually be achieved through the <code class="code">quasi</code> family, as we shall see later.</p>
</section>
<section id="the-binomial-family" class="level3 subsubheading" data-number="11.6.4">
<h3 class="subsubheading anchored" data-number="11.6.4" data-anchor-id="the-binomial-family"><span class="header-section-number">11.6.4</span> The <code class="code">binomial</code> family <a href="#the-binomial-family" class="copiable-link">¶</a></h3>
<p>Consider a small, artificial example, from Silvey (1970).</p>
<p>On the Aegean island of Kalythos the male inhabitants suffer from a congenital eye disease, the effects of which become more marked with increasing age. Samples of islander males of various ages were tested for blindness and the results recorded. The data is shown below:</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td style="text-align: left;">Age:</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">35</td>
<td style="text-align: left;">45</td>
<td style="text-align: left;">55</td>
<td style="text-align: left;">70</td>
</tr>
<tr class="even">
<td style="text-align: left;">No.&nbsp;tested:</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No.&nbsp;blind:</td>
<td style="text-align: left;">&nbsp;6</td>
<td style="text-align: left;">17</td>
<td style="text-align: left;">26</td>
<td style="text-align: left;">37</td>
<td style="text-align: left;">44</td>
</tr>
</tbody>
</table>
<p>The problem we consider is to fit both logistic and probit models to this data, and to estimate for each model the LD50, that is the age at which the chance of blindness for a male inhabitant is 50%.</p>
<p>If <em>y</em> is the number of blind at age <em>x</em> and <em>n</em> the number tested, both models have the form y ~ B(n, F(beta_0 + beta_1 x)) where for the probit case, F(z) = Phi(z) is the standard normal distribution function, and in the logit case (the default), F(z) = e^z/(1+e^z). In both cases the LD50 is LD50 = - beta_0/beta_1 that is, the point at which the argument of the distribution function is zero.</p>
<p>The first step is to set the data up as a data frame</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> kalythos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">35</span>,<span class="dv">45</span>,<span class="dv">55</span>,<span class="dv">70</span>), <span class="at">n =</span> <span class="fu">rep</span>(<span class="dv">50</span>,<span class="dv">5</span>),</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">17</span>,<span class="dv">26</span>,<span class="dv">37</span>,<span class="dv">44</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To fit a binomial model using <code class="code">glm()</code> there are three possibilities for the response:</p>
<ul>
<li>If the response is a <em>vector</em> it is assumed to hold <em>binary</em> data, and so must be a <em>0/1</em> vector.</li>
<li>If the response is a <em>two-column matrix</em> it is assumed that the first column holds the number of successes for the trial and the second holds the number of failures.</li>
<li>If the response is a <em>factor</em>, its first level is taken as failure (0) and all other levels as ‘success’ (1).</li>
</ul>
<p>Here we need the second of these conventions, so we add a matrix to our data frame:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> kalythos<span class="sc">$</span>Ymat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(kalythos<span class="sc">$</span>y, kalythos<span class="sc">$</span>n <span class="sc">-</span> kalythos<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To fit the models we use</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fmp <span class="ot">&lt;-</span> <span class="fu">glm</span>(Ymat <span class="sc">~</span> x, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link=</span>probit), <span class="at">data =</span> kalythos)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fml <span class="ot">&lt;-</span> <span class="fu">glm</span>(Ymat <span class="sc">~</span> x, <span class="at">family =</span> binomial, <span class="at">data =</span> kalythos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since the logit link is the default the parameter may be omitted on the second call. To see the results of each fit we could use</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fmp)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fml)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Both models fit (all too) well. To find the LD50 estimate we can use a simple function:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> ld50 <span class="ot">&lt;-</span> <span class="cf">function</span>(b) <span class="sc">-</span>b[<span class="dv">1</span>]<span class="sc">/</span>b[<span class="dv">2</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> ldp <span class="ot">&lt;-</span> <span class="fu">ld50</span>(<span class="fu">coef</span>(fmp)); ldl <span class="ot">&lt;-</span> <span class="fu">ld50</span>(<span class="fu">coef</span>(fml)); <span class="fu">c</span>(ldp, ldl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The actual estimates from this data are 43.663 years and 43.601 years respectively.</p>
</section>
<section id="poisson-models" class="level3 subsubheading" data-number="11.6.5">
<h3 class="subsubheading anchored" data-number="11.6.5" data-anchor-id="poisson-models"><span class="header-section-number">11.6.5</span> Poisson models <a href="#poisson-models" class="copiable-link">¶</a></h3>
<p>With the Poisson family the default link is the <code class="code">log</code>, and in practice the major use of this family is to fit surrogate Poisson log-linear models to frequency data, whose actual distribution is often multinomial. This is a large and important subject we will not discuss further here. It even forms a major part of the use of non-gaussian generalized models overall.</p>
<p>Occasionally genuinely Poisson data arises in practice and in the past it was often analyzed as gaussian data after either a log or a square-root transformation. As a graceful alternative to the latter, a Poisson generalized linear model may be fitted as in the following example:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fmod <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> A <span class="sc">+</span> B <span class="sc">+</span> x, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link=</span>sqrt),</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> worm.counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="quasi-likelihood-models" class="level3 subsubheading" data-number="11.6.6">
<h3 class="subsubheading anchored" data-number="11.6.6" data-anchor-id="quasi-likelihood-models"><span class="header-section-number">11.6.6</span> Quasi-likelihood models <a href="#quasi-likelihood-models" class="copiable-link">¶</a></h3>
<p>For all families the variance of the response will depend on the mean and will have the scale parameter as a multiplier. The form of dependence of the variance on the mean is a characteristic of the response distribution; for example for the Poisson distribution Var(y) = mu.</p>
<p>For quasi-likelihood estimation and inference the precise response distribution is not specified, but rather only a link function and the form of the variance function as it depends on the mean. Since quasi-likelihood estimation uses formally identical techniques to those for the gaussian distribution, this family provides a way of fitting gaussian models with non-standard link functions or variance functions, incidentally.</p>
<p>For example, consider fitting the non-linear regression y = theta_1 z_1 / (z_2 - theta_2) + e which may be written alternatively as y = 1 / (beta_1 x_1 + beta_2 x_2) + e where x_1 = z_2/z_1, x_2 = -1/z_1, beta_1 = 1/theta_1, and beta_2 = theta_2/theta_1. Supposing a suitable data frame to be set up we could fit this non-linear regression as</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> nlfit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">quasi</span>(<span class="at">link=</span>inverse, <span class="at">variance=</span>constant),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> biochem)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The reader is referred to the manual and the help document for further information, as needed.</p>
</section>
</section>
<section id="nonlinear-least-squares-and-maximum-likelihood-models" class="level2 section" data-number="11.7">
<h2 class="section anchored" data-number="11.7" data-anchor-id="nonlinear-least-squares-and-maximum-likelihood-models"><span class="header-section-number">11.7</span> Nonlinear least squares and maximum likelihood models <a href="#nonlinear-least-squares-and-maximum-likelihood-models-1" class="copiable-link">¶</a></h2>
<p>Certain forms of nonlinear model can be fitted by Generalized Linear Models (<code class="code">glm()</code>). But in the majority of cases we have to approach the nonlinear curve fitting problem as one of nonlinear optimization. R’s nonlinear optimization routines are <code class="code">optim()</code>, <code class="code">nlm()</code> and <code class="code">nlminb()</code>, <span id="index-nlm" class="index-entry-id"></span> <span id="index-optim" class="index-entry-id"></span> <span id="index-nlminb" class="index-entry-id"></span> We seek the parameter values that minimize some index of lack-of-fit, and they do this by trying out various parameter values iteratively. Unlike linear regression for example, there is no guarantee that the procedure will converge on satisfactory estimates. All the methods require initial guesses about what parameter values to try, and convergence may depend critically upon the quality of the starting values.</p>
<section id="least-squares" class="level3 subsection" data-number="11.7.1">
<h3 class="subsection anchored" data-number="11.7.1" data-anchor-id="least-squares"><span class="header-section-number">11.7.1</span> Least squares <a href="#least-squares-1" class="copiable-link">¶</a></h3>
<p>One way to fit a nonlinear model is by minimizing the sum of the squared errors (SSE) or residuals. This method makes sense if the observed errors could have plausibly arisen from a normal distribution.</p>
<p>Here is an example from Bates &amp; Watts (1988), page 51. The data are:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.02</span>, <span class="fl">0.06</span>, <span class="fl">0.06</span>, <span class="fl">0.11</span>, <span class="fl">0.11</span>, <span class="fl">0.22</span>, <span class="fl">0.22</span>, <span class="fl">0.56</span>, <span class="fl">0.56</span>,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>         <span class="fl">1.10</span>, <span class="fl">1.10</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">76</span>, <span class="dv">47</span>, <span class="dv">97</span>, <span class="dv">107</span>, <span class="dv">123</span>, <span class="dv">139</span>, <span class="dv">159</span>, <span class="dv">152</span>, <span class="dv">191</span>, <span class="dv">201</span>, <span class="dv">207</span>, <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The fit criterion to be minimized is:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fn <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">sum</span>((y <span class="sc">-</span> (p[<span class="dv">1</span>] <span class="sc">*</span> x)<span class="sc">/</span>(p[<span class="dv">2</span>] <span class="sc">+</span> x))<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In order to do the fit we need initial estimates of the parameters. One way to find sensible starting values is to plot the data, guess some parameter values, and superimpose the model curve using those values.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(x, y)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> xfit <span class="ot">&lt;-</span> <span class="fu">seq</span>(.<span class="dv">02</span>, <span class="fl">1.1</span>, .<span class="dv">05</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> yfit <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="sc">*</span> xfit<span class="sc">/</span>(<span class="fl">0.1</span> <span class="sc">+</span> xfit)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lines</span>(<span class="fu">spline</span>(xfit, yfit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We could do better, but these starting values of 200 and 0.1 seem adequate. Now do the fit:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> out <span class="ot">&lt;-</span> <span class="fu">nlm</span>(fn, <span class="at">p =</span> <span class="fu">c</span>(<span class="dv">200</span>, <span class="fl">0.1</span>), <span class="at">hessian =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After the fitting, <code class="code">out$minimum</code> is the SSE, and <code class="code">out$estimate</code> are the least squares estimates of the parameters. To obtain the approximate standard errors (SE) of the estimates we do:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="dv">2</span><span class="sc">*</span>out<span class="sc">$</span>minimum<span class="sc">/</span>(<span class="fu">length</span>(y) <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">solve</span>(out<span class="sc">$</span>hessian)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code class="code">2</code> which is subtracted in the line above represents the number of parameters. A 95% confidence interval would be the parameter estimate +/- 1.96 SE. We can superimpose the least squares fit on a new plot:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">plot</span>(x, y)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> xfit <span class="ot">&lt;-</span> <span class="fu">seq</span>(.<span class="dv">02</span>, <span class="fl">1.1</span>, .<span class="dv">05</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> yfit <span class="ot">&lt;-</span> <span class="fl">212.68384222</span> <span class="sc">*</span> xfit<span class="sc">/</span>(<span class="fl">0.06412146</span> <span class="sc">+</span> xfit)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lines</span>(<span class="fu">spline</span>(xfit, yfit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The standard package <strong>stats</strong> provides much more extensive facilities for fitting non-linear models by least squares. The model we have just fitted is the Michaelis-Menten model, so we can use</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(y <span class="sc">~</span> <span class="fu">SSmicmen</span>(x, Vm, K), df)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fit</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>Nonlinear regression model</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  model<span class="sc">:</span>  y <span class="sc">~</span> <span class="fu">SSmicmen</span>(x, Vm, K)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>   data<span class="sc">:</span>  df</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>          Vm            K</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fl">212.68370711</span>   <span class="fl">0.06412123</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a> residual sum<span class="sc">-</span>of<span class="sc">-</span>squares<span class="sc">:</span>  <span class="fl">1195.449</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(fit)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>Formula<span class="sc">:</span> y <span class="sc">~</span> <span class="fu">SSmicmen</span>(x, Vm, K)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>Parameters<span class="sc">:</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>Vm <span class="fl">2.127e+02</span>  <span class="fl">6.947e+00</span>  <span class="fl">30.615</span> <span class="fl">3.24e-11</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>K  <span class="fl">6.412e-02</span>  <span class="fl">8.281e-03</span>   <span class="fl">7.743</span> <span class="fl">1.57e-05</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">10.93</span> on <span class="dv">10</span> degrees of freedom</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>Correlation of Parameter Estimates<span class="sc">:</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>      Vm</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>K <span class="fl">0.7651</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="maximum-likelihood" class="level3 subsection" data-number="11.7.2">
<h3 class="subsection anchored" data-number="11.7.2" data-anchor-id="maximum-likelihood"><span class="header-section-number">11.7.2</span> Maximum likelihood <a href="#maximum-likelihood-1" class="copiable-link">¶</a></h3>
<p>Maximum likelihood is a method of nonlinear model fitting that applies even if the errors are not normal. The method finds the parameter values which maximize the log likelihood, or equivalently which minimize the negative log-likelihood. Here is an example from Dobson (1990), pp. 108–111. This example fits a logistic model to dose-response data, which clearly could also be fit by <code class="code">glm()</code>. The data are:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.6907</span>, <span class="fl">1.7242</span>, <span class="fl">1.7552</span>, <span class="fl">1.7842</span>, <span class="fl">1.8113</span>,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>         <span class="fl">1.8369</span>, <span class="fl">1.8610</span>, <span class="fl">1.8839</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> y <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">6</span>, <span class="dv">13</span>, <span class="dv">18</span>, <span class="dv">28</span>, <span class="dv">52</span>, <span class="dv">53</span>, <span class="dv">61</span>, <span class="dv">60</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> n <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">59</span>, <span class="dv">60</span>, <span class="dv">62</span>, <span class="dv">56</span>, <span class="dv">63</span>, <span class="dv">59</span>, <span class="dv">62</span>, <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The negative log-likelihood to minimize is:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fn <span class="ot">&lt;-</span> <span class="cf">function</span>(p)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum</span>( <span class="sc">-</span> (y<span class="sc">*</span>(p[<span class="dv">1</span>]<span class="sc">+</span>p[<span class="dv">2</span>]<span class="sc">*</span>x) <span class="sc">-</span> n<span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(p[<span class="dv">1</span>]<span class="sc">+</span>p[<span class="dv">2</span>]<span class="sc">*</span>x))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>           <span class="sc">+</span> <span class="fu">log</span>(<span class="fu">choose</span>(n, y)) ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We pick sensible starting values and do the fit:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> out <span class="ot">&lt;-</span> <span class="fu">nlm</span>(fn, <span class="at">p =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">50</span>,<span class="dv">20</span>), <span class="at">hessian =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After the fitting, <code class="code">out$minimum</code> is the negative log-likelihood, and <code class="code">out$estimate</code> are the maximum likelihood estimates of the parameters. To obtain the approximate SEs of the estimates we do:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">solve</span>(out<span class="sc">$</span>hessian)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A 95% confidence interval would be the parameter estimate +/- 1.96 SE.</p>
</section>
</section>
<section id="some-non-standard-models" class="level2 section" data-number="11.8">
<h2 class="section anchored" data-number="11.8" data-anchor-id="some-non-standard-models"><span class="header-section-number">11.8</span> Some non-standard models <a href="#some-non-standard-models-1" class="copiable-link">¶</a></h2>
<p>We conclude this chapter with just a brief mention of some of the other facilities available in R for special regression and data analysis problems.</p>
<ul>
<li><p><span id="index-Mixed-models" class="index-entry-id"></span> <strong>Mixed models.</strong> The recommended <a href="https://CRAN.R-project.org/package=nlme" class="url"><strong>nlme</strong></a> package provides functions <code class="code">lme()</code> and <code class="code">nlme()</code> <span id="index-lme" class="index-entry-id"></span> <span id="index-nlme" class="index-entry-id"></span> for linear and non-linear mixed-effects models, that is linear and non-linear regressions in which some of the coefficients correspond to random effects. These functions make heavy use of formulae to specify the models.</p></li>
<li><p><span id="index-Local-approximating-regressions" class="index-entry-id"></span> <strong>Local approximating regressions.</strong> The <code class="code">loess()</code> <span id="index-loess" class="index-entry-id"></span> function fits a nonparametric regression by using a locally weighted regression. Such regressions are useful for highlighting a trend in messy data or for data reduction to give some insight into a large data set.</p>
<p>Function <code class="code">loess</code> is in the standard package <strong>stats</strong>, together with code for projection pursuit regression. <span id="index-loess-1" class="index-entry-id"></span></p></li>
<li><p><span id="index-Robust-regression" class="index-entry-id"></span> <strong>Robust regression.</strong> There are several functions available for fitting regression models in a way resistant to the influence of extreme outliers in the data. Function <code class="code">lqs</code> <span id="index-lqs" class="index-entry-id"></span> in the recommended package <a href="https://CRAN.R-project.org/package=MASS" class="url"><strong>MASS</strong></a> provides state-of-art algorithms for highly-resistant fits. Less resistant but statistically more efficient methods are available in packages, for example function <code class="code">rlm</code> <span id="index-rlm" class="index-entry-id"></span> in package <a href="https://CRAN.R-project.org/package=MASS" class="url"><strong>MASS</strong></a>.</p></li>
<li><p><span id="index-Additive-models" class="index-entry-id"></span> <strong>Additive models.</strong> This technique aims to construct a regression function from smooth additive functions of the determining variables, usually one for each determining variable. Functions <code class="code">avas</code> and <code class="code">ace</code> <span id="index-avas" class="index-entry-id"></span> <span id="index-ace" class="index-entry-id"></span> in package <a href="https://CRAN.R-project.org/package=acepack" class="url"><strong>acepack</strong></a> and functions <code class="code">bruto</code> and <code class="code">mars</code> <span id="index-bruto" class="index-entry-id"></span> <span id="index-mars" class="index-entry-id"></span> in package <a href="https://CRAN.R-project.org/package=mda" class="url"><strong>mda</strong></a> provide some examples of these techniques in user-contributed packages to R. An extension is <strong>Generalized Additive Models</strong>, implemented in user-contributed packages <a href="https://CRAN.R-project.org/package=gam" class="url"><strong>gam</strong></a> and <a href="https://CRAN.R-project.org/package=mgcv" class="url"><strong>mgcv</strong></a>.</p></li>
<li><p><span id="index-Tree_002dbased-models" class="index-entry-id"></span> <strong>Tree-based models.</strong> Rather than seek an explicit global linear model for prediction or interpretation, tree-based models seek to bifurcate the data, recursively, at critical points of the determining variables in order to partition the data ultimately into groups that are as homogeneous as possible within, and as heterogeneous as possible between. The results often lead to insights that other data analysis methods tend not to yield.</p>
<p>Models are again specified in the ordinary linear model form. The model fitting function is <code class="code">tree()</code>, <span id="index-tree" class="index-entry-id"></span> but many other generic functions such as <code class="code">plot()</code> and <code class="code">text()</code> are well adapted to displaying the results of a tree-based model fit in a graphical way.</p>
<p>Tree models are available in R <em>via</em> the user-contributed packages <a href="https://CRAN.R-project.org/package=rpart" class="url"><strong>rpart</strong></a> and <a href="https://CRAN.R-project.org/package=tree" class="url"><strong>tree</strong></a>.</p></li>
</ul>
<p>Next: <a href="Graphics.html#graphics" accesskey="n" rel="next">Graphical procedures</a>, Previous: <a href="Writing-your-own-functions.html#writing-your-own-functions" accesskey="p" rel="prev">Writing your own functions</a>, Up: <a href="index.html" accesskey="u" rel="up">An Introduction to R</a> &nbsp; [<a href="index.html#sec_contents" rel="contents" title="Table of contents">Contents</a>][<a href="Function-and-variable-index.html" rel="index" title="Index">Index</a>]</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Writing-your-own-functions.html" class="pagination-link" aria-label="Writing your own functions [¶](#writing-your-own-functions-1){.copiable-link}">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Writing your own functions </span></span></a><a href="#writing-your-own-functions-1" class="copiable-link">¶</a>
                
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Graphics.html" class="pagination-link" aria-label="Graphical procedures [¶](#graphical-procedures){.copiable-link}">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Graphical procedures </span></span></a><a href="#graphical-procedures" class="copiable-link">¶</a> <i class="bi bi-arrow-right-short"></i>
      
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>A re-styled version of the original R manuals at <a href="https://cran.r-project.org/manuals.html" class="uri">https://cran.r-project.org/manuals.html</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built using <a href="https://quarto.org">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>